<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<meta name="author" content="Topicus Onderwijs">
<title>Cobra in Action</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:initial}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px 0}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:.4em .75em 0 .75em;line-height:1;vertical-align:top}
.colist>table tr>td:first-of-type img{max-width:initial}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
<style>
/* Pygments styles disabled. Pygments is not available. */
</style>
</head>
<body class="book">
<div id="header">
<h1>Cobra in Action</h1>
<div class="details">
<span id="author" class="author">Topicus Onderwijs</span><br>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="cover.png" alt="Cobra in Action">
</div>
</div>
<div id="toc" class="toc">
<div id="toctitle" class="title">Inhoudsopgave</div>
<ul class="sectlevel1">
<li><a href="#_introductie">1. Introductie</a>
<ul class="sectlevel2">
<li><a href="#_waarom_cobra_in_action">1.1. Waarom Cobra in Action?</a></li>
</ul>
</li>
<li><a href="#_cobra">2. Cobra</a>
<ul class="sectlevel2">
<li><a href="#_wat_is_cobra">2.1. Wat is Cobra?</a></li>
<li><a href="#_onderwijs_parent">2.2. Onderwijs Parent</a></li>
<li><a href="#_conventies_voor_het_onderhouden_van_cobra_en_cobra_applicaties">2.3. Conventies voor het onderhouden van Cobra en Cobra applicaties</a></li>
<li><a href="#_wicket_en_hibernate_models">2.4. Wicket en Hibernate models</a></li>
<li><a href="#_gebruik_componenten_uit_cobra_webcomponents">2.5. Gebruik componenten uit Cobra Webcomponents</a></li>
<li><a href="#_toon_tabelachtige_data_met_een_customdatapanel">2.6. Toon tabelachtige data met een CustomDataPanel</a></li>
<li><a href="#_internationalisatie">2.7. Internationalisatie</a></li>
<li><a href="#_less_gebruiken_voor_stylesheets">2.8. Less gebruiken voor stylesheets</a></li>
<li><a href="#_keuringsdienst_van_cobra_kwaliteitstests">2.9. Keuringsdienst van Cobra: kwaliteitstests</a></li>
<li><a href="#_samenvatting">2.10. Samenvatting</a></li>
</ul>
</li>
<li><a href="#_beginnen_met_de_rest_architectuur">3. Beginnen met de REST architectuur</a>
<ul class="sectlevel2">
<li><a href="#_de_kaaswinkel">3.1. De kaaswinkel</a></li>
<li><a href="#_project_inrichten">3.2. Project inrichten</a></li>
</ul>
</li>
<li><a href="#_de_datalaag">4. De Datalaag</a>
<ul class="sectlevel2">
<li><a href="#_data_access_objects_ontsluiten_de_datalaag">4.1. Data Access Objects Ontsluiten de Datalaag</a></li>
<li><a href="#_object_relationele_mapping_met_jpa">4.2. Object Relationele Mapping met JPA</a></li>
</ul>
</li>
<li><a href="#_rest">5. REST</a>
<ul class="sectlevel2">
<li><a href="#_inleiding">5.1. Inleiding</a></li>
<li><a href="#_api_design">5.2. API design</a></li>
<li><a href="#_resources_schrijven">5.3. Resources schrijven</a></li>
<li><a href="#_extra_informatie_opvragen_met_additionalobjects">5.4. Extra Informatie opvragen met AdditionalObjects</a></li>
<li><a href="#_versionering_van_de_api">5.5. Versionering van de API</a></li>
<li><a href="#_performance_overwegingen">5.6. Performance overwegingen</a></li>
<li><a href="#_mapping_van_entiteit_naar_rest">5.7. Mapping van entiteit naar REST</a></li>
<li><a href="#_wicket_client_applicaties_best_practices">5.8. Wicket client-applicaties: best practices</a></li>
</ul>
</li>
<li><a href="#_autoforms">6. Autoforms</a>
<ul class="sectlevel2">
<li><a href="#_autofieldset">6.1. AutoFieldSet</a></li>
<li><a href="#_met_fieldmodifiers_autoforms_op_veldniveau_aanpassen">6.2. Met fieldmodifiers autoforms op veldniveau aanpassen</a></li>
</ul>
</li>
<li><a href="#_rechten">7. Rechten</a>
<ul class="sectlevel2">
<li><a href="#_rechten_in_de_rest_laag">7.1. Rechten in de REST-laag</a></li>
<li><a href="#_rechten_in_een_wicket_applicatie">7.2. Rechten in een Wicket-applicatie</a></li>
</ul>
</li>
<li><a href="#_javaee">8. JavaEE</a>
<ul class="sectlevel2">
<li><a href="#_configuratie">8.1. Configuratie</a></li>
<li><a href="#_jobs">8.2. Jobs</a></li>
</ul>
</li>
<li><a href="#_testen_met_junit_arquillian_en_selenium">9. Testen met JUnit, Arquillian en Selenium</a>
<ul class="sectlevel2">
<li><a href="#_schrijven_van_unit_tests_met_junit">9.1. Schrijven van Unit tests met JUnit</a></li>
<li><a href="#_gebruik_arquillian_voor_in_container_tests">9.2. Gebruik Arquillian voor In-Container Tests</a></li>
<li><a href="#_arquillian_en_selenium_samen_laten_werken">9.3. Arquillian en Selenium samen laten werken</a></li>
<li><a href="#_genereer_databasevulling_met_entitybuilders">9.4. Genereer databasevulling met EntityBuilders</a></li>
<li><a href="#_schrijf_custom_arquillian_extensions">9.5. Schrijf Custom Arquillian Extensions</a></li>
<li><a href="#_gebruik_selenium_voor_client_tests">9.6. Gebruik Selenium voor Client Tests</a></li>
</ul>
</li>
<li><a href="#_je_eerste_dag">Appendix A: Je eerste dag</a>
<ul class="sectlevel2">
<li><a href="#_accounts_aanvragen_aanmaken">A.1. Accounts aanvragen/aanmaken</a></li>
<li><a href="#_software_her_installeren">A.2. Software (her)installeren</a></li>
</ul>
</li>
<li><a href="#_verklarende_woordenlijst">Appendix B: Verklarende woordenlijst</a>
<ul class="sectlevel2">
<li><a href="#_topicus_onderwijs_systemen_en_projecten">Topicus Onderwijs systemen en projecten</a></li>
<li><a href="#_afkortingen_uit_het_projectmanagement">Afkortingen uit het projectmanagement</a></li>
<li><a href="#_afkortingen_uit_het_onderwijsdomein">Afkortingen uit het onderwijsdomein</a></li>
<li><a href="#_afkortingen_en_begrippen_uit_de_em_topicus_onderwijs_em_cultuur">Afkortingen en begrippen uit de <em>Topicus Onderwijs</em> cultuur</a></li>
<li><a href="#_afkortingen_en_begrippen_gebruikt_door_ontwikkelaars">Afkortingen en begrippen gebruikt door ontwikkelaars</a></li>
<li><a href="#_oo_begrippen">OO begrippen</a></li>
<li><a href="#_design_patterns">B.1. Design Patterns</a></li>
<li><a href="#_java_begrippen">Java begrippen</a></li>
<li><a href="#_begrippen_gerelateerd_aan_git">Begrippen gerelateerd aan Git</a></li>
</ul>
</li>
<li><a href="#_cobra_in_action_styleguide">Appendix C: Cobra in Action styleguide</a>
<ul class="sectlevel2">
<li><a href="#_technische_styleguide">C.1. Technische styleguide</a></li>
<li><a href="#_inhoudelijke_styleguide">C.2. Inhoudelijke styleguide</a></li>
</ul>
</li>
<li><a href="#_bibliografie">Bibliografie</a></li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introductie">1. Introductie</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Cobra in Action</strong> is een lang verwacht documentatie project voor het Cobra raamwerk dat bij Topicus Onderwijs in gebruik is.
Cobra dient als basis voor de meeste applicaties van Topicus Onderwijs, waaronder ParnasSys, SOMtoday en EduArte.</p>
</div>
<div class="paragraph">
<p>In dit document wordt allerlei informatie verzameld van de standaarden waaraan projecten zich moeten houden zoals Maven POMs en hoe je projecten in onze Maven repository moet hangen.
Daarnaast worden de verschillende onderdelen van Cobra uitgewerkt: web componenten, de REST architectuur en hoe je snel van een database veld presenteert in een HTML input veld met daartussen diverse JavaEE technologieën.</p>
</div>
<div class="paragraph">
<p>Deze documentatie is geschreven voor en door Topicus Onderwijs ontwikkelaars.
Iedereen is eigenaar van deze documentatie en mag (moet) mee helpen deze documentatie verbeteren.</p>
</div>
<div class="sect2">
<h3 id="_waarom_cobra_in_action">1.1. Waarom Cobra in Action?</h3>
<div class="paragraph">
<p>Hoe kom je er achter dat er een <code>PseudoFieldModifier</code> is?
Daar is deze documentatie voor.</p>
</div>
<div class="paragraph">
<p>JavaDoc is een hele goede standaard om je klassen en methoden te documenteren voor de gebruikers van je API.
Echter is het niet eenvoudig om je weg te vinden in een grote applicatie die al 10 jaar in ontwikkeling is.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cobra">2. Cobra</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In de loop der jaren doe je ervaring op met het bouwen van applicaties.
Je verzamelt handige classes en componenten die je wilt delen over de verschillende projecten die je gestart hebt.
Deze classes en componenten zijn bij Topicus Onderwijs verzameld in het <strong>Cobra</strong> project.</p>
</div>
<div class="sect2">
<h3 id="_wat_is_cobra">2.1. Wat is Cobra?</h3>
<div class="paragraph">
<p>Cobra is een verzameling modules die het bouwen van Topicus Onderwijs projecten zwaar vereenvoudigt.
Cobra zorgt voor een set standaard, herbruikbare componenten waarmee je zeer snel en relatief eenvoudig complexe web interfaces kan maken, die ook nog eens goed onderhoudbaar zijn.</p>
</div>
<div class="paragraph">
<p>Nu is er altijd iets te klagen over onze code en dat die nooit goed genoeg is.
Dat klopt.
Echter mag je niet uit het oog verliezen dat we meer dan 3 miljoen regels code onderhouden met zo&#8217;n 45 ontwikkelaars, en dat feitelijk in 4 markten, waar onze directe concurrent 45 ontwikkelaars nodig heeft om één product te onderhouden.
We doen dus toch iets goeds.</p>
</div>
<div class="paragraph">
<p>Cobra biedt een basis voor het bouwen van onze applicaties.
Het biedt standaard user interface componenten, standaard componenten om te werken met JavaEE technologieën zoals JPA (database toegang op een objectgeörienteerde manier) en JAX-RS (de Java standaard voor het bouwen van REST-APIs).</p>
</div>
<div class="sect3">
<h4 id="_cobra_modules">2.1.1. Cobra modules</h4>
<div class="paragraph">
<p>Er zijn veel Cobra modules beschikbaar.
Bij Cobra hebben we de filosofie aangehouden dat een module bedoeld is voor slechts één specifiek doel en daarbij voldoende, maar zo min mogelijk verplichte externe afhankelijkheden nodig heeft.
Zo heeft de <em>cobra-commons</em> module als verplichte afhankelijkheden <em>Guava</em>, <em>icu4j</em> en <em>joda_time</em>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">autoforms</dt>
<dd>
<p>Wicket componenten voor het snel kunnen renderen van CRUD markup</p>
</dd>
<dt class="hdlist1">beyond-datapanel</dt>
<dd>
<p>Wicket component dat een oneindige lijst van objecten kan renderen</p>
</dd>
<dt class="hdlist1">bootstrap-*</dt>
<dd>
<p>Wicket resources voor Twitter Bootstrap, een CSS/JavaScript raamwerk</p>
</dd>
<dt class="hdlist1">commons</dt>
<dd>
<p>Utility classes voor het manipuleren van strings, datums en andere zaken.</p>
</dd>
<dt class="hdlist1">cxf</dt>
<dd>
<p>Bevat handige features om snel CXF webservices te maken</p>
</dd>
<dt class="hdlist1">datapanel</dt>
<dd>
<p>een data panel dat sorteerbaar, groepeerbaar en afdrukbaar is. De gebruiker kan dit zelf instellen</p>
</dd>
<dt class="hdlist1">hibernate</dt>
<dd>
<p>Definities voor DataAccessHelper, interceptors, Hibernate initialisatie, een criteria builder en missende Hibernate dialects.</p>
</dd>
<dt class="hdlist1">jee-*</dt>
<dd>
<p>Basis projecten voor nieuwe op JavaEE gebaseerde ontwikkeling, waaronder DAOs die gebruik maken van JPA in plaats van direct op Hibernate afhankelijk te zijn, een REST-raamwerk en nog veel meer.</p>
</dd>
<dt class="hdlist1">kitchensink</dt>
<dd>
<p>Alles waar geen specifieke plek voor gevonden kon worden in andere modules van cobra.
Deze module trekt half internet binnen, gebruik is op eigen risico.</p>
</dd>
<dt class="hdlist1">reporting</dt>
<dd>
<p>Bevat code om vanuit code documenten te genereren van verschillende formaten, bijvoorbeeld om user scripts mogelijk te maken in templates</p>
</dd>
<dt class="hdlist1">saml</dt>
<dd>
<p>OpenSAML integratie voor Single Sign-On in webapplicaties.</p>
</dd>
<dt class="hdlist1">scheduling</dt>
<dd>
<p>Een batch job scheduler</p>
</dd>
<dt class="hdlist1">security</dt>
<dd>
<p>wicket-security gerelateerde code, waaronder een alternatieve implementatie van de HiveFactory</p>
</dd>
<dt class="hdlist1">selenium-*</dt>
<dd>
<p>Integratie van Wicket en Cobra met Selenium voor webbrowsergebaseerde tests</p>
</dd>
<dt class="hdlist1">transloadit</dt>
<dd>
<p>Classes voor communicatie met TransloadIt, een cloudverwerker van plaatjes, videos, presentaties en documenten.</p>
</dd>
<dt class="hdlist1">update</dt>
<dd>
<p>Classes en basisinfrastructuur voor database(schema) updates</p>
</dd>
<dt class="hdlist1">webcomponents</dt>
<dd>
<p>Diverse Wicket componenten, o.a. wrappers om JQuery componenten</p>
</dd>
<dt class="hdlist1">xjc</dt>
<dd>
<p>Bevat de XJC plugin voor het genereren van nettere java code voor Java XML Bindings (JAXB).</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Nieuwe projecten doen er wijs aan om te starten op basis van de <em>cobra-jee</em> modules.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_onderwijs_parent">2.2. Onderwijs Parent</h3>
<div class="paragraph">
<p>De <em>Onderwijs Parent</em> is een Maven project dat alle open source dependencies die we binnentrekken binnen onze applicaties en in Cobra op elkaar afstemt.
Met dit centrale project weten we de versieconflicten die tussen verschillende afhankelijkheden optreden op te lossen.</p>
</div>
<div class="paragraph">
<p>Deze Maven POM specificeert niet alleen de versies van de Java bibliotheken die we gebruiken, maar ook de versies en configuratie van de Maven plugins die nodig zijn om de build te voltooien.</p>
</div>
<div class="paragraph">
<p>Je kan de versies en configuratie lokaal in je eigen project overschrijven met wat zinnig is voor jouw specifieke situatie.</p>
</div>
<div class="sect3">
<h4 id="_automatisch_updates_van_dependencies_krijgen">2.2.1. Automatisch updates van dependencies krijgen</h4>
<div class="paragraph">
<p>De Onderwijs Parent wordt regelmatig voorzien van nieuwe versies van de Java projecten.
Je kan je als project abonneren op deze updates door je gegevens toe te voegen aan het <em>urls.lst</em> bestand in de <em>onderwijs parent</em> git repository op Github.</p>
</div>
<div class="paragraph">
<p>Het formaat van het bestand is <code>&lt;github project id&gt;:&lt;branch naam&gt;:</code></p>
</div>
<div class="paragraph">
<p>Dus voor Parnassys en EduArte zien de regels er als volgt uit:</p>
</div>
<div class="listingblock">
<div class="title">Regels in het urls.lst bestand</div>
<div class="content">
<pre>eduarte:master:
parnassys:master:</pre>
</div>
</div>
<div class="paragraph">
<p>Dit bestand dient alfabetisch gesorteerd te blijven.</p>
</div>
<div class="paragraph">
<p>Wanneer je je project hieraan toegevoegt zal bij een nieuwe versie van de <em>onderwijs parent</em> jouw project automatisch voorzien worden van deze versie.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_conventies_voor_het_onderhouden_van_cobra_en_cobra_applicaties">2.3. Conventies voor het onderhouden van Cobra en Cobra applicaties</h3>
<div class="paragraph">
<p>Om het mogelijk te maken met meer dan 40 ontwikkelaars tegelijkertijd aan dezelfde raamwerken en applicaties te kunnen werken moet je afspraken maken over hoe je de ontwikkeling doet.
In deze sectie wordt een aantal van deze afspraken behandeld.</p>
</div>
<div class="sect3">
<h4 id="_deel_je_libraries">2.3.1. Deel je libraries</h4>
<div class="paragraph">
<p>Een gedeelde library is een bibliotheek die niet als Cobra module door het leven gaat.
Deze hebben hun eigen release cycle en worden niet als SNAPSHOT in de <em>onderwijs parent</em> opgenomen maar als een release.</p>
</div>
<div class="paragraph">
<p>Elke eigen ontwikkelde bibliotheek dient te voldoen aan de volgende minimumeisen om zo de continuïteit van onze projecten te waarborgen:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>POM moet overerven van de meest recente <em>onderwijs parent</em></p>
</li>
<li>
<p>een Jenkins job dient deze elke dag minimaal één keer te bouwen</p>
</li>
<li>
<p>project dient opgenomen te worden in de <em>urls file</em> van de <em>onderwijs parent</em> zodat deze bij elke nieuwe parent release meegenomen wordt</p>
</li>
<li>
<p>als een build faalt, fix de build en maak een nieuwe release</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Als we dit doen voorkomen we dat een project enkel in een vergeten repository leeft en dat niemand weet hoe dat ding ooit gebouwd dient te worden.</p>
</div>
</div>
<div class="sect3">
<h4 id="_documenteer_je_project_in_je_maven_poms">2.3.2. Documenteer je project in je Maven POMs</h4>
<div class="paragraph">
<p>Neem in de POM niet alleen de naam van het project op maar ook een korte omschrijving, zodat wanneer je op vakantie bent anderen ook kunnen begrijpen waarom die bibliotheek bestaat.</p>
</div>
<div class="listingblock">
<div class="title">De te documenteren rubrieken</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">&lt;?xml version="1.0"?&gt;
&lt;project&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;nl.topicus.onderwijs&lt;/groupId&gt;
        &lt;artifactId&gt;onderwijs-jee7-parent&lt;/artifactId&gt;
        &lt;version&gt;&lt;/version&gt;
        &lt;relativePath/&gt;
    &lt;/parent&gt;
    &lt;groupId&gt;nl.topicus.onderwijs.project&lt;/groupId&gt;
    &lt;artifactId&gt;project-parent&lt;/artifactId&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;packaging&gt;pom&lt;/packaging&gt;
    &lt;name&gt;Project Parent POM&lt;/name&gt;
    &lt;description&gt;omschrijving van project.&lt;/description&gt;
&lt;/project&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Vervang project in dit voorbeeld door je projectnaam.
Dus als je je project "dark-hades" (een slechte superheld) noemt dan komt de pom er zo uit te zien:</p>
</div>
<div class="listingblock">
<div class="title">Een goed gedocumenteerd project</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">&lt;?xml version="1.0"?&gt;
&lt;project&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;nl.topicus.onderwijs&lt;/groupId&gt;
        &lt;artifactId&gt;onderwijs-jee7-parent&lt;/artifactId&gt;
        &lt;version&gt;&lt;/version&gt;
        &lt;relativePath/&gt;
    &lt;/parent&gt;
    &lt;groupId&gt;nl.topicus.onderwijs.dark-hades&lt;/groupId&gt;
    &lt;artifactId&gt;dark-hades-parent&lt;/artifactId&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;packaging&gt;pom&lt;/packaging&gt;
    &lt;name&gt;Dark Hades Parent POM&lt;/name&gt;
    &lt;description&gt;
        Dark Hades is een zoekalgorithme voor het vinden van donkere
        grotten met grote plasma TVs.
    &lt;/description&gt;
&lt;/project&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Vul ook de SCM sectie in met de github coördinaten van jouw project zodat deze met Jenkins (of andere build tool) gebouwd kan worden.</p>
</div>
<div class="paragraph">
<p>Door over te erven van de <strong>onderwijs-parent</strong> krijg je automatisch de juiste, door ons verwachte instellingen mee.
Eclipse zal direct goed werken, je krijgt de juiste compiler instellingen (Maven denkt dat Java 1.3 nog hip en happening is), en niet in de laatste plaats zal je POM aan de rigoreuze controles worden onderworpen van de POM Nazi.</p>
</div>
</div>
<div class="sect3">
<h4 id="_standaardiseer_je_maven_pom_s_met_de_pom_nazi">2.3.3. Standaardiseer je Maven POM&#8217;s met de POM Nazi</h4>
<div class="paragraph">
<p>De <strong>POM Nazi</strong> is een Maven plugin die specifieke regels en best  practises forceert: de <strong>maven-enforcer-plugin</strong> in combinatie met de <strong>Pedantic POM enforcers</strong>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="image/pomnazi.jpg" alt="ONE DOES NOT SIMPLY WRITE A MAVEN POM">
</div>
</div>
<div class="paragraph">
<p>Een Maven POM dient de zogeheten <strong>POM Nazi</strong> te gehoorzamen.
Deze  forceert standaardregels en best practises voor een POM, zoals een semi-gealfabetiseerde lijst van dependencies en het invoeren van een <code>dependencyManagement</code> sectie.
De <strong>POM Nazi</strong> detecteert ook dubbele afhankelijkheden die resulteren in dubbele classes op het classpath.</p>
</div>
</div>
<div class="sect3">
<h4 id="_gebruik_de_interne_maven_repository">2.3.4. Gebruik de Interne Maven Repository</h4>
<div class="paragraph">
<p><em>Artifactory</em> is onze interne Maven Repository.
Maven staat bekend om het downloaden van het internet, en Artifactory heeft voor ons een stukje internet alvast gedownload op ons lokale netwerk.
Daarnaast kunnen we onze <strong>closed source</strong> jars uploaden naar een Maven repository zonder deze met de rest van de wereld te hoeven delen.</p>
</div>
<div class="paragraph">
<p>Artifactory beheert verschillende repositories:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">ext-patches-local</dt>
<dd>
<p>repository voor patch releases die wij maken op externe projecten (bijv. hibernate-core-4.4-topicus3.jar)</p>
</dd>
<dt class="hdlist1">ext-releases-local</dt>
<dd>
<p>repository voor releases die wij uploaden of zelf bouwen omdat deze niet in Maven Central staan (bijv. oracle&#8217;s jdbc driver)</p>
</dd>
<dt class="hdlist1">libs-releases-local</dt>
<dd>
<p>repository voor releases van eigen Topicus projecten, inclusief Maven plugins (mogen alleen bibliotheken onder group id <code>nl.topicus</code> in komen)</p>
</dd>
<dt class="hdlist1">libs-snapshots-local</dt>
<dd>
<p>repository voor snapshot releases van eigen Topicus projecten (bijv. cobra), inclusief Maven plugins</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Voorbeeld: Cobra wordt in <strong>en</strong> libs-releases-local gezet (daily builds) <strong>en</strong> in libs-snapshots-local (snapshot builds).</p>
</div>
</div>
<div class="sect3">
<h4 id="_stel_artifactory_in_als_mirror_van_central">2.3.5. Stel Artifactory in als mirror van Central</h4>
<div class="paragraph">
<p>Om onze Artifactory te kunnen gebruiken dien je Maven te vertellen dat 'ie Artifactory moet gebruiken en waar deze dan te vinden is:</p>
</div>
<div class="listingblock">
<div class="title">Een gedeelte uit een settings.xml bestand</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">&lt;?xml version="1.0"?&gt;
&lt;settings&gt;
    &lt;mirrors&gt;
        &lt;mirror&gt;
            &lt;id&gt;topicus-repository&lt;/id&gt;
            &lt;name&gt;Topicus Maven Repository&lt;/name&gt;
            &lt;url&gt;https://repo.topicusonderwijs.nl/artifactory/maven/&lt;/url&gt;
            &lt;mirrorOf&gt;*&lt;/mirrorOf&gt;
        &lt;/mirror&gt;
    &lt;/mirrors&gt;
&lt;/settings&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Het <em>settings.xml</em> bestand moet in de <em>.m2</em> folder staan in je home directory.</p>
</div>
</div>
<div class="sect3">
<h4 id="_voeg_alternatieve_repositories_naast_maven_central_toe">2.3.6. Voeg alternatieve repositories naast Maven Central toe</h4>
<div class="paragraph">
<p>Er is de mogelijkheid om andere repositories naast de repo1-cache in Artifactory aan te maken, zodat Artifactory naar missende jars in die repositories gaat zoeken.
Als je bijvoorbeeld een eigen Wildfly release wilt bouwen heb je mogelijk de jboss-releases-cache nodig omdat daar jars in staan die niet Maven Central staan.</p>
</div>
<div class="paragraph">
<p>Het toevoegen van een extra repository dient altijd voorzien te zijn van een include filter.
Hiermee kan je aangeven dat er alleen artifacts binnen een specifieke group-id geaccepteerd worden uit die repository.
Het probleem is namelijk dat veel repositories vervuild zijn met artifacts die ook op Maven Central voorkomen.
Het kan dan zijn dat we een artifact niet van Central afkrijgen, maar van bijvoorbeeld java.net.
En dat is niet ok, omdat je niet weet of die van java.net de echte release is, iets dat redelijk gegarandeerd wordt vanaf Maven Central.</p>
</div>
<div class="paragraph">
<p>Dus als je een extra repository toevoegt:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Hij moet nuttig zijn voor iedereen. Persoonlijke repo&#8217;s horen in je settings.xml</p>
</li>
<li>
<p>Geef een fatsoenlijke omschrijving van de repo, waar hij voor nodig is en bij wie je moet zijn voor meer uitleg</p>
</li>
<li>
<p>Geef include patterns op, zodat alleen de benodigde artifacts uit die repo gebruikt worden</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wicket_en_hibernate_models">2.4. Wicket en Hibernate models</h3>
<div class="paragraph">
<p>Bij het werken met wicket componenten zul je vaak in aanraking komen met de verschillende models die er bestaan.
Met model bedoelen we hier <em>implementatie van <code>IModel</code></em> zoals <code>PropertyModel</code>, <code>LoadableDetachableModel</code> en <code>DAOModel</code>.</p>
</div>
<div class="sect3">
<h4 id="_wanneer_gebruik_je_welk_model">2.4.1. Wanneer gebruik je welk model</h4>
<div class="paragraph">
<p>Als je even snel wilt opzoeken wanneer je welk model gebruikt kun je onderstaande lijst gebruiken. Voor de uitgebreidere uitleg, zie de paragrafen hieronder.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Model: Voor simpele serialiseerbare objecten zoals <code>int</code>, <code>String</code>, <code>Integer</code> of REST entiteiten in REST client applicaties.</p>
</li>
<li>
<p>LoadableDetachableModel: Voor een model waarvan de waarde elk request ververst moet worden.</p>
</li>
<li>
<p>DAOModel: LoadableDetachableModel implementatie dat een Hibernate/JPA entiteit één keer per request ophaalt uit de database.
Bewaart gewijzigde gegevens niet over requests heen.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Voor bepaalde view entiteiten werkt een DAOModel niet. In dat geval kun je de oudere versie, HibernateModel, gebruiken.</p>
</li>
</ol>
</div>
</li>
<li>
<p>ExtendedHibernateModel: Voor Hibernate/JPA entiteiten waarop je wijzigingen wilt bewaren over requests heen en nieuwe instanties van entiteiten.</p>
</li>
<li>
<p>ChangeRecordingModel: Als ExtendedHibernateModel maar waarbij je de automatische opslaan-logica van het ChangeRecordingModel wilt gebruiken.
Wordt vaak ten onrechte gebruikt waar een EHM bedoeld is.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_imodel">2.4.2. IModel</h4>
<div class="paragraph">
<p>Alle componenten in wicket werken met <code>IModel</code> als bron voor hun data.
Zie bijvoorbeeld de constructor voor <code>Label</code>,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">public Label(final String id, IModel&lt;?&gt; model)</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>IModel</code> is een interface die abstraheert waar de data voor het betreffende component vandaan komt.
De interface heeft slechts twee methoden gedefinieerd, een <code>getObject</code> en een <code>setObject</code>.
Het <em>object</em> is in dit geval de data.
Voor een <code>Label</code> zal dit de tekst zijn die moet worden weergegeven op de pagina.
Een component als een <code>DropDownChoice</code> heeft twee models, één voor de lijst met opties die weergegeven moeten worden en één voor de gekozen waarde.</p>
</div>
<div class="paragraph">
<p>Bij het renderen van een component roept dit de <code>getObject</code> methode aan op zijn model om de data op te halen die het moet weergeven.
De <code>setObject</code> methode wordt gebruikt door <code>FormComponent`s zoals een `TextField</code> of een <code>DropDownChoice</code>.
Als een <code>Form</code> wordt <em>gesubmit</em> worden de ingevoerde waarden van elk component via de <code>setObject</code> methode in het model gezet zodat deze vanaf dan de nieuwe waarde bevat.
In de <code>onSubmit</code> methode van je <code>Form</code> kun je deze waarden dan weer uitlezen via <code>getObject</code> en op de juiste manier verwerken.
Je zet bijvoorbeeld de door de gebruiker in een <code>TextField</code> ingevoerde naam van een leerling op het <code>Leerling</code> object en slaat dit vervolgens op in de database.</p>
</div>
<div class="paragraph">
<p>Zie ook de blogpost van collega Sander Evers, <a href="https://topicusonderwijs.github.io/2016/05/23/Models-are-pointers.html">"Models are pointers"</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_model">2.4.3. Model</h4>
<div class="paragraph">
<p>De simpelste implementatie van <code>IModel</code> is <code>Model</code>.
Dit bevat een <code>Serializable</code> object dat rechtstreeks in het model wordt opgeslagen en bij serialisatie van de pagina in zijn geheel wordt geserialiseerd.
<code>Model</code> biedt een aantal varianten van de <em>factory method</em> <code>of()</code>.
Je kunt dus bijvoorbeeld doen</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">// levert een model op waarvan het object een Boolean is met als waarde true
Model.of(true);

// levert een model op waarvan het object een List is met de getallen 1 t/m 10
List&lt;Integer&gt; lijst = IntStream.rangeClosed(1,10).collect(Collectors.toList());
Model.of(lijst);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_abstractreadonlymodel">2.4.4. AbstractReadOnlyModel</h4>
<div class="paragraph">
<p>Als het object van je model na instantiatie niet meer mag veranderen en het is niet de bedoeling dat dit toch gebeurt, gebruik dan <code>AbstractReadOnlyModel</code>.
Dit model lijkt qua werking op <code>Model</code> maar de <code>setObject</code> methode gooit een <code>UnsupportedOperationException</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_detachen">2.4.5. Detachen</h4>
<div class="paragraph">
<p>Elk <code>IModel</code> is ook <code>IDetachable</code> en dit is waar deze abstractie zijn waarde echt bewijst.
Alle pagina&#8217;s worden bewaard in de sessie van de gebruiker.
Om deze sessie niet te groot te laten worden serialiseert wicket deze pagina&#8217;s voor het ze opslaat in de <em>pagestore</em>.
Hoe groter de pagina&#8217;s des te groter de sessie wordt en dit kan tot problemen leiden op de server waar de applicatie draait.</p>
</div>
<div class="paragraph">
<p>Er zijn een aantal beperkingen aan dit serialiseren.
Zo kunnen niet alle objecten geserialiseerd en gedeserialiseerd worden.
Deze objecten implementeren typisch dan geen <code>Serializable</code>.
Ook betekent dit dat een pagina exact dezelfde data bevat.
Maar de data in de database kan ondertussen veranderd zijn.
De pagina kan geen correcte weergave van de werkelijkheid meer zijn.</p>
</div>
<div class="paragraph">
<p>Om dit op te lossen voert wicket aan het eind van elke renderfase een detachfase uit waarbij de pagina klaar wordt gemaakt voor serialisatie.
Elk component detacht zijn models, dat betekent dat deze models hun data zover weggooien dat ze het later wel weer kunnen herconstrueren.
Voor simpele <code>Model</code>s betekent dit dat er niks gebeurt.
Deze models bevatten een (simpel) <code>Serializable</code> object dat niet verandert tussen twee renders van deze pagina.</p>
</div>
</div>
<div class="sect3">
<h4 id="_loadabledetachablemodel">2.4.6. LoadableDetachableModel</h4>
<div class="paragraph">
<p>Maar stel dat je dataobject heel groot is of kan veranderen.
Je zou een default implementatie van <code>IModel</code> kunnen geven die in de <code>getObject</code> de interessante data ophaalt, bijvoorbeeld het aantal leerlingen dat afgelopen week minimaal twee keer afwezig is geweest.
Maar de <code>getObject</code> methode wordt soms wel tientallen keren per renderfase aangeroepen.
Bijvoorbeeld om te bepalen of het component zichtbaar is, om te bepalen of het groter is dan de waarde van een ander component, etc.
Je wilt niet elke keer een query op de database uitvoeren om dit aantal te bepalen.</p>
</div>
<div class="paragraph">
<p>Hiervoor bestaat het <code>LoadableDetachableModel</code>.
Dit is een <code>abstract</code> model waarvan je de <code>load()</code> methode moet overschrijven.
Deze <code>load()</code> methode wordt gebruikt om het object voor dit model op te halen.
Dit object wordt intern opgeslagen en bij een <code>detach()</code> weggegooid.
Bij de eerstvolgende aanroep van <code>getObject</code> wordt de <code>load()</code> methode gebruikt om het object op te halen en weer intern op te slaan.
Elke volgende aanroep van <code>getObject</code> geeft dan het opgeslagen object terug.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">IModel&lt;Integer&gt; leerlingAantalModel = new LoadableDetachableModel&lt;Integer&gt;()
{
	private static final long serialVersionUID = 1L;

	@Override
	protected Integer load()
	{
		int aantal = 0;
		// Doe hier je operatie om het aantal te bepalen.
		return aantal;
	}

};</code></pre>
</div>
</div>
<div class="paragraph">
<p>Dit betekent dat de zware operatie maar een keer per renderfase wordt uitgevoerd én dat bij een volgende render van dezelfde pagina het aantal opnieuw wordt berekend zodat dit up-to-date is.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Het is verleidelijk om setObject aan te roepen op een <code>LoadableDetachableModel</code> maar doe dat niet. Deze wijziging wordt niet bewaard over requests heen.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_hibernatemodel">2.4.7. HibernateModel</h4>
<div class="paragraph">
<p>Stel nu dat je een Entiteit uit de database wilt halen. Deze zijn om een aantal redenen niet serialiseerbaar, kunnen heel groot zijn en het ophalen is sowieso een database query.
Dit klinkt als een geschikte kandidaat om in een <code>LoadableDetachableModel</code> te stoppen.
Iets als:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">IModel&lt;Leerling&gt; leerlingModel = new LoadableDetachableModel&lt;Integer&gt;()
{
	private static final long serialVersionUID = 1L;

	@Override
	protected Integer load()
	{
		return leerlingDAO.getLeerling(leerlingnummer);
	}
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>Deze opzet is nog een beetje specifiek voor het component waar hij in zit en het leerlingnummer dat <em>ergens</em> vandaan komt.
Als we dit nu een beetje algemeen opzetten dan komen we uit bij het <code>HibernateModel</code>.
In de basis is dit een soort van <code>LoadableDetachableModel</code> die werkt op entiteiten (<code>IdObject</code>s).
Intern slaat het de id en de klasse op van zijn object en bij de <code>load()</code> wordt aan de hand hiervan de juiste entiteit uit de database gehaald.</p>
</div>
<div class="paragraph">
<p>Een <code>HibernateModel</code> instantieer je niet rechtstreeks maar via de <code>ModelFactory</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">IModel&lt;Leerling&gt; leerlingModel = ModelFactory.getModel(leerling);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_daomodel">2.4.8. DAOModel</h4>
<div class="paragraph">
<p><code>DAOModel</code> is een nieuwe versie van het oude vertrouwde <code>HibernateModel</code> specifiek geschikt voor jpa-dao gebaseerde entiteiten. Alles dat afstamt van <code>IEntiteit</code> kun je hier instoppen. In de praktijk komt dit neer op alle entiteiten behalve een paar verdwaalde view entiteiten die een <code>String</code> id hebben.</p>
</div>
<div class="paragraph">
<p><code>DAOModel</code>s werken ook voor applicaties die geen cobra kitchensink applicatie zijn, in tegenstelling tot <code>HibernateModel</code>.</p>
</div>
<div class="paragraph">
<p>Een <code>DAOModel</code> kun je rechtstreeks instantieren maar beter is het om de <code>JpaModelFactory</code> te gebruiken.
Deze valt terug op <code>HibernateModel</code> voor entiteiten die geen <code>IEntiteit</code> zijn maar wel een <code>IdObject</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">IModel&lt;Leerling&gt; leerlingModel = JpaModelFactory.model(leerling);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_extendedhibernatemodel">2.4.9. ExtendedHibernateModel</h4>
<div class="paragraph">
<p>Wanneer de gegevens van jouw Hibernate entiteit niet gewijzigd worden door je componenten, gebruik je het eenvoudige HibernateModel.
Echter wanneer je componenten de gegevens van je Hibernate entiteit wel wijzigen moet je het ExtendedHibernateModel gebruiken.
Dit model is speciaal geschreven voor nieuwe entiteiten of wijzigingen op bestaande enteiten.</p>
</div>
<div class="paragraph">
<p>Een <code>HibernateModel</code> kan wijzigingen op de entiteit niet bewaren omdat het deze entiteit bij elke <code>load()</code> vers uit de database haalt.
Ook kan het geen entiteiten bevatten die nog niet bestaan in de database.
Deze entiteiten hebben namelijk nog geen id en bij het detachen kan het <code>HibernateModel</code> ze dus niet weggooien.
Daardoor blijft dit model deze entiteit bevatten met serialisatiefouten op je pagina tot gevolg.</p>
</div>
<div class="paragraph">
<p>Het idee van het <code>ExtendedHibernateModel</code> is dat het bij het detachen alle velden van de entiteit los bewaart, deze velden op <code>null</code> zet en vervolgens de entiteit weggooit uit het model.
Bij het laden van de entiteit wordt eerst de entiteit uit de database gehaald en daarna worden alle velden een voor een weer teruggezet op de entiteit.
Op deze manier blijven wijzigingen bewaard.
Dit werkt ook voor nieuw aangemaakte (nog niet opgeslagen) entiteiten.</p>
</div>
<div class="paragraph">
<p>Stel je de volgende code voor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">Leerling leerling = extendedLeerlingModel.getObject();
School school = schoolDAO.getByBRIN("99SS");
leerling.setSchool(school);
leerling.getToetsResultaat().setScore(99);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Deze <code>Leerling</code> verwijst zowel naar een <code>School</code> als naar een <code>ToetsResultaat</code>.
De referentie naar de school wordt aangepast naar een andere school (andere instantie van het type school).
Van het toetsresultaat van deze leerling wordt de score aangepast.</p>
</div>
<div class="paragraph">
<p>In dit geval willen we waarschijnlijk naast de leerling ook alle wijzigingen op <code>ToetsResultaat</code> bewaren.
Anders is die gewijzigde score na het volgende request in het niets verdwenen.
Maar van de school willen we waarschijnlijk alleen de <em>referentie</em> naar de school (m.a.w., de waarde van het veld <code>school</code> van het leerlingobject) bewaren.</p>
</div>
<div class="paragraph">
<p>Voor dit soort situaties is het <code>FieldPersistanceFilter</code> bedacht.
Die filter geeft aan van welke typen (klassen) de waarden van de velden bewaard worden.</p>
</div>
<div class="paragraph">
<p>Als je een verzameling entiteiten ziet als een <a href="https://en.wikipedia.org/wiki/Graph_(discrete_mathematics)">graafstructuur</a> dan geeft het <code>FieldPersistanceFilter</code> aan tot waar de graaf moet worden gevolgd vanaf het <em>root</em> element (het object van het <code>ExtendedHibernateModel</code>).
Het <code>ExtendedHibernateModel</code> volgt de graaf van relaties vanaf het <em>root</em> object en bij elke nieuwe entiteit beoordeeld het:
- Zit de klasse van deze entiteit in het filter, dan moet ik dit object managen en maak ik er een <code>ExtendedHibernateModel</code> voor aan (en die volgt weer alle relaties vanaf dit object).
- Zo nee, dan hoef ik het niet te managen, maak ik er een gewoon <code>HibernateModel</code> voor aan.</p>
</div>
<div class="paragraph">
<p>Zie <code>DefaultFieldPersistanceFilter</code> voor de default implementatie van een dergelijk filter.
Meestal maak je zelf geen <code>FieldPersistanceFilter</code> aan maar gebeurt dat door de <code>ModelManager</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_modelmanager">2.4.10. ModelManager</h4>
<div class="paragraph">
<p>Het enige dat je nu nog mist om een <code>ExtendedHibernateModel</code> te maken is een <code>ModelManager</code>.
Deze manager zorgt ervoor dat er van elke entiteit maar één <code>ExtendedModel</code> tegelijk bestaat.
Meerdere <code>HibernateModel</code>s van dezelfde entiteit, bijvoorbeeld dezelfde leerling, zijn geen probleem.
Op het moment dat je op het ene model <code>getObject</code> aanroept wordt de leerling opgehaald en op het moment dat je op het andere model <code>getObject</code> aanroept wordt diezelfde leerling nog een keer opgehaald.
De hibernate sessie zorgt er voor dat er van elke entiteit maar een instantie tegelijk rondslingert dus je krijgt elke keer dezelfde leerling terug.</p>
</div>
<div class="paragraph">
<p>Maar stel nu dat je van dezelfde leerling twee <code>ExtendedModel</code>s hebt aangemaakt, model A en B.
Eerst wordt model A gedetacht, bewaart de waarden van alle velden van de leerling en zet deze op <code>null</code>.
Vervolgens wordt model B gedetacht en bewaart de waarden van alle velden van de leerling (<code>null</code> dus!).</p>
</div>
<div class="paragraph">
<p>Bij het attachen gaat het misschien wel toevallig in dezelfde volgorde.
Dus eerst gaat model A en zet keurig netjes alle waarden van de leerling terug.
Vervolgens gaat model B, die heeft dezelfde leerling (onthoud: er is altijd maar één instantie van die leerling) en die zet alle <code>null</code> waarden terug.
Nu ineens is elk veld van die leerling <code>null</code> terwijl beide models zeggen dat hij geattacht is.
Dit leidt tot de meest onverklaarbare fouten, van NPEs tot erger, en is duidelijk niet wat we willen.</p>
</div>
<div class="paragraph">
<p>Daarom is er een <code>ModelManager</code> die ervoor zorgt dat er van elke entiteit maar één extended model wordt gemaakt.
Je maakt voor je hele pagina één <code>ModelManager</code> aan en laat de rest door deze modelmanager regelen.
Elk <code>ExtendedHibernateModel</code> vraagt voor al zijn velden aan de modelmanager om hier een model voor op te leveren.
De modelmanager besluit op basis van een meegegeven lijst te managen entiteitklassen of dit een <code>ExtendedHibernateModel</code> of een gewoon <code>HibernateModel</code> moet zijn.</p>
</div>
<div class="paragraph">
<p>De modelmanager slaat alle aangemaakte extended models ook op in zijn modelcache zodat als er op een later moment wederom om een model voor dezelfde entiteit wordt gevraagd de manager hetzelfde model kan opleveren.
Dit voorkomt de bovengenoemde problemen.</p>
</div>
<div class="paragraph">
<p>Overigens is het geen probleem om gewone <code>HibernateModel</code>s te hebben van een entiteit waarvan al een <code>ExtendedHibernateModel</code> bestaat.
De "there can be only one" regel geldt alleen voor <code>ExtendedHibernateModel</code>s per entiteit (en voor de <code>ModelManager</code> globaal voor de hele pagina).</p>
</div>
<div class="paragraph">
<p>Een <code>ModelManager</code> is simpel te instantieren. Voor bovenstaande voorbeeld met een leerling, een school en een toetsresultaat:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">ModelManager manager = new DefaultModelManager(Leerling.class, ToetsResultaat.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Dit maakt een <code>DefaultModelManager</code> aan dat velden wel of niet persisteerd volgens een <code>DefaultFieldPersistanceFilter</code>.
Van velden die een <code>Leerling</code> of een <code>Toetsresultaat</code> bevatten en die moeten worden bewaard wordt de waarde bij het detachen in een <code>ExtendedHibernateModel</code> gestopt.
De waarden van andere velden die entiteiten bevatten worden in een gewoon <code>HibernateModel</code> gestopt.
Velden die niet-entiteiten maar wel <code>Serializable</code> objecten bevatten worden in een gewoon <code>Model</code> gestopt.</p>
</div>
<div class="paragraph">
<p>Deze models worden door het <code>ExtendedHibernateModel</code> bijgehouden zodat hij de waarden kan terugzetten bij het attachen.</p>
</div>
<div class="paragraph">
<p>Hoe maak je dan een <code>ExtendedHibernateModel</code> aan?
Simpel:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">ModelManager manager = new DefaultModelManager(Leerling.class, ToetsResultaat.class);
ExtendedModel model = ModelFactory.getModel(object, manager);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_changerecordingmodel">2.4.11. ChangeRecordingModel</h4>
<div class="paragraph">
<p>#TODO</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_gebruik_componenten_uit_cobra_webcomponents">2.5. Gebruik componenten uit Cobra Webcomponents</h3>
<div class="paragraph">
<p>De Cobra bibliotheek <em>Webcomponents</em> bevat een enorme hoeveelheid aan componenten die je in je applicaties kan inzetten voor profit.
In deze sectie vind je een korte beschrijving van de componenten die wat extra uitleg nodig hebben.</p>
</div>
<div class="sect3">
<h4 id="_gebruik_cobramodalwindow_als_alternatief_voor_wicket_s_modalwindow">2.5.1. Gebruik CobraModalWindow als alternatief voor Wicket&#8217;s ModalWindow</h4>
<div class="paragraph">
<p>Het Wicket ModalWindow is een component dat z&#8217;n beste tijd wel gehad heeft.
In het verleden was dit een aardige component met resizability en custom content in verschillende vormen.
Echter deze is niet echt met de tijd meegegaan en was erg lastig om zelf te voorzien van een alternatieve styling.
Daarom is in Cobra een eigen ModalWindow gebouwd met een andere focus specifiek voor onze applicaties.</p>
</div>
<div class="sect4">
<h5 id="_voeg_een_modalwindowcontainer_aan_je_pagina_toe">Voeg een ModalWindowContainer aan je pagina toe</h5>
<div class="paragraph">
<p>Je kan niet zomaar een <code>CobraModalWindow</code> gebruiken in je pagina&#8217;s.
Deze heeft een container nodig om zich zelf te kunnen renderen.
Hiertoe dien je dus een <code>ModalWindowContainer</code> aan je pagina toegevoegd te hebben.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">public class MyPage extends WebPage {
    public MyPage() {
        add(new ModalWindowContainer("modal-window-container", this));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>en in je markup:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html">&lt;div wicket:id="modal-window-container"&gt;&lt;/div&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Dit zorgt ervoor dat de content van het modal window gerenderd kan worden.
Je hebt er maar één per pagina nodig.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_voeg_je_modalwindow_toe">2.5.2. Voeg je ModalWindow toe</h4>
<div class="paragraph">
<p>TODO: had dit nodig voor onderstaande stuk.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_toon_tabelachtige_data_met_een_customdatapanel">2.6. Toon tabelachtige data met een CustomDataPanel</h3>
<div class="sect3">
<h4 id="_benodigdheden_voordat_je_een_customdatapanel_kan_gebruiken">2.6.1. Benodigdheden voordat je een CustomDataPanel kan gebruiken</h4>
<div class="paragraph">
<p>Je kan niet zomaar een <code>CustomDataPanel</code> aan je pagina toevoegen omdat er in het CustomDataPanel gebruik gemaakt wordt van <code>CobraModalWindow</code> en deze hebben een <code>ModalWindowContainer nodig</code>.
Zie de sectie over <code>CobraModalWindow</code> om meer hierover te lezen.</p>
</div>
<div class="paragraph">
<p>Daarnaast dien je in je internationalisatie resource bundles de volgende te vertalen keys op te nemen:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>volgende=vertaling van volgende
vorige=vertaling van vorige</pre>
</div>
</div>
<div class="paragraph">
<p>Zonder deze zaken zal je een runtime error krijgen bij het renderen van je pagina.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_internationalisatie">2.7. Internationalisatie</h3>
<div class="paragraph">
<p>Internationalisatie betreft het aanbieden van teksten en converteren van waardes zodat deze overeenkomen met de ingestelde taal van de gebruiker van de applicatie.
Omdat onze applicaties tegenwoordig via een REST-API worden ontsloten zijn er twee implementaties van internationalisatie:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>één voor de REST-laag zodat we geïnternationaliseerde teksten uit de API kunnen opleveren, en</p>
</li>
<li>
<p>één voor de Wicket laag die gebruik maakt van de standaard Wicket methodieken voor het vinden van de juiste vertalingen.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Hieronder staat uitgebreider uitgelegt hoe je gebruik kan maken van beide implementaties.</p>
</div>
<div class="sect3">
<h4 id="_i18n_in_een_rest_api">2.7.1. i18n in een REST-API</h4>
<div class="paragraph">
<p>Omdat je in de REST-laag geen beschikking hebt over Wicket en daarom geen gebruik kan maken van de resource-resolutie die Wicket aanbiedt, is er een <code>JavaI18N</code> class gemaakt die gebruik maakt van de standaard <em>resource bundles</em> van Java.</p>
</div>
<div class="paragraph">
<p>Hieronder een aantal gebruiken van de <code>JavaI18N</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">JavaI18N.of(Geslacht.Man, "aanhef").toString(); // "dhr."

JavaI18N.of(Geslacht.Man).using(Locale.ENGLISH).toString(); // "sir"</code></pre>
</div>
</div>
<div class="paragraph">
<p>De <code>JavaI18N</code> class maakt gebruik van het zogeheten <em>builder</em> of <em>fluent interface</em> patroon om de API toegankelijker te maken.
Je begint met <code>JavaI18N.of()</code> en geeft deze de sleutel waar je de resource string van wilt opzoeken.
Standaard wordt er gebruik gemaakt van de default locale, maar je kan die aanpassen zoals in het tweede voorbeeld aangegeven met <code>using(locale)</code>.</p>
</div>
<div class="listingblock">
<div class="title">test_en.properties</div>
<div class="content">
<pre class="pygments highlight"><code>datum.duiding=Today, {0,date,MM\, dd yyyy}, it is {1}-day</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">JavaI18N.of("datum.duiding")
    .with(new Date())
    .with("Pi")
    .using(Locale.ENGLISH)
    .toString(); // "Today, 03, 15 2014, it is Pi-day"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Hier wordt de tekst voor <code>datum.duiding</code> vertaald naar het Engels voor π-dag.</p>
</div>
<div class="paragraph">
<p>Meertalige meervoudsvormen zijn ook mogelijk met deze JavaI18N implementatie.
De volgende properties bestanden tonen de geïnternationaliseerde vormen van het wel bekende liedje "Ik heb het potje met vet al op de tafel gezet" voor het Nederlands:</p>
</div>
<div class="listingblock">
<div class="title">test_nl.properties</div>
<div class="content">
<pre class="pygments highlight"><code>bier=Er {0,choice,0#zijn geen potjes|1#is 1 potje|1&lt;zijn {0, number, integer} potjes} met vet op tafel gezet</code></pre>
</div>
</div>
<div class="paragraph">
<p>En het equivalent in het Engels:</p>
</div>
<div class="listingblock">
<div class="title">test_en.properties</div>
<div class="content">
<pre class="pygments highlight"><code>bier={0,choice,0#No more bottles|1#1 bottle|1&lt;{0, number, integer} bottles} of beer on the wall</code></pre>
</div>
</div>
<div class="paragraph">
<p>Het is mogelijk om deze strings volledig geparameteriseerd te gebruiken zodat je bijvoorbeeld enkelvoud en meervoud kan gebruiken in je geïnternationaliseerde teksten:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">assertThat(JavaI18N.of("bier").with(0), is("Er zijn geen potjes met vet op tafel gezet"));
assertThat(JavaI18N.of("bier").with(1), is("Er is 1 potje met vet op tafel gezet"));
assertThat(JavaI18N.of("bier").with(10), is("Er zijn 10 potjes met vet op tafel gezet"));

assertThat(JavaI18N.of("bier").using(Locale.ENGLISH).with(0),
    is("No more bottles of beer on the wall"));
assertThat(JavaI18N.of("bier").using(Locale.ENGLISH).with(1), is("1 bottle of beer on the wall"));
assertThat(JavaI18N.of("bier").using(Locale.ENGLISH).with(10),
    is("10 bottles of beer on the wall"));</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
In tegenstelling tot de i18n variant in Wicket (zie hieronder), kan JavaI18N voor het bepalen van de Locale niet terugvallen op de Locale uit de sessie.
Je zult dus altijd zelf een Locale mee moeten geven d.m.v. de methode <code>using(Locale)</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_i18n_in_de_wicket_laag">2.7.2. i18n in de Wicket laag</h4>
<div class="paragraph">
<p>De meeste internationalisatie zaken werken automatisch in Wicket, daarvoor kan je het beste <em>Wicket in Action</em> lezen, ook als je wilt weten hoe resource resolutie in elkaar zit.</p>
</div>
<div class="paragraph">
<p>Voor internationalisatie kan je Wicket&#8217;s <code>ResourceModel</code> gebruiken, of zelfs het <code>StringResourceModel</code>.
Om dit gebruik te vereenvoudigen is er de class <code>I18N</code> gemaakt (in Cobra).
Deze werkt hetzelfde als de I18N voor de REST-laag, alleen gebruikt deze intern het Wicket <code>StringResourceModel</code> in plaats van JDK message bundles.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">public AfspraakTable()
{
    column().forProperty("titel").heading(I18N.of("table.head.titel")).build();
    column().forProperty("omschrijving").heading(I18N.of("table.head.omschrijving")).build();
    column().forProperty("afspraakType").heading(I18N.of("table.head.type")).build();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Je kan de I18N instantie ook gewoon meegeven aan een Wicket component als model:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">add(new Label("bier", I18N.of("bier").with(10)));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ook aan deze I18N kan je parameters geven, maar vooralsnog worden de uitgebreide expressies van de JDK message bundles niet ondersteund.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="ulist">
<ul>
<li>
<p>Fun we can not make it easier</p>
</li>
<li>
<p>Fun on ne peut pas faire plus simple</p>
</li>
<li>
<p>Spaß können wir nicht machen es einfacher</p>
</li>
<li>
<p>Leuker kunnen we het niet maken, wel makkelijker.</p>
</li>
</ul>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Met deze hulpmiddelen voor internationalisatie is er geen reden meer om je applicaties niet te voorzien van de mogelijkheid om meerdere talen te ondersteunen.</p>
</div>
</div>
<div class="sect3">
<h4 id="_verschillende_magische_manieren_om_je_componenten_te_localizen">2.7.3. Verschillende magische manieren om je componenten te localizen</h4>
<div class="paragraph">
<p>Met de <code>CobraLocalizer</code> en de <code>CobraStringResourceLocator</code> kan je je componenten op verschillende manieren localizen.
Deze twee dien je in je <code>WicketApplication</code> te installeren, en dan krijg je extra mogelijkheden om je componenten te voorzien van geïnternationaliseerde teksten.</p>
</div>
<div class="paragraph">
<p>Zo worden onderstaande mogelijkheden toegevoegd met de `CobraStringResourceLocator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>EnumCombobox-Geslacht.nullValid=Kies een geslacht...
EnumCombobox-Rijping.nullValid=Kies de rijping van de kaas...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Dit heeft het formaat <code>componenttype</code>-<code>modeltype</code>.<code>label|description|null|nullValid|...</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_less_gebruiken_voor_stylesheets">2.8. Less gebruiken voor stylesheets</h3>
<div class="paragraph">
<p><em>Less CSS</em> is een CSS preprocessor die het makkelijk maakt om herbruikbare CSS te bouwen.
Less bestanden zijn eigenlijk gewone CSS bestanden, maar met extra syntax die het onderhouden van CSS een stuk eenvoudiger maakt.</p>
</div>
<div class="paragraph">
<p>Een alternatief voor Less is <em>SASS</em> (eventueel in combinatie met <em>Compass</em>), maar dit is gebaseerd op Ruby en dat integreert wat minder goed dan Less met de gebruikte toolchain in Cobra applicaties.
In deze sectie wordt beschreven hoe je Less het beste kan integreren in je (Wicket) Cobra applicatie.</p>
</div>
<div class="paragraph">
<p>Je kan Less bestanden op drie manieren gebruiken in je applicatie:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Direct als resource opnemen in je Wicket pagina&#8217;s, en less gebruiken in de browser in combinatie met Less.js</p>
</li>
<li>
<p>Als LessResource opnemen in je Wicket pagina&#8217;s en de less server side compileren naar CSS</p>
</li>
<li>
<p>Tijdens het bouwproces de Less bestanden compileren naar CSS en de CSS bestanden opnemen als resources.</p>
</li>
</ol>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Optie 2 is ernstig af te raden aangezien Less compilatie seconden kan duren.
Overweeg dan ook sterk optie 3 omdat dit met de Maven integratie in Eclipse praktisch geen overhead oplevert tijdens ontwikkeling en helemaal geen overhead in productie.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In deze sectie zullen we dus alleen optie 3 behandelen.</p>
</div>
<div class="sect3">
<h4 id="_less_compileren_naar_css_vanuit_maven">2.8.1. Less compileren naar CSS vanuit Maven</h4>
<div class="paragraph">
<p>Bij het compileren van Less naar CSS in Maven maken we gebruik van de <em>org.less:lesscss-maven-plugin</em>.
Deze plugin combineert en vertaalt de individuele Less bestanden naar één (of meer) CSS bestanden.</p>
</div>
<div class="paragraph">
<p>Je neemt de volgende plugin definitie op in je <code>pluginManagement</code> sectie:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">&lt;plugin&gt;
  &lt;groupId&gt;org.lesscss&lt;/groupId&gt;
  &lt;artifactId&gt;lesscss-maven-plugin&lt;/artifactId&gt;
  &lt;configuration&gt;
    &lt;sourceDirectory&gt;${project.basedir}/src/main/resources/assets/less&lt;/sourceDirectory&gt; <i class="conum" data-value="1"></i><b>(1)</b>
    &lt;outputDirectory&gt;${project.build.directory}/classes/assets/stylesheets&lt;/outputDirectory&gt; <i class="conum" data-value="2"></i><b>(2)</b>
    &lt;compress&gt;true&lt;/compress&gt;
    &lt;encoding&gt;utf-8&lt;/encoding&gt;
    &lt;includes&gt;
      &lt;include&gt;**/*.less&lt;/include&gt; <i class="conum" data-value="3"></i><b>(3)</b>
    &lt;/includes&gt;
  &lt;/configuration&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>waar de less bestanden staan</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>waar de gegenereerde CSS bestanden komen</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>welke less bestanden gecompileerd moeten worden</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Deze definitie vertelt de lesscss-maven-plugin waar de Less bestanden staan, waar deze neergezet moeten worden nadat ze samengevoegd, gecompileerd en in dit geval gecomprimeerd zijn (de vlag <code>compress</code>).</p>
</div>
<div class="paragraph">
<p>Let op met het gebruik van een wildcard compilatie zoals in dit voorbeeld is gebruikt.
Hiermee compileer je alle less bestanden individueel, mogelijk dat dit compilatiefouten oplevert als je niet alle includes goed hebt staan.
Beter kan je één <code>.less</code> bestand opnemen die de rest als modules includeert zodat je uiteindelijk ook maar één .css bestand in je pagina op hoeft te nemen.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
deze configuratie zet de gecompileerde CSS op het class path.
Je kan ook direct in de WEB-INF/ folder van de WAR archive genereren en dan met een context relative resource ernaar verwijzen.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Je kan in de Less bestanden gewoon relatieve includes gebruiken zonder dat je dit op hoeft te nemen in deze POM configuratie.
De plugin zal deze includes dan samenvoegen tot één bestand.</p>
</div>
</div>
<div class="sect3">
<h4 id="_gegenereerde_less_css_bestanden_gebruiken_in_wicket">2.8.2. Gegenereerde Less CSS bestanden gebruiken in Wicket</h4>
<div class="paragraph">
<p>De CSS bestanden die gegenereerd zijn in de vorige stap staan nu op het class path.
In de Cobra module <em>web-components</em> zit een class voor het eenvoudig kunnen mappen van JavaScript en CSS resources: de <code>AssetsResourceMapper</code>. Deze registreer je bij Wicket in de <code>init</code> methode van je Application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">public class MijnApplication extends WebApplication {
    @Override
    public void init() {
        // ...
        mount(new AssetsResourceMapper(AssetsMarker.class));
        // ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>De <code>AssetsResouceMapper</code> heeft een parameter voor de constructor nodig: de marker.
De marker is een lege class die in dezelfde package staat als je (less) resources (maar wel in gescheiden paden).
Bijvoorbeeld:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">package assets;

/**
 * Marker voor web assets (css, less, js).
 */
public class AssetsMarker {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Nu we een marker hebben kunnen we ook de gecompileerde resources aan onze pagina(s) toevoegen:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">public abstract class AbstractSecurePage {
    // ...
    @Override
    protected void renderHead(IHeaderResponse response) {
        response.render(CssHeaderItem.forReference(new PackageResourceReference(
                AssetsResourceMarker.class, "stylesheets/base.css")));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Je kan de stylesheets direct benaderen door aan je resource reference relatief ten opzichte van de <code>AssetsResourceMarker</code> te refereren.
Vergeet niet de juiste subfolder op te nemen, namelijk de folder waarin je de gecompileerde resources neer laat zetten.</p>
</div>
<div class="paragraph">
<p>Houd er rekening mee dat dit alleen de less bestanden compileert en neerzet in de stylesheets folder.
Als je ook nog losse .css bestanden naast je .less bestanden hebt staan kan je die het beste een .less extensie geven (.less is een superset van .css) en op deze manier ze te compileren.
Met een beetje geluk kan je dan ook nog eens je css optimaliseren door bestanden samen te voegen.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_keuringsdienst_van_cobra_kwaliteitstests">2.9. Keuringsdienst van Cobra: kwaliteitstests</h3>
<div class="paragraph">
<p>Omdat we met z&#8217;n allen nogal complexe software maken die kritische bedrijfsprocessen van onze klanten ondersteunt, is een goede kwaliteitsbewaking noodzakelijk.
In Cobra zitten daarom een aantal standaard tests die de kwaliteit van onze software proberen te bewaken door slechte idiomen te ontdekken en te verbieden.
Zo is in een server applicatie het niet handig om uitvoer naar de console (stdout of stderr) te sturen, omdat dit beter via een door de server gemanaged logsysteem kan gebeuren. Hierdoor verdwijnt de log niet naar een ongedefinieerde lokatie, maar komt dit netjes in een folder of speciale logging server terecht.</p>
</div>
<div class="paragraph">
<p>Cobra is een raamwerk dat niet beschikt over jouw specifieke applicatie code, dus om deze tests te gebruiken moet je ze zelf aanzetten in jouw project. Hieronder een overzicht van de verschillende tests.</p>
</div>
<div class="sect3">
<h4 id="_controleer_je_html_met_de_abstracthtmltest">2.9.1. Controleer je HTML met de AbstractHtmlTest</h4>
<div class="paragraph">
<p>De <code>AbstractHtmlTest</code> is bedoeld om veel voorkomende problemen in de HTML bestanden voor Wicket componenten en pagina&#8217;s te voorkomen.
Zo controleert deze test of je wel je <code>&lt;select&gt;</code> tags een corresponderende expliciete <code>&lt;/select&gt;</code> sluittag hebben.
Deze sluittag is nodig omdat Wicket (in het verleden) tags van de vorm <code>&lt;tag /&gt;</code> niet omschreef naar <code>&lt;tag&gt;&lt;/tag&gt;</code>.
De HTML <code>&lt;select&gt;</code> tag heeft die wel nodig omdat er tussen die tags de keuzes gerenderd moeten worden.</p>
</div>
<div class="paragraph">
<p>De HTML-test controleert de volgende zaken:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>matchende <code>&lt;select&gt;</code> en <code>&lt;/select&gt;</code> tags</p>
</li>
<li>
<p>matchende <code>&lt;div&gt;</code> en <code>&lt;/div&gt;</code> tags</p>
</li>
<li>
<p>matchende <code>&lt;span&gt;</code> en <code>&lt;/span&gt;</code> tags</p>
</li>
<li>
<p><code>&lt;input&gt;</code> tags die een sluit tag hebben, want dat is illegale HTML</p>
</li>
<li>
<p>juiste <code>&lt;html&gt;</code> tag met een namespace voor <em>wicket-tags</em>, om zo minder warnings in de code te krijgen.
De juiste <code>&lt;html&gt;</code> tag is dan ook: <code>&lt;html xmlns:wicket="http://wicket.apache.org"&gt;</code></p>
</li>
<li>
<p>of alle HTML bestanden door de Wicket parser verwerkt kunnen worden (of bijv. elk HTML bestand een corresponderende Java class heeft)</p>
</li>
<li>
<p>geen tags met een <code>style=""</code> attribuut</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Je kan de test aanzetten door over te erven van de <code>AbstractHtmlTest</code>, de vereiste <code>getPackageNames</code> methode te implementeren en deze test dan te runnen in je Eclipse omgeving.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">public class HtmlTest extends AbstractHtmlTest {
    @Override
    protected List&lt;String&gt; getPackageNames()
    {
        return Arrays.asList("nl.topicus.applicatienaam");
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Er is geen draaiende server nodig om deze test te kunnen runnen.</p>
</div>
</div>
<div class="sect3">
<h4 id="_controleer_je_code_op_foute_methode_aanroepen_met_de_discouragedmethodtest">2.9.2. Controleer je code op foute methode aanroepen met de DiscouragedMethodTest</h4>
<div class="paragraph">
<p>In een complexe omgeving zoals de applicaties die wij maken wordt een hoop code geschreven, en ook bibliotheken gebruikt.
In de loop der jaren is gebleken dat sommige methodes uit de Java standaard bibliotheek niet handig zijn, of het direct gebruiken van de Hibernate APIs een belemmering vormen voor verdere ontwikkeling van onze code.
Om verkeerd gebruik van externe en interne bibliotheken te voorkomen is de <em>DiscouragedMethodTest</em> bedacht die alle code doorspit en controleert of er methodes aangeroepen worden die beter niet gebruikt kunnen worden.
Elke controle geeft aan hoe je de code beter kan schrijven, dus gebruik deze test vooral!</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">public class DiscouragedMethodTest extends AbstractDiscouragedMethodTest {
    @Override
    protected List&lt;String&gt; getPackageNames()
    {
        return Arrays.asList("nl.topicus.applicatienaam");
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Mocht je een uitzondering hebben voor een bepaalde methode die je wel <em>moet</em> aanroepen, kan je met een annotatie op je class aangeven welke methode uitgezonderd is.
Dit zijn natuurlijk uitzonderingen.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">@AllowedMethods({
    "public abstract java.lang.Object org.hibernate.Criteria.uniqueResult() throws org.hibernate.HibernateException",
    "public abstract java.util.List org.hibernate.Criteria.list() throws org.hibernate.HibernateException",
    "public abstract org.hibernate.Criteria org.hibernate.Session.createCriteria(java.lang.Class)",
    "public abstract org.hibernate.Criteria org.hibernate.Session.createCriteria(java.lang.Class,java.lang.String)"})
@CriteriaMethodsAllowed
public abstract class AbstractZoekFilterDataAccessHelper&lt;T extends IdObject, ZF extends DetachableZoekFilter&lt;T&gt;&gt;
        extends HibernateDataAccessHelper&lt;T&gt; implements BatchZoekFilterDataAccessHelper&lt;T, ZF&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_controleer_je_code_op_entiteit_referenties_in_componenten_en_meer">2.9.3. Controleer je code op Entiteit referenties in Componenten en meer</h4>
<div class="paragraph">
<p>Om de vervelende en soms onvoorspelbare Hibernate exceptions zoals de <code>LazyInitException</code> te voorkomen hebben we verboden om entiteiten direct op te nemen als een veld in Wicket componenten.
Omdat Wicket componenten geserialiseerd worden aan het einde van een request, en daarna weer gedeserialiseerd, nemen directe entiteiten de persistence context van het vorige request mee. Als je dan iets met deze entiteit wilt doen in het nieuwe request, krijg je een Hibernate exception dat de context verlopen is.</p>
</div>
<div class="paragraph">
<p>De <code>AbstractEntityReferenceTest</code> controleert je code op ongewenste verwijzingen naar entiteiten.
Niet alleen Wicket componenten mogen niet direct naar een Entiteit verwijzen, maar ook bijvoorbeeld zoekfilters, models en behaviors.
Je dient die altijd te wrappen in een Hibernate-aware model (via bijvoorbeeld de <code>ModelFactory</code>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">public FoobarModel extends Model&lt;Foo&gt;
{
    private Leerling leerling;

    public FoobarModel(Leerling leerling)
    {
        this.leerling = leerling;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Bovenstaande code is een model dat direct verwijst naar een leerling entiteit.
Dit is niet handig omdat models aan de componentenboom worden gekoppeld, en dus geserialiseerd, en daarmee vatbaar zijn voor de Hibernate exceptions.
Een <code>LoadableDetachableModel</code> en models zoals het <code>HibernateModel</code> zijn speciaal bedoeld om een referentie vast te houden totdat ze gedetacht worden, zodat deze wel werken met serializatie.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">public class EntityReferenceTest extends AbstractEntityReferenceTest
{
    @Test
    public void checkBehaviorsForEntityReferences()
    {
        doTest("nl/topicus/...", Behavior.class, Entiteit.class);
    }

    @Test
    public void checkComponentsForEntityReferences()
    {
        doTest("nl/topicus/...", Component.class, Entiteit.class);
    }

    @Test
    public void checkModelsForEntityReferences()
    {
        doTest("nl/topicus/...", IModel.class, Entiteit.class);
    }

    @Test
    public void checkZoekfiltersForEntityReferences()
    {
        doTest("nl/topicus/...", AbstractZoekFilter.class, Entiteit.class);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_controleer_de_annotaties_van_je_pagina_s_met_de_abstractpagetest">2.9.4. Controleer de annotaties van je pagina&#8217;s met de AbstractPageTest</h4>
<div class="paragraph">
<p>Voor het (oude) rechtensysteem is het noodzakelijk om je pagina&#8217;s met de juiste annotaties te voorzien van rechten, en deze moeten consistent zijn met de policy-bestanden.</p>
</div>
<div class="paragraph">
<p>De <code>AbstractPageTest</code> controleert je annotaties en geeft fouten wanneer die niet kloppen.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">public class PageTest extends AbstractPageTest
{
    @Override
    protected List&lt;String&gt; getPackageNames()
    {
        return Arrays.asList("nl.topicus.applicatienaam");
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_samenvatting">2.10. Samenvatting</h3>
<div class="paragraph">
<p>Met Cobra kunnen we snel en makkelijk goed onderhoudbare applicaties maken die een soortgelijk ontwikkelprofiel hebben zodat je snel thuis bent in een willekeurig project.
Cobra biedt een bibliotheek aan componenten en handige functies, maar ook een raamwerk voor het ontwikkelen van Topicus Onderwijs applicaties.</p>
</div>
<div class="paragraph">
<p>In de komende hoofdstukken zie je de verschillende onderliggende
technologieën die Cobra ontsluit nader uitgelegd.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_beginnen_met_de_rest_architectuur">3. Beginnen met de REST architectuur</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Het starten van een nieuw project binnen de REST architectuur waarbij
je altijd via een REST-API communiceert met de database is niet super
eenvoudig, dus in dit hoofdstuk nemen we een nieuwe applicatie als
voorbeeld: de kaaswinkel uit <em>Wicket in Action</em>.</p>
</div>
<div class="sect2">
<h3 id="_de_kaaswinkel">3.1. De kaaswinkel</h3>
<div class="paragraph">
<p>De kaaswinkel is een eenvoudig project met weinig entiteiten maar dat
wel alle aspecten van een heel project raakt.</p>
</div>
<div class="sect3">
<h4 id="_datamodel">3.1.1. Datamodel</h4>
<div class="paragraph">
<p>De volgende entiteiten zullen we maken:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>@startuml
class Kaas
@enduml</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_architectuur">3.1.2. Architectuur</h4>
<div class="paragraph">
<p>De kaaswinkel wordt gebouwd op basis van de nieuwe JavaEE REST
architectuur. Hierbij is een backend verantwoordelijk voor het
ontsluiten van de gegevens uit een database via een REST-API. De
backend bestaat uit drie componenten: entities, dao en rest. De
kaaswinkel wordt aan gebruikers getoond via de <em>web</em> applicatie en
optioneel een <em>iphone</em> en een <em>android</em> applicatie.</p>
</div>
<div class="paragraph">
<p>Onderstaande figuur toont de samenhang tussen de verschillende
componenten:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>@startuml
node "backend" {
  [entities] - [dao]
  [dao] - [rest]
}

database database
[web] &lt;&lt;application&gt;&gt;
[iphone] &lt;&lt;application&gt;&gt;
[android] &lt;&lt;application&gt;&gt;

[contract] .. [rest]

[rest] - [web]
[rest] - [iphone]
[rest] - [android]

database - [entities]

@enduml</pre>
</div>
</div>
<div class="paragraph">
<p>De JPA mapping van database tabellen naar Java entiteiten is
gedefinieerd in de component <em>entities</em>. De <em>dao</em> component is
verantwoordelijk voor het uitvoeren van queries via de JPA
criteria-API. De <em>rest</em> component vertaalt de entiteiten van en naar de
publieke REST-API, en vertaalt binnenkomende requests naar aanroepen op
de data access objects in de DAO.</p>
</div>
<div class="paragraph">
<p>Nu je de componenten hebt geïdentificeerd en de onderlinge relaties
duidelijk hebt kan je een project gaan inrichten.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_project_inrichten">3.2. Project inrichten</h3>
<div class="paragraph">
<p>Het project wordt opgesplitst in Maven modules die overeenkomen met de
componenten zoals je die eerder gedefinieerd hebt. Eerst maak je de
directory structuur aan, daarna de verschillende Maven POM bestanden.</p>
</div>
<div class="sect3">
<h4 id="_folders_aanmaken">3.2.1. Folders aanmaken</h4>
<div class="paragraph">
<p>Om het maken van een multi-module project te versnellen kan je
onderstaande commando&#8217;s uitvoeren. Deze richten een standaard Maven
project in, met de juiste afhankelijkheden.</p>
</div>
<div class="paragraph">
<p>Met onderstaand <em>bash</em> commando maak je in één keer een folder
structuur voor een multi-module Maven project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code data-lang="bash">mkdir -p {backend/ear,backend/entities,backend/dao,backend/rest,contract,scripts,web}\
/src/{main,test}/{java,resources}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Dit resulteert in de volgende projectstructuur:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>.
├── backend
│   ├── dao
│   ├── ear
│   ├── entities
│   └── rest
├── contract
├── scripts
└── web</pre>
</div>
</div>
<div class="paragraph">
<p>Het <em>backend</em> project is een multi-module
project voor de backend van de applicatie en bestaat uit projecten voor
de database definities in het <em>entities</em> project, database services in
het <em>dao</em> project, de REST API in het <em>rest</em> project en wordt
gepackaged als een EAR in het <em>ear</em> project.</p>
</div>
<div class="paragraph">
<p>Het <em>contract</em> project is voor de REST API definitie (het contract
tussen de server en de clients). De <em>scripts</em> folder is bedoeld voor
scripts die wildfly configureren en andere semi-automatische
configuratie zaken regelen. Het <em>web</em> project is voor de webapplicatie
(Wicket) en wordt gepackaged als een WAR.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_de_datalaag">4. De Datalaag</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In de lagen-architectuur van onze applicaties is een belangrijke rol weggelegd voor de <em>datalaag</em>.
De datalaag is verantwoordelijk voor het ontsluiten van bijvoorbeeld de database via zogeheten <em>Data Access Objects</em>.
Binnen deze <em>Data Access Objects</em> wordt gebruik gemaakt van Object Relationele Mapping om database tabellen te vertalen naar Java objecten en vice versa.</p>
</div>
<div class="paragraph">
<p>Laten we eerst kijken hoe je een Data Access Object maakt.</p>
</div>
<div class="sect2">
<h3 id="_data_access_objects_ontsluiten_de_datalaag">4.1. Data Access Objects Ontsluiten de Datalaag</h3>
<div class="paragraph">
<p>Om de persistente entiteiten te kunnen benaderen vanuit de <em>services</em> gebruiken we zogeheten <a href="https://en.wikipedia.org/wiki/Data_access_object">Data Access Objects</a> (kortweg DAOs).
DAOs verbergen de complexiteit van het bouwen van database queries en transformaties van objecten van en naar de database.
In het verleden werden ze met name gebruikt om JDBC achter een <a href="https://en.wikipedia.org/wiki/Facade_pattern">façade</a> te verbergen, maar ook met JPA worden de DAOs veel gebruikt.</p>
</div>
<div class="sect3">
<h4 id="_minimale_eisen_aan_een_dao_in_de_javaee_setup">4.1.1. Minimale eisen aan een DAO in de JavaEE setup</h4>
<div class="paragraph">
<p>Een DAO moet minimaal:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>een EJB zijn en</p>
</li>
<li>
<p>meedoen aan een transactie.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Aan deze eisen kan je met onderstaand voorbeeld eenvoudig voldoen:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">@Stateless
@TransactionAttribute(TransactionAttributeType.MANDATORY)
public class CheeseDAO extends AbstractBoundDAO&lt;PCheese, CheeseZoekFilter&gt;
{
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Dit is een stateless session bean (waardoor het een light-weight EJB geworden is) die verplicht vindt dat er een transactie al moet lopen.
Transacties worden op de servicelaag gestart en gecommit, dus voor de DAO moet er al verplicht een transactie lopen.</p>
</div>
<div class="paragraph">
<p>Nu je Data Access Objects kan maken, wil je natuurlijk ook objecten in en uit de database halen.
Dit doen we met behulp van de Java implementatie van Object Relationele Mapping: JPA.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_object_relationele_mapping_met_jpa">4.2. Object Relationele Mapping met JPA</h3>
<div class="paragraph">
<p>Object Relationele Mapping is een idioom om de vertaling te maken tussen database tabellen en Java objecten.
Deze vertaling is twee-wegs: tabellen uitlezen en van die gegevens Java objecten maken, en van Java objecten weer database inhoud maken.</p>
</div>
<div class="paragraph">
<p>In 2003 is deze manier van werken volwassen geworden met de introductie van Hibernate, een implementatie van ORM voor Java (en tegenwoordig ook .Net).
Sindsdien is er een hoop uitgebreid aan deze manier en heeft de Java Enterprise wereld zich gestandaardiseerd op één specificatie: <em>Java Persistence API</em> (JPA).
In het verleden maakten we direct gebruik van Hibernate functionaliteit binnen Topicus, maar sinds de overgang op de nieuwe Java EE architectuur kunnen we beter de JPA-apis gebruiken.</p>
</div>
<div class="paragraph">
<p>Dit hoofdstuk geeft kort de aanleiding voor de overstap naar JPA, je zal leren zelf queries te schrijven met behulp van de <code>QueryAtom</code> API.</p>
</div>
<div class="sect3">
<h4 id="_waarom_kiezen_voor_jpa_of_hibernate">4.2.1. Waarom kiezen voor JPA of Hibernate</h4>
<div class="paragraph">
<p>Voorheen maakten we direct gebruik van de Hibernate APIs.
Sinds JPA 1.0 zou dit niet meer nodig hoeven zijn, echter in die versie zat nog geen query API.
Deze is sinds 2.1 gestandaardiseerd en we kunnen nu dan ook vol gebruik maken van een type-safe criteria API.</p>
</div>
<div class="paragraph">
<p>De Hibernate criteria API heeft diverse nadelen:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>wordt niet meer onderhouden (sinds Hibernate 5)</p>
</li>
<li>
<p>is niet type-safe (staat stijf van de strings voor properties)</p>
</li>
<li>
<p>is niet portable naar andere ORMs (niet dat we makkelijk kunnen overstappen naar bijv. OpenJPA, maar de criteria API is een groot obstakel)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>die met JPA worden aangepakt:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>JPA is de toekomst, ook volgens de Hibernate ontwikkelaars</p>
</li>
<li>
<p>Met de <em>meta-model</em> generatie kan je redeneren over je properties op een type-safe manier</p>
</li>
<li>
<p>een officiële standaard dus portable naar andere JPA providers</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Met JPA kan je eenvoudig Java objecten opslaan in een relationele database, en ze er ook weer uithalen.</p>
</div>
</div>
<div class="sect3">
<h4 id="_van_tabellen_naar_java_objecten_en_weer_terug">4.2.2. Van tabellen naar Java objecten (en weer terug)</h4>
<div class="paragraph">
<p>In al onze applicaties hebben we een standaard basis klasse die een object representeert dat <em>persistent</em> is: de <code>Entiteit</code>.
Entiteit bevat de unieke identifier van het persistente object, de versie (om te detecteren dat niet twee gebruikers het object tegelijkertijd aanpassen) en wat audit informatie over wie wanneer het object aangepast heeft.
In meeste systemen wordt ook nog onderscheid gemaakt tussen organisatie specifieke entiteiten (OrganisatieEntiteit) en algemene entiteiten die niet aan één specifieke organisatie toebehoren (bijvoorbeeld Land, Nationaliteit).</p>
</div>
<div class="paragraph">
<p>Elke entiteit en z&#8217;n velden zijn voorzien van de benodige JPA annotaties om de vertaling tussen de tabelstructuur en het Java object mogelijk te maken.
Je kan hierover meer lezen in het boek <em>Java Persistence with Hibernate</em>.
In deze sectie zullen we alleen nog kijken naar de best-practises die we binnen Topicus Onderwijs hanteren voor specifieke JPA functionaliteit.</p>
</div>
<div class="sect4">
<h5 id="_persistence_xml_locatie_voor_automatische_entiteit_scanning">Persistence.xml locatie voor automatische entiteit scanning</h5>
<div class="paragraph">
<p>Om JPA aan te zetten in je applicatie dien je een persistence.xml bestand op te nemen in de JAR file waarin je entiteiten zitten, anders werkt namelijk de automatische scanning op entiteiten niet.
De persistence.xml staat in de folder <code>src/main/resources/META-INF</code> van je entiteiten project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;persistence version="2.1" xmlns="http://xmlns.jcp.org/xml/ns/persistence" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/persistence  http://xmlns.jcp.org/xml/ns/persistence/persistence_2_1.xsd"&gt;
	&lt;persistence-unit name="primary" transaction-type="JTA"&gt; <i class="conum" data-value="1"></i><b>(1)</b>
		&lt;jta-data-source&gt;projectnaam/jdbc&lt;/jta-data-source&gt; <i class="conum" data-value="2"></i><b>(2)</b>
	&lt;/persistence-unit&gt;
&lt;/persistence&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>de primaire <em>persistence unit</em> voor gebruik in je applicatie, deze heet dan ook <em>primary</em> in onze applicaties</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>de datasource die gebruikt wordt door deze persistence unit, wordt geleverd door je Java EE server</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Je kan allerlei instellingen definieren in dit persistence.xml bestand, zie daarvoor de Hibernate handleiding of de bestaande code.
Natuurlijk wil je je entiteiten kunnen unit testen om zo eventuele mapping problemen voor te zijn.</p>
</div>
<div class="sect5">
<h6 id="_persistence_xml_voor_unit_tests">Persistence.xml voor unit tests</h6>
<div class="paragraph">
<p>Wanneer je unit tests wil schrijven voor je entiteiten jar (iedereen wil dat toch?), ontkom je er niet aan om een aparte persistence unit te definieren enkel voor het draaien van deze testen.
Het handigste en snelste is om een persistence unit te maken die gebruik maakt van een in-memory database.
Neem deze op in een aparte persistence.xml en plaats deze in <code>src/test/resources/META-INF</code>.
Je moet dan wel elke entiteit en andere persistentie gerelateerde classes expliciet opnemen in je persistence.xml omdat de automatische scanner niet werkt met een persistence.xml in src/test/resources/META-INF.</p>
</div>
<div class="paragraph">
<p>Een voorbeeld van een test persistence.xml:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;persistence version="2.1" xmlns="http://xmlns.jcp.org/xml/ns/persistence" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/persistence  http://xmlns.jcp.org/xml/ns/persistence/persistence_2_1.xsd"&gt;
	&lt;persistence-unit name="test" transaction-type="RESOURCE_LOCAL"&gt;
		&lt;class&gt;accounts.entities.Account&lt;/class&gt; <i class="conum" data-value="1"></i><b>(1)</b>
		&lt;class&gt;conferenties.entities.Conferentie&lt;/class&gt;

		&lt;class&gt;common.PasswordConverter&lt;/class&gt; <i class="conum" data-value="2"></i><b>(2)</b>
		&lt;class&gt;common.UsernameConverter&lt;/class&gt;

		&lt;properties&gt;
			&lt;property name="javax.persistence.schema-generation.database.action" value="drop-and-create" /&gt; <i class="conum" data-value="3"></i><b>(3)</b>
			&lt;property name="connection.driver_class" value="org.h2.Driver" /&gt;
			&lt;property name="hibernate.connection.url" value="jdbc:h2:./target/db" /&gt;
			&lt;property name="hibernate.dialect" value="org.hibernate.dialect.H2Dialect" /&gt;
			&lt;property name="hibernate.show_sql" value="true" /&gt;
		&lt;/properties&gt;
	&lt;/persistence-unit&gt;
&lt;/persistence&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>neem alle entiteiten op die je wil testen</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>neem ook alle ondersteunende persistentie gerelateerde classes op</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>dit doe je dus niet in een productie persistence unit</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Nu kan je dus je entiteiten testen in unit tests.
Hiertoe dien je nog wel een expliciete JPA implementatie op het classpath te zetten, zoals Hibernate (hibernate-core en hibernate-entitymanager), doe dit met scope <em>test</em>.</p>
</div>
<div class="paragraph">
<p>Het handigst is om een test suite te maken waarin je één keer een persistence context bouwt, en in de suite al je persistence tests opneemt.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">@RunWith(Suite.class)
@SuiteClasses({ UsersPersistence.class, ConferentiesPersistence.class }) <i class="conum" data-value="1"></i><b>(1)</b>
public class PersistenceTest {
  private static EntityManagerFactory entityManagerFactory;

  @BeforeClass
  public static void setup() { <i class="conum" data-value="2"></i><b>(2)</b>
    entityManagerFactory = Persistence.createEntityManagerFactory("test");
  }

  @AfterClass
  public static void teardown() { <i class="conum" data-value="3"></i><b>(3)</b>
    // als het opzetten van de EMF fout gaat, is deze niet gezet
    if (entityManagerFactory != null) {
      entityManagerFactory.close();
      entityManagerFactory = null;
    }
  }

  public static EntityManagerFactory getEntityManagerFactory() {
    return entityManagerFactory;
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>de lijst van unit tests voor jouw entiteiten</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>maak één keer voor het uitvoeren van alle tests de persistence unit</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>breek de persistence unit aan het eind van alle tests weer af</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Deze suite zorgt ervoor dat de persistence unit slechts één keer wordt opgebouwd tijdens het draaien van je unit tests.
Aangezien het opbouwen van een persistence unit nogal wat seconden kan duren is dit pure winst.</p>
</div>
<div class="paragraph">
<p>Nu moet je nog wel een transactie starten en stoppen voor elke test, dit kan je het makkelijkst doen door een base class te maken voor je unit tests, bijvoorbeeld de volgende class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">public class PersistenceTestBase {
  private EntityManager entityManager;

  @Before
  public final void setupEntityManager() {
    entityManager = PersistenceTest.getEntityManagerFactory().createEntityManager();
    Assert.assertNotNull(entityManager);
    getEntityManager().getTransaction().begin(); <i class="conum" data-value="1"></i><b>(1)</b>
  }

  @After
  public final void teardownEntityManager() {
    getEntityManager().getTransaction().rollback();  <i class="conum" data-value="2"></i><b>(2)</b>

    // als het opzetten van de EM fout gaat, is deze niet gezet
    if (entityManager != null) {
      entityManager.close();
      entityManager = null;
    }
  }

  protected EntityManager getEntityManager() {
    return entityManager;
  }

  /** checkt of de entiteit correct opgeslagen kan worden. */
  protected void checkPersist(Entiteit o) {
    getEntityManager().persist(o);
    getEntityManager().flush();

    Entiteit entiteit = getEntityManager().find(o.getClass(), o.getId());
    assertThat(entiteit, is(not(nullValue())));
    assertThat(entiteit.getVersion(), is(0L));
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>start een transactie voor elke test</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>rollt de transactie terug na elke test</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Wanneer je jouw test case laat overerven van deze basisklasse kan je eenvoudig tests uitvoeren om te kijken of jouw entiteiten opgeslagen kunnen worden.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Commit niet zelf je transactie, maar gebruikt <code>getEntityManager().flush()</code> om je updates daadwerkelijk naar de database te versturen.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Nu je je entiteiten kan mappen op een database structuur met de JPA annotaties, moet je ook gaan letten op de snelheid van je applicatie.
Door caching te gebruiken zorg je voor een optimale snelheid van je applicatie.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_caching_gebruiken_om_je_objecten_nog_sneller_op_te_vragen">Caching gebruiken om je objecten nog sneller op te vragen</h5>
<div class="paragraph">
<p>JPA biedt de mogelijkheid om je entiteiten te cachen in het Java proces om zo de database te ontlasten van veel gevraagde queries.
Elke query die je uitvoert duurt minimaal 0,1ms dus als je veel queries kan voorkomen omdat je de objecten al in je geheugen hebt, scheelt dat uiteindelijk een heleboel request tijd.</p>
</div>
<div class="paragraph">
<p>TODO: dit afmaken</p>
</div>
<div class="paragraph">
<p>Caching zorgt ervoor dat je minder vaak naar de database hoeft om een query uit te voeren.
Maar wanneer je toch op de database een query uit voert, moet die wel snel uitgevoerd kunnen worden.
Hiervoor kan je indexen gebruiken.</p>
</div>
</div>
<div class="sect4">
<h5 id="_indexen_gebruiken_om_je_queries_nog_sneller_uit_te_voeren">Indexen gebruiken om je queries nog sneller uit te voeren</h5>
<div class="paragraph">
<p>TODO: dit afmaken</p>
</div>
<div class="paragraph">
<p>JPA biedt niet alleen functionaliteit om objecten naar tabellen en vice versa te vertalen, maar ook om database queries te specificeren in Java code, gebaseerd op jouw Java structuur.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_gebruik_de_jpa_criteria_api_om_queries_te_schrijven">4.2.3. Gebruik de JPA Criteria API om queries te schrijven</h4>
<div class="paragraph">
<p>De JPA Criteria API stelt je in staat om queries te schrijven over je entities in een <code>SELECT...FROM...WHERE</code>-structuur (hoewel de volgorde vaak <code>FROM...WHERE...SELECT</code> zal zijn).</p>
</div>
<div class="paragraph">
<p>Lees hier meer over op <a href="http://docs.oracle.com/javaee/6/tutorial/doc/gjrij.html" class="bare">http://docs.oracle.com/javaee/6/tutorial/doc/gjrij.html</a>.</p>
</div>
<div class="paragraph">
<p>Omdat de JPA criteria API niet de fijnste manier is om database queries te schrijven, en om het vertalen van een REST-api call naar de database te vereenvoudigen zijn <em>Query Atoms</em> gebouwd.</p>
</div>
</div>
<div class="sect3">
<h4 id="_zoekfilters_schrijven_met_de_queryatom_api">4.2.4. Zoekfilters schrijven met de QueryAtom API</h4>
<div class="paragraph">
<p>Cobra zou Cobra niet zijn als we geen abstractielaag over de JPA Criteria heen hadden gebouwd.
Met behulp van deze <code>QueryAtom</code> API kun je herbruikbare stukjes query schrijven, die daarna tot een Criteria query geassembleerd kunnen worden; hetzij handmatig, hetzij door het zoekfilter-framework (waarover zo meer).
Zo&#8217;n <code>QueryAtom</code> ziet er bijvoorbeeld als volgt uit:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">QueryAtom&lt;Deelnemer,String&gt; deelnemerAchternaam =
    new Like&lt;&gt;(JoinedPathBuilder.of(Deelnemer_.persoon, Persoon_.achternaam))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Deze expressie beschrijft een restrictie op <code>Deelnemer</code>, namelijk dat de gekoppelde <code>Persoon</code> een achternaam moet hebben die op een bepaalde <code>String</code> lijkt.
Welke <code>String</code> dit is wordt nog niet gespecificeerd; deze koppeling wordt later gelegd.
In SQL zou het ongeveer overeenkomen met:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sql">FROM [D] INNER JOIN Persoon ON [D].persoon = Persoon.id
WHERE Persoon.achternaam LIKE ?</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alsof één abstractielaag nog niet genoeg is, bevat Cobra ook een laag om <code>QueryAtoms</code> automatisch te assembleren tot queries.
Hierbij registreert de applicatieprogrammeur een <code>QueryAtom</code> als veld van een zoekfilter, en dit gaat als volgt:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">public class DeelnemerZoekFilter extends AbstractInstellingZoekFilter&lt;Deelnemer&gt;
{
    @Parameter(StringQueryParameter.class)
    public FilterValue&lt;String&gt; achternaam()
    {
        return recordFilter(new Like&lt;&gt;(
            JoinedPathBuilder.of(Deelnemer_.persoon, Persoon_.achternaam)));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Met dit zoekfilter kunnen we nu een query gaan doen:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">DeelnemerZoekFilter filter = deelnemerDAO.createFilter();
filter.achternaam().set("Van Binsbergen");
List&lt;Deelnemer&gt; deelnemers = deelnemerDAO.get(filter);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Er hoeft dus geen aparte <code>HibernateDataAccessHelper</code> met <code>createCriteria</code> methode meer geschreven te worden zoals bij de vorige architectuur.
De applicatieprogrammeur legt de koppeling tussen zoekfilter-velden en database-restricties nu in het zoekfilter zelf.</p>
</div>
<div class="paragraph">
<p>Het zoekfilter kan ook gebruikt worden om deletes uit te voeren zonder dat je zelf met <code>CriteriaDelete</code> een query hoeft te maken of eerst objecten ophaalt om ze vervolgens met <code>dao.delete(object)</code> te verwijderen.
Delete werkt analoog aan get (maar geeft het aantal verwijderde objecten terug) en heeft net als getAs ook een deleteAs waarmee je kan specificeren welke subclass je wilt verwijderen:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">DocumentZoekFilter filter = documentDAO.createFilter();
filter.groep().naam().set("Groep 8");
int aantalVerwijderdeNotities = documentDAO.deleteAs(filter, Notitie.class);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_integratie_van_zoekfilters_in_een_rest_service">4.2.5. Integratie van zoekfilters in een REST-service</h4>
<div class="paragraph">
<p>Om zoekfilters ook aan de client-kant te kunnen gebruiken, heeft Cobra een vertaalmechanisme om parameters uit het REST request door te zetten naar velden van het zoekfilter.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>GET /deelnemer?achternaam=Van%20Binsbergen
Accept: application/json</pre>
</div>
</div>
<div class="paragraph">
<p>De lijst met in dit geval 1 parameter wordt door</p>
</div>
<div class="literalblock">
<div class="content">
<pre>AbstractBoundDAO#createFilter(Map&lt;String, List&lt;String&gt;&gt; parameters)</pre>
</div>
</div>
<div class="paragraph">
<p>omgezet in een zoekfilter.</p>
</div>
<div class="paragraph">
<p>De <code>DeelnemerResourceRESTService</code> heeft als pad <code>/deelnemer</code>, dus JAX-RS zal deze service aantrappen voor de <code>GET</code> operatie.
Omdat <code>DeelnemerResourceRESTService</code> het request afhandelt, en deze is gekoppeld aan de <code>DeelnemerDAO</code>, wordt er een DeelnemerZoekFilter gecreëerd.
In dit geval een <code>DeelnemerZoekFilter</code> omdat het request afgehandeld wordt door de <code>DeelnemerResourceRESTService</code>, die verwijst naar de <code>DeelnemerDAO</code>, welke op zijn beurt gekoppeld is aan het <code>DeelnemerZoekFilter</code>.
Zoals te zien is in de type signature kan een GET parameter ook meerdere waardes meekrijgen (<code>?achternaam=Van%20Binsbergen&amp;achternaam=Kerstens</code>); de <code>QueryAtom</code> interface is hier ook op berekend.</p>
</div>
<div class="paragraph">
<p>Zowel de naam als de waarde(n) van een parameter moeten vertaald worden.
De eerste vertaling is hardcoded: er wordt gezocht naar een methode op het zoekfilter met de naam <code>achternaam</code>.
De tweede vertaling is gespecificeerd door de annotatie <code>@Parameter(StringQueryParameter.class)</code> op de methode <code>achternaam()</code>.
Er hoeft in dit geval weinig vertaald te worden omdat de waarde al een <code>String</code> is.
Als het filterveld een entiteit had betroffen, had de <code>EntityQueryParameter</code> de vertaling van een string met database-ID(s) naar entiteit(en) gemaakt.</p>
</div>
<div class="paragraph">
<p>Op zoekfiltervelden zijn nog meer annotaties mogelijk die je het leven makkelijker maken.
Zo kan je bijvoorbeeld een default-waarde definiëren:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">@Parameter(EnumQueryParameter.class)
@DefaultParameterValue("TRUE")
public FilterValue&lt;BooleanEnum&gt; actief() { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Deze wordt gebruikt als de parameter niet voorkomt in het REST-request.
Met de <code>@ContextAware</code> annotatie geef je aan om een filterwaarde bij voorkeur uit de <code>QueryContext</code> te halen in plaats van uit de request parameters.
De <code>QueryContext</code> bevat over het algemeen entiteiten uit REST-resources "hoger" in de URL.
Met de <code>@Enforces</code> annotatie wordt de filterwaarde gevuld aan de hand van een security-constraint.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Bij het gebruik van een zoekfilter buiten het REST-framework om worden de <code>@DefaultParameterValue</code>, <code>@ContextAware</code> en <code>@Enforces</code> annotaties genegeerd.
Dit geldt ook voor sub-zoekfilters.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_sub_zoekfilters">4.2.6. Sub-zoekfilters</h4>
<div class="paragraph">
<p>Het is mogelijk om een zoekfilter te gebruiken als "veld" in een ander zoekfilter.
Zo kunnen we het bovenstaande voorbeeld herschrijven door een <code>PersoonZoekFilter</code> met veld <code>achternaam()</code> te definiëren, en dit te gebruiken in het <code>DeelnemerZoekFilter</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">public class PersoonZoekFilter extends AbstractInstellingZoekFilter&lt;Persoon&gt;
{
    @Parameter(StringQueryParameter.class)
    public FilterValue&lt;String&gt; achternaam()
    {
        return recordFilter(new Like&lt;&gt;(Persoon_.achternaam)));
    }
}

public class DeelnemerZoekFilter extends AbstractInstellingZoekFilter&lt;Deelnemer&gt;
{
    @Parameter(EntityQueryParameter.class)
    public PersoonZoekFilter persoon()
    {
        return composeFilter(PersoonZoekFilter.class,
            new JoinFilterComposition&lt;&gt;(JoinBuilders.of(Deelnemer_.persoon)));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Hier hebben we gekozen voor een <code>JoinFilterComposition</code> omdat het een one-to-one relatie betreft.
Voor een many-to-many-relatie tussen <code>Deelnemer</code> en <code>Groep</code>, met <code>GroepDeelname</code> als koppel-entiteit, kiezen we voor een <code>SubqueryFilterComposition</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">    @Parameter(EntityQueryParameter.class)
    public GroepZoekFilter groep()
    {
        composeFilter(GroepZoekFilter.class,
            new SubqueryFilterComposition(Entiteit_.id,
                PathBuilders.idOf(GroepDeelname_.deelnemer),
                JoinBuilders.of(GroepDeelname_.groep)));
    }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_subklasses_in_zoekfilters">4.2.7. Subklasses in zoekfilters</h4>
<div class="paragraph">
<p>Als je een entiteitstructuur met subklasses hebt wil je niet voor elke subklasse een zoekfilter aanmaken, zeker niet als de subklasse slechts één of twee 'extra' properties heeft t.o.v. de superklasse.
In het zoekfilter van de superklasse kun je filteren op properties van de subklasse middels de <em>treated</em> JoinBuilder.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">public class Student extends Deelnemer
{
	private String studentnummer;
}

public class DeelnemerZoekFilter extends AbstractInstellingZoekFilter&lt;Deelnemer&gt;
{
	@Parameter(StringQueryParameter.class)
    public FilterValue&lt;String&gt; studentnummer()
    {
        return recordFilter(new Like&lt;&gt;(
        	PathBuilders.treated(
        		Student.class,
        		SinglePathBuilder.of(Student_.studentnummer))));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Dit werkt ook voor zoekfilter compositie:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">public class Student extends Deelnemer
{
	private Universiteit universiteit;
}

public class DeelnemerZoekFilter extends AbstractInstellingZoekFilter&lt;Deelnemer&gt;
{
	@Parameter(StringQueryParameter.class)
    public UniversiteitZoekFilter universiteit()
    {
    	return composeFilter(UniversiteitZoekFilter.class,
    		new JoinFilterComposition&lt;&gt;(JoinBuilders.treated(
    			Student.class,
    			JoinBuilders.of(Student_.universiteit))));
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_queryatom_api">4.2.8. QueryAtom API</h4>
<div class="sect4">
<h5 id="_subqueries">Subqueries</h5>
<div class="paragraph">
<p>Je wilt bijvoorbeeld van alle groepen selecteren waarin een bepaald onderwijsproduct gegeven wordt (alle groepen voor NL).
In het EduArte model kan je dit via <code>GroepDocent</code> en <code>GroepDocentOnderwijsproduct</code> de groepen ophalen.
Dit zou in pseudo SQL de volgende query moeten zijn:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sql">SELECT *
FROM GROEP
WHERE
GROEP.ID IN (
    SELECT GROEPDOCENT_.GROEP
    FROM GROEPDOCENT_
    INNER JOIN GROEPDOCENTONDERWIJSPRODUCT_ ON GROEPDOCENTONDERWIJSPRODUCT_.GROEPDOCENT = GROEPDOCENT_.ID
    WHERE GROEPDOCENTONDERWIJSPRODUCT_.ONDERWIJSPRODUCT = :ONDERWIJSPRODUCT
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Dit formuleer je dan met de SubqueryIn als volgt:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">new SubqueryIn&lt;&gt;(Groep_.id, PathBuilders.idOf(GroepDocent_.groep), new In&lt;&gt;(
    JoinedPathBuilder.of(GroepDocent_.groepDocentOnderwijsproducten,
        GroepDocentOnderwijsproduct_.onderwijsproduct)))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Deze selecteert dus <code>GroepDocent_.id</code> voor verdere joins met andere joins, en projecteert <code>GroepDocent_.groep</code> als resultaat van de subquery.</p>
</div>
</div>
<div class="sect4">
<h5 id="_cobra_query_language_cql">Cobra Query Language (CQL)</h5>
<div class="paragraph">
<p>Een framework voor queries is niet compleet zonder zijn eigen querytaal.
Cobra Query Language stelt je in staat om queries uit te voeren gebouwd op de QueryAtoms van je ZoekFilters.
Om CQL beschikbaar te maken in je ZoekFilters voeg je onderstaande methode toe aan je base filter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">@Parameter(CQLQueryParameter.class)
public FilterValue&lt;CQLExpression&gt; q()
{
    return recordFilter(new CQL&lt;&gt;());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>De syntax van een query in CQL is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>expression
  : expression 'and' expression
  | expression 'or' expression
  | 'not' expression
	| ( path '.' )? '(' expression ')'
	| path '=' value
	;

path : IDENTIFIER ( '.' IDENTIFIER )*	;

value : LITERAL ( ',' LITERAL )* ;

LITERAL : '\'' ( ~'\'' )* '\'' ;
IDENTIFIER : [a-zA-Z0-9_]+ ;</pre>
</div>
</div>
<div class="paragraph">
<p>Een voorbeeld van een query op <code>/account</code> wordt dan:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/account?q=gebruikersnaam='foo' or groep.(naam='bar','baz' and heeftVault='true')</pre>
</div>
</div>
<div class="paragraph">
<p>Deze query geeft alle accounts met de naam <code>foo</code>, of die in een groep met de naam <code>bar</code> of <code>baz</code> zitten en een vault hebben.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rest">5. REST</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Dit hoofdstuk geeft een korte inleiding tot REST en bevat enkele
handige boeken om te lezen voor meer achtergrondinformatie. Verder
behandelt het conventies voor bestaande en nieuwe projecten, zoals
naamgeving van classes, REST richtlijnen voor performance en het juiste
ontwerp van REST-APIs.</p>
</div>
<div class="paragraph">
<p>Niet alleen algemene zaken worden behandeld maar ook hoe je met de
instrumenten in <strong>Cobra</strong> efficient van voor naar achter een REST-API
maakt, en deze weergeeft in een Wicket interface met behulp van cobra
componenten.</p>
</div>
<div class="sect2">
<h3 id="_inleiding">5.1. Inleiding</h3>
<div class="paragraph">
<p>In onze projecten is altijd behoefte aan een <em>generiek</em> koppelvlak.
Klanten en wij zelf willen graag op andere manieren aan de opgeslagen
data in onze databases komen dan alleen via een net opgemaakte HTML
pagina.</p>
</div>
<div class="paragraph">
<p>Zo zijn mobiele applicaties&#8212;&#8203;het liefst native&#8212;&#8203;erg gewenst door onze
gebruikers. Daar je niet zomaar een database connectie kan openen
vanuit een mobiele telefoon om even lekker te queryen op een Oracle
database in een datacenter in Hengelo hebben we een generieke manier
nodig om aan de gegevens te komen.</p>
</div>
<div class="paragraph">
<p>We hebben gekeken of SOAP een mogelijke implementatie kon zijn, maar de
ondersteuning voor SOAP interfaces in bijvoorbeeld de Cocoa
bibliotheken is marginaal, terwijl het aanroepen van een REST-API via
HTTP zeer eenvoudig te implementeren is voor iOS en Android
ontwikkelaars. In onze JavaEE architectuur kiezen we er dan ook voor om
de gegevens vanaf nu via REST beschikbaar te maken.</p>
</div>
</div>
<div class="sect2">
<h3 id="_api_design">5.2. API design</h3>
<div class="paragraph">
<p>Er zijn vele mogelijkheden bij het ontwerpen en bouwen van APIs. Voor
de REST-APIs willen we een goede REST API bouwen waarbij zo min
mogelijk eigen interpretatie aan de API aanwezig is, en zoveel mogelijk
aansluiting bij standaard REST idiomen en protocollen.</p>
</div>
<div class="paragraph">
<p>Bij het ontwerp van de API gaan we uit van de principes die door Sam
Ruby en Leonard Richardson in
<a href="http://shop.oreilly.com/product/9780596529260.do">RESTful Web Services</a>
zijn beschreven. Hieronder een samenvatting van de elementen die we bij
de verschillende resources tegen komen, en andere ontwerpbeslissingen
die we hebben moeten nemen.</p>
</div>
<div class="sect3">
<h4 id="_gebruik_rest_methodes_correct">5.2.1. Gebruik REST methodes correct</h4>
<div class="paragraph">
<p>Voor de API proberen we een echte <em>resource oriented</em> oplossing te
bieden. Hiertoe publiceren we resources op vaste URLs en met behulp van
de standaard HTTP methodes kunnen deze resources uitgevraagd,
gecreëerd, aangepast en verwijderd worden (afhankelijk van de rechten
van de gebruiker).</p>
</div>
<div class="paragraph">
<p><code>GET</code>, <code>PUT</code>, <code>POST</code>, <code>DEL</code>, <code>HEAD</code>, <code>OPTIONS</code></p>
</div>
<div class="paragraph">
<p>Deze methodes hebben verschillende betekenissen voor wat er gebeurt op
de server. Hieronder kort de definities zoals wij die hanteren (op
het internet kan je enorm veel meningen horen die elkaar lekker
tegenspreken).</p>
</div>
<div class="sect4">
<h5 id="_get_requests">GET requests</h5>
<div class="paragraph">
<p>Een <code>GET</code> request past (in principe) niets aan op de opgevraagde resource.
Het is een <em>read only</em> methode.</p>
</div>
<div class="paragraph">
<p>Hieronder een interactie tussen een REST client (curl) en een REST server
voor de GET methode.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; GET /deelnemer/1234 HTTP/1.1
&gt; User-Agent: curl/7.37.1
&gt; Host: api.example.com
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 200 OK
&lt; Date: Thu, 05 Mar 2015 09:31:39 GMT
&lt; Content-Type: application/json
&lt; Connection: keep-alive
&lt;
&lt; {"deelnemernummer": "1234", ...}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_post_requests">POST requests</h5>
<div class="paragraph">
<p>Een <code>POST</code> request stuurt een nieuwe resource naar de gegeven URI en ontvangt
bij een succesvolle creatie de locatie terug waar de nieuwe resource op de
server gevonden kan worden. Eventueel wordt er in de body de resource
teruggezonden.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; POST /deelnemer HTTP/1.1
&gt; User-Agent: curl/7.37.1
&gt; Host: api.example.com
&gt; Content: application/json
&gt;
&gt; {"achternaam":"Stiefels", "roepnaam":"Coby", ... }
&gt;
&lt; HTTP/1.1 201 CREATED
&lt; Date: Thu, 05 Mar 2015 09:31:39 GMT
&lt; Location: http://api.example.com/deelnemer/1235
&lt; Content-Type: application/json
&lt; Connection: keep-alive
&lt;
&lt; {"deelnemernummer": "1235", "achternaam":"Stiefels", "roepnaam":"Coby", ... }</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Als je een 415 Unsupported media type ontvangt</div>
<div class="paragraph">
<p>Wanneer je een <code>415 Unsupported media type</code> foutmelding terug krijgt in een <code>POST</code>
bericht en je weet zeker dat je wel de juiste classes gemaakt hebt en de annotaties
kloppen, dan loop je waarschijnlijk tegen een
<a href="https://issues.jboss.org/browse/RESTEASY-818">bug in REST-EASY</a> aan.</p>
</div>
<div class="paragraph">
<p>Om dit op te lossen moet je de <code>public Response create(RFoos wrapper)</code> methode
overschrijven op je <code>FooResourceRESTService</code> en gewoon <code>return super.create(wrapper);</code>
aanroepen.</p>
</div>
<div class="paragraph">
<p>Hetzelfde geldt voor wanneer je deze fout krijgt bij het <code>PUT`ten van een resource,
dan moet je de `public Response update(long id, RFoo entity)</code> overschrijven en gewoon
<code>super</code> aanroepen.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_uri_design">5.2.2. URI design</h4>
<div class="paragraph">
<p>URI voor een resource is het pad waar je de REST methodes op kan
uitvoeren. Bijvoorbeeld:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/deelnemer/1234/notitie/5678
/groep/5678</pre>
</div>
</div>
<div class="paragraph">
<p>De volgende regels gelden voor URI&#8217;s in een REST-API:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>gebruik enkelvoud voor de naam van de resource:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>/deelnemer
/groep</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>URI segmenten zijn altijd in lowercase: dus <code>deelnemer</code> in plaats van
<code>Deelnemer</code></p>
</li>
<li>
<p>gebruik geen methode namen in het pad: dus geen <code>get_deelnemer</code>,
<code>getDeelnemer</code>, of <code>deleteNotitie</code></p>
</li>
<li>
<p>gebruik (stabiele) database IDs als identificerend onderdeel van het
pad:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>/deelnemer/1234
/groep/5678</pre>
</div>
</div>
<div class="paragraph">
<p>waarbij 1234 en 5678 de database IDs zijn van de deelnemer en groep
respectievelijk.</p>
</div>
</div>
<div class="sect3">
<h4 id="_naamgeving_java_classes">5.2.3. Naamgeving Java classes</h4>
<div class="paragraph">
<p>Om een consistente naamgeving over de projecten heen te krijgen zodat
je snel thuis bent in de verschillende teams zijn de volgende
conventies opgesteld. Er zijn twee conventies: één voor nieuwe
projecten waarbij legacy code geen invloed heeft en één voor bestaande
projecten die al een conventie in plaats hebben.</p>
</div>
<div class="sect4">
<h5 id="_nieuwe_projecten">Nieuwe projecten</h5>
<div class="paragraph">
<p>Nieuwe projecten kunnen gebruik maken van deze naamgeving. Er is geen
oude code die problemen veroorzaakt door deze naamgeving aan te houden,
dus we kunnen de publieke entiteiten 'puur houden zonder prefix.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Database-entiteiten beginnen met een <em>P</em> gevolgd door de naam van de
entiteit: <code>PKind</code>, <code>PGroep</code>, etc.</p>
</li>
<li>
<p>Metadata van database-entiteiten eindigen met een underscore <em>\_</em>, je
kan deze gebruiken om typesafe JPA criteria te maken.</p>
</li>
<li>
<p>REST types krijgen altijd de resource naam zonder prefix: <code>Kind</code>,
<code>Groep</code>, etc. Wrapper resources voor lijsten (omdat XML niet direct een
lijst kan teruggeven) krijgen altijd het nette Nederlandse meervoud
van de enkelvoudige resource&#8212;&#8203;zonder prefix&#8212;&#8203;als naam: <code>Kinderen</code>,
<code>Groepen</code>, etc. Specifieke wrappers voor resources zijn in principe niet nodig, maar kunnen gebruikt worden om extra informatie bij lijsten terug te geven.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_bestaande_projecten">Bestaande projecten</h5>
<div class="paragraph">
<p>Bestaande projecten hebben al een naamgeving, en die conflicteert
veelal met het eerder genoemde naamgevingsschema voor nieuwe projecten.
Daarom dienen de publieke REST classes een prefix te krijgen.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>De naam van database entiteiten is gewoon de naam van de entiteit
zonder prefix: <code>Kind</code>, <code>Groep</code>, etc.</p>
</li>
<li>
<p>Metadata van database entiteiten eindigen met een underscore <em>\_</em>, je
kan deze gebruiken om typesafe JPA criteria te maken.</p>
</li>
<li>
<p>REST types beginnen met een R gevolgd door de resource naam: <code>RKind</code>,
<code>RGroep</code>, etc. Wrapper resources voor lijsten (omdat XML niet direct
een lijst kan teruggeven) krijgen altijd een naam bestaand uit een R
gevolgd het nette Nederlandse meervoud van de enkelvoudige resource:
<code>RKinderen</code>, <code>RGroepen</code>, etc. Specifieke wrappers voor resources zijn in principe niet nodig, maar kunnen gebruikt worden om extra informatie bij lijsten terug te geven.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_resources_schrijven">5.3. Resources schrijven</h3>
<div class="paragraph">
<p>Er zijn twee verschillende soorten resources:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>rootresources</p>
</li>
<li>
<p>subresources</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>De code die voor de verschillende resources benodigd is wordt hieronder
verder uitgewerkt.</p>
</div>
<div class="sect3">
<h4 id="_root_resources_schrijven">5.3.1. Root resources schrijven</h4>
<div class="paragraph">
<p>Een <strong>rootresource</strong> is een resource die direct te benaderen is zonder
dat de levenscyclus afhangt van andere resources. Voorbeelden zijn
deelnemers en groepen:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>GET /deelnemer/1234
GET /groep/5678</pre>
</div>
</div>
<div class="sect4">
<h5 id="_benodigde_classes_voor_een_rest_service">Benodigde classes voor een rest service</h5>
<div class="paragraph">
<p>Voor het toevoegen van een nieuwe rest-service zijn de volgende classes
nodig. In dit voorbeeld gaan we uit van de bestaande database-entiteit
<code>Groep</code> waarvoor we een nieuwe root-resource willen hebben.</p>
</div>
<div class="paragraph">
<p>In service-contract:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>RGroep</code></dt>
<dd>
<p>Dit is de servicecontract-tegenhanger van de database-entiteit <code>Groep</code>.
Alle servicecontract-entiteiten extenden van <code>Linkable</code>. Optioneel:
<code>RGroepPrimer_ toevoegen als superclass van `RGroep</code>. Deze bevat dan
alleen de belangrijkste gegevens zoals naam en code, terwijl <code>RGroep</code>
de "zwaardere" volledige versie is met alle gegevens. Het is ook mogelijk
om meerdere subclasses van <code>RGroepPrimer</code> te hebben afhankelijk van het soort
REST-call.</p>
</dd>
<dt class="hdlist1"><code>RGroepResource</code></dt>
<dd>
<p>Deze interface definieert het REST-pad van de nieuwe resource en alle
REST-methodes. De standaard REST-methodes zoals <code>GET</code>, <code>UPDATE</code>, etc.
zijn al voorgedefinieerd in de super-interface <code>CrudRestResource</code>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>In web-common:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>RGroepResourceClient</code></dt>
<dd>
<p>De restclient voor deze resource. Deze client kan je injecten in je
wicket-pagina om de rest-resource te benaderen.</p>
</dd>
<dt class="hdlist1"><code>RGroepFilter</code></dt>
<dd>
<p>Dit is het zoekfilter aan de client-kant. In je wicket-pagina zal je
dit filter vullen en gebruiken.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>In dao:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>GroepDAO</code></dt>
<dd>
<p>De DAO voor deze resource. In de meeste gevallen kun je af met de
standaardfunctionaliteit van de superclass <code>AbstractDAO</code> en hoef je aan
deze DAO geen extra methodes toe te voegen.</p>
</dd>
<dt class="hdlist1"><code>GroepZoekFilter</code></dt>
<dd>
<p>Definieert de opbouw van queries, dit kan d.m.v. van JPA-criteria of
onze eigen <code>QueryAtom</code> laag hierboven op, die handig is voor veel
voorkomende eenvoudige queries.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>N.b. De naam van methodes in dit filter dient overeen te komen met de
naam van de queryparams zoals ze in de <code>RGroepResourceClient</code> worden
meegegeven in de <code>addFilterQuery</code> methode.</p>
</div>
<div class="paragraph">
<p>In rest:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>RGroepResourceService</code></dt>
<dd>
<p>De REST-service die de <code>RGroepResource</code> interface implementeert. In
deze service kun je bijv. custom logica m.b.t. het persisten en
deleten van entiteiten toevoegen.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_mapping_toevoegen">Mapping toevoegen</h5>
<div class="paragraph">
<p>Ten slotte dien je de nog een mapping toe te voegen van de
database-entiteit naar de REST-entiteit. Hiervoor kun je bv.
<code>GroepMappingBuilder</code> toevoegen, of een regel <code>map(Groep.class,
RGroep.class)</code>  toevoegen aan een reeds bestaande MappingBuilder die
logisch is voor deze entiteit.</p>
</div>
</div>
<div class="sect4">
<h5 id="_crud_operaties_implementeren">CRUD operaties implementeren</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>@WriteScope</code></dt>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Waarvoor dient deze annotatie, en waarom wordt de exceptie die hierop
controleert ingeslikt?</p>
</div>
<div class="paragraph">
<p>Waarvoor dient deze methode (<code>AbstractCrudRestService</code>)?</p>
</div>
<div class="paragraph">
<p>Wanneer zou je onderstaande methodes implementeren
(AbstractCrudRestService)?</p>
</div>
<div class="listingblock">
<div class="content">
<pre>protected void verifyCreate(L linkable, E entity)
protected void verifyUpdate(L linkable, E entity)
protected void verifyDelete(E entity)</pre>
</div>
</div>
<div class="paragraph">
<p>Wat is de betekenis van:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>protected void transferState(L incoming, L outgoing)</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_sub_resources_schrijven">5.3.2. Sub-resources schrijven</h4>
<div class="paragraph">
<p>Een <strong>subresource</strong> is een resource die alleen vanaf een rootresource, of
een andere subresource te benaderen is. Zo is een verbintenis niet los
te benaderen, maar alleen als onderdeel van een deelnemer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>GET /deelnemer/1234/verbintenis/5678</pre>
</div>
</div>
<div class="sect4">
<h5 id="_rest_sub_resource_serverside">REST sub-resource serverside</h5>
<div class="paragraph">
<p>Maak een REST-resource class in project-rest, overervend van
<code>AbstractCrudRestService</code> en implementeer/overschrijf de volgende
methodes:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>IEntiteit resolveContext(E entity)</code></dt>
<dd>
<p>Deze methode levert de context resource op waaronder deze subresource
valt. Voorbeeld: <code>verbintenis.getDeelnemer()</code>. Vergelijk dit met de
many-to-one relatie naar de eigenaar van de sub-resource.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rest_sub_resource_clientside">5.3.3. REST sub-resource clientside</h4>
<div class="paragraph">
<p>Maak een REST-client class in web-common die overerft van
<code>AbstractFilteredRestCrudSubResourceClient</code> of een andere superclass
die overerft van <code>AbstractFilteredRestCrudSubResourceClient</code>. Het is
belangrijk dat je de volgende methodes moet implementeren:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>Class&lt;L&gt; getContextType()</code></dt>
<dd>
<p>dit geeft de context aan waaronder jouw subresource leeft.
Bijvoorbeeld voor een verbintenis (<code>RVerbintenis</code>) is dit de
deelnemer (<code>RDeelnemer</code>)</p>
</dd>
<dt class="hdlist1"><code>String getSubResourcePath()</code></dt>
<dd>
<p>hier geef je het pad waaronder je subresource leeft ten opzichte van
de context resource, bijvoorbeeld <code>/deelnemer/1234/verbintenis/5678</code>
heeft <code>verbintenis</code> als subresource pad.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_wanneer_gebruik_je_een_root_resource_en_wanneer_een_sub_resource">5.3.4. Wanneer gebruik je een root-resource en wanneer een sub-resource?</h4>
<div class="paragraph">
<p>De keuze voor een root- of subresource hangt af van de functionele eisen van de applicatie.
Een entiteit op een sub-resource moet je altijd ophalen en opslaan via de context van de bovenliggende resource(s).
Het is daarom niet mogelijk om te query-en op entiteiten op een sub-resource in het algemeen.
Bijvoorbeeld: je hebt de root-resource Afspraak met daaronder een sub-resource AfspraakType.
Nu wil je alle AfspraakTypes waarop een docent recht heeft ophalen, om deze te tonen in een drop-down.
Dit kan dus niet, kies er in dit geval voor om AfspraakType een root-resource te maken.</p>
</div>
</div>
<div class="sect3">
<h4 id="_query_en_op_de_rest_api">5.3.5. Query-en op de REST API</h4>
<div class="paragraph">
<p>Als je een query op een REST resource wilt uitvoeren, zoals bijvoorbeeld
zoeken op de achternaam van een leerling wil je waarschijnlijk een request
als volgt versturen:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>GET /leerling?achternaam=Vries</pre>
</div>
</div>
<div class="paragraph">
<p>Om dit voorelkaar te krijgen in de REST architectuur kan je je <code>RLeerlingFilter</code>
--dat een Java bean is die de URI-parameters verzamelt&#8212;&#8203;uitbreiden met een extra
veld voor het opslaan van de parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">public class RLeerlingFilter implements ZoekFilter&lt;RLeerling&gt;
{
    private String achternaam;

    public void setAchternaam(String achternaam) { ... }
    public String getAchternaam() { ... }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Je moet dan ook nog in je <code>RLeerlingRestResourceClient</code> deze parameter toevoegen
aan het zoekrequest:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">public class RLeerlingRestResourceClient extends AbstractFilteredRestResourceClient&lt;RLeerling&gt;
{
	@Override
	protected void addFilterQuery(UriBuilder builder, RLeerlingFilter filter)
	{
		super.addFilterQuery(builder, filter);

		if(filter.getAchternaam() != null)
		    builder.queryParam("achternaam", filter.getAchternaam());
	}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Nu moet je dit ook nog aanpassen op de REST-server. Eerst het LeerlingZoekFilter
uitbreiden met deze parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">public class LeerlingZoekFilter extends AbstractZoekFilter&lt;Leerling&gt;
{
    @Paramater(StringQueryParameter.class)
    public FilterValue&lt;String&gt; achternaam()
    {
        return recordFilter(new Like&lt;&gt;(Leerling_.achternaam));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Als je je <code>LeerlingDAO</code> goed geïmplementeerd hebt ben je nu klaar met de
verplichte wijzigingen. Je dient dan nog wel het filter juist in te stellen
waar je de query in de client aan het uitvoeren bent.</p>
</div>
<div class="sect4">
<h5 id="_werken_met_entiteiten_in_rest_api_queries">Werken met entiteiten in REST-API queries</h5>
<div class="paragraph">
<p>Je kan ook entiteiten gebruiken in het query-en van de REST-API. Dit doe
je door niet de entiteit volledig in JSON te posten naar de backend, maar
door een identificerend attribuut, zoals de entiteit ID, van de entiteit
als query parameter op te nemen.</p>
</div>
<div class="paragraph">
<p>Als we bijvoorbeeld alle groepen willen zoeken van het vak Nederlands in
EduArte, zou het request er zo uit zien:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>GET /groep?vak=1234567890</pre>
</div>
</div>
<div class="paragraph">
<p>We beginnen met het uitbreiden van het <code>RGroepFilter</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">public class RGroepFilter implements ZoekFilter&lt;RGroep&gt;
{
    private ROnderwijsproductPrimer vak;

    public ROnderwijsproductPrimer getVak() { ... }
    public void setVak(ROnderwijsproductPrimer vak) { ... }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Hier wordt gebruik gemaakt van de primer in plaats van een volledig
onderwijsproduct omdat je wel een onderwijsproduct in de primer kan
stoppen, maar niet andersom. Hierdoor is de filter-API iets robuster.</p>
</div>
<div class="paragraph">
<p>Nu moeten we niet vergeten de <code>RGroepRestResourceClient</code> aan te passen
zodat het vak ook daadwerkelijk in de zoek URI opgenomen wordt:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">public class RGroepRestResourceClient extends AbstractFilteredRestResourceClient&lt;RGroep&gt;
{
	@Override
	protected void addFilterQuery(UriBuilder builder, GroepFilter filter)
	{
		super.addFilterQuery(builder, filter);

		if(filter.getVak() != null)
		    builder.queryParam("vak", filter.getVak().self().getId());
	}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Als parameter in de URI gebruik je de <code>id</code> van de entiteit. Je kan kiezen voor een
meer business-achtige parameter, zoals vakcode, maar die zijn vaak niet uniek binnen
een instelling of locatie. Je kan de <code>id</code> ophalen bij elke REST-entiteit door de <code>self</code>
referentie uit te vragen.</p>
</div>
<div class="paragraph">
<p>Aan de REST-server kant dien je nu nog het <code>GroepZoekFilter</code> uit te breiden met deze
nieuwe parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">public class GroepZoekFilter extends AbstractZoekFilter&lt;Groep&gt;
{
	@Parameter(EntityQueryParameter.class)
	public FilterValue&lt;Onderwijsproduct&gt; vak()
	{
		return recordFilter( ... );
	}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In het stukje van de <code>recordFilter</code> staat de magie om een <code>QueryAtom</code> aan te maken
om een databasequery te genereren.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_extra_informatie_opvragen_met_additionalobjects">5.4. Extra Informatie opvragen met AdditionalObjects</h3>
<div class="paragraph">
<p>Om onze applicaties responsive te laten zijn is het noodzakelijk om niet
te veel requests op de REST API af te vuren vanuit de clients. Elk request
voegt namelijk een behoorlijke hoeveelheid latency toe en dat zal
uiteindelijk resulteren in een langzaam voelende applicatie. De oplossing
is dan ook om in plaats van 4 aparte requests te versturen deze te bundelen
in één request.</p>
</div>
<div class="paragraph">
<p>Met de zogeheten additional objects kan je in één request meerdere resources
tegelijkertijd ophalen.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
nog verder uitwerken
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_versionering_van_de_api">5.5. Versionering van de API</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
nog schrijven
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_performance_overwegingen">5.6. Performance overwegingen</h3>
<div class="paragraph">
<p>Door een REST-API te gebruiken als backend voor al onze user interfaces
dienen we extra te letten op de performance van onze applicaties. Het
uitvoeren van een REST-call duurt al gauw 100ms. Als je dan in je
Wicket pagina 10 aanroepen doet op de REST-API, zit je gebruiker alleen
al één seconde te wachten op iets waar zij geen zicht op heeft: server
to server communicatie.</p>
</div>
<div class="paragraph">
<p>Hieronder worden diverse overwegingen gegeven voor het bouwen van REST
services waarmee je je applicatie snel laat werken, ook voor je
gebruikers.</p>
</div>
<div class="sect3">
<h4 id="_limiteren_aantal_terug_te_geven_resultaten">5.6.1. Limiteren aantal terug te geven resultaten</h4>
<div class="paragraph">
<p>Omdat native clients vaak over een laag-bandbreedte verbinding werken
(T-Mobile zegt wel 14mbit/s aan te kunnen, maar lijkt vaak eerder op
14k4) is het noodzakelijk om niet miljoenen resultaten over de lijn te
sturen.</p>
</div>
<div class="paragraph">
<p>Bij alle resources geldt dat er een maximale limiet van 100 elementen
is die per request opgehaald kunnen worden. Hierbij wordt gebruik
gemaakt van de HTTP statuscode <code>206 PARTIAL CONTENT</code>.</p>
</div>
<div class="paragraph">
<p>Request voor de meest recente items uit de nieuwsfeed:</p>
</div>
<div class="listingblock">
<div class="title">Request</div>
<div class="content">
<pre class="pygments highlight"><code>GET /nieuws
Accept: application/json</code></pre>
</div>
</div>
<div class="paragraph">
<p>Het antwoord als er minder dan 100 berichten zijn:</p>
</div>
<div class="listingblock">
<div class="title">Response</div>
<div class="content">
<pre class="pygments highlight"><code>HTTP/1.1 200 OK
Date: Wed, 3 Apr 2013 14:37:12 GMT
Content-Type: application/json
Accept-Ranges: items
Content-Range: items 0-48/49  <i class="conum" data-value="1"></i><b>(1)</b>
Last-Modified: Tue, 2 Apr 2013 12:37:12 GMT

[
    { "titel": "Nieuw huiswerk", "categorie": "huiswerk", "datum": "30 Oct 1994 20:01:12 GMT"},
    { "titel": "Cijfer voor NL", "categorie": "resultaat", "datum": "30 Oct 2013 13:10:32 GMT"},
    …
]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Aantal teruggegeven elementen en het totaal.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In dit voorbeeld zijn er in totaal 49 elementen en element 0 tot en met
48 zijn teruggegeven.</p>
</div>
<div class="paragraph">
<p>Response bij meer dan 100 berichten in de nieuwsfeed:</p>
</div>
<div class="listingblock">
<div class="title">Response</div>
<div class="content">
<pre class="pygments highlight"><code>HTTP/1.1 206 PARTIAL CONTENT
Date: Wed, 3 Apr 2013 14:37:12 GMT
Content-Type: application/json
Accept-Ranges: items
Content-Range: items 123-222/223
Last-Modified: Tue, 2 Apr 2013 12:37:12 GMT

[
    { "titel": "Nieuw huiswerk", "categorie": "huiswerk", "datum": "30 Oct 1994 20:01:12 GMT"},
    { "titel": "Cijfer voor NL", "categorie": "resultaat", "datum": "30 Oct 2013 13:10:32 GMT"},
    …
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Hier kan je zien dat de 100 meest recente van de 223 berichten zijn
teruggegeven (123-222).</p>
</div>
</div>
<div class="sect3">
<h4 id="_terugbladeren_door_partial_content">5.6.2. Terugbladeren door partial content</h4>
<div class="paragraph">
<p>Een client kan terugbladeren door alle elementen uit een resource door
de request header Range op te geven met de verwachtte range.</p>
</div>
<div class="listingblock">
<div class="title">Request</div>
<div class="content">
<pre class="pygments highlight"><code>GET /nieuws
Accept: application/json
Range: items=100-199</code></pre>
</div>
</div>
<div class="paragraph">
<p>Hier zien we een request dat de berichten opvraagt van nummer 100 tot
en met 199. Een client kan een request sturen met een spanne groter dan
100, maar dan zal er slechts 100 teruggestuurd worden:</p>
</div>
<div class="listingblock">
<div class="title">Request</div>
<div class="content">
<pre class="pygments highlight"><code>GET /nieuws
Accept: application/json
Range: items=100-299</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Response</div>
<div class="content">
<pre class="pygments highlight"><code>HTTP/1.1 206 PARTIAL CONTENT
Date: Wed, 3 Apr 2013 14:37:12 GMT
Content-Type: application/json
Accept-Ranges: items
Content-Range: items 100-199/223</code></pre>
</div>
</div>
<div class="paragraph">
<p>De server heeft hier de elementen 100-199 teruggegeven van de 223 in
totaal.</p>
</div>
<div class="sect4">
<h5 id="_omgaan_met_ongeldige_ranges">Omgaan met ongeldige ranges</h5>
<div class="paragraph">
<p>Volgens [RFC-2626 sectie 10.4.17](<a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html#sec10.4.17" class="bare">http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html#sec10.4.17</a>)
geldt het volgende:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>10.4.17 416 Requested Range Not Satisfiable</p>
</div>
<div class="paragraph">
<p>A server SHOULD return a response with this status code if a request
included a Range request-header field (section 14.35), and none of the
range-specifier values in this field overlap the current extent of the
selected resource, and the request did not include an If-Range
request-header field. (For byte-ranges, this means that the
first-byte-pos of all of the byte-range-spec values were greater than
the current length of the selected resource.)</p>
</div>
<div class="paragraph">
<p>When this status code is returned for a byte-range request, the
response SHOULD include a Content-Range entity-header field specifying
the current length of the selected resource (see section 14.16). This
response MUST NOT use the multipart/byteranges content- type.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Vertaald naar onze omgeving waar we gebruik maken van items in plaats
van bytes betekent dit dat we bij een verzoek met <code>Range:
items=100-199</code> wanneer er minder dan 100 items voor die resource
aanwezig zijn een <code>416 REQUESTED RANGE NOT SATISFIABLE</code> zullen
retourneren. Bijvoorbeeld wanneer er 48 nieuwsberichten voor een
gebruiker beschikbaar zijn, zal het volgende verzoek:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>GET /nieuws
Range: items=100-199</pre>
</div>
</div>
<div class="paragraph">
<p>het volgende antwoord geven:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 416 RANGE NOT SATISFIABLE
Content-Range: items */48</pre>
</div>
</div>
<div class="paragraph">
<p>Zie ook [sectie 14.16 van RFC2616](<a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.16" class="bare">http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.16</a>).</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_meerdere_requests_samenvoegen">5.6.3. Meerdere requests samenvoegen</h4>

</div>
<div class="sect3">
<h4 id="_caching_headers_en_e_tags">5.6.4. Caching headers en e-tags</h4>

</div>
</div>
<div class="sect2">
<h3 id="_mapping_van_entiteit_naar_rest">5.7. Mapping van entiteit naar REST</h3>
<div class="paragraph">
<p>De REST-API publiceert aparte resources die los staan van het
persistente datamodel. Natuurlijk lijken deze vaak veel op elkaar maar
je wil niet direct het datamodel één op één publiceren omdat je dan
vast zit aan die representatie. Om het makkelijk te maken om te
vertalen tussen beide lagen wordt gebruik gemaakt van een mapping
raamwerk: orika.</p>
</div>
<div class="sect3">
<h4 id="_standaard_mapping">5.7.1. Standaard mapping</h4>

</div>
<div class="sect3">
<h4 id="_van_twee_objecten_naar_één">5.7.2. Van twee objecten naar één</h4>
<div class="paragraph">
<p>Om twee persistente objecten te mappen op één externe resource moet je
voor beide classes mappings aanmaken, en van één aangeven dat het een
koppeling is. Onderstaand voorbeeld uit EduArte Onderwijs laat zien hoe
je de entiteiten <code>Notitie</code> en <code>BegeleidingsFormulierNotitie</code> kan mappen
naar één resource <code>RBegeleidingsFormulierNotitie</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">    map(Notitie.class, RBegeleidingsFormulierNotitie.class, Link.KOPPELING);
    map(BegeleidingsFormulierNotitie.class, RBegeleidingsFormulierNotitie.class);</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
uitleggen waarom Notitie dan de koppelentiteit is
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Hierbij wordt bij de <code>Notitie</code> aangegeven dat het de koppelentiteit is.</p>
</div>
</div>
<div class="sect3">
<h4 id="_properties_negeren">5.7.3. Properties negeren</h4>
<div class="paragraph">
<p>Het kan voorkomen dat een property naam twee keer gemapt wordt omdat je
bijvoorbeeld twee objecten op één resource mapt. Onderstaande classes
zijn hier een voorbeeld van:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">@Entity
public class Notitie {
    @ManyToOne
    private Medewerker auteur;

    public Medewerker getAuteur() {
        return auteur;
    }
}

@Entity
public class BegeleidingsFormulierNotitie {
    @ManyToOne
    private Notitie notitie;

    public String getAuteur() {
       return getNotitie().getAuteur().getNaam();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Als je deze twee classes op één resource afbeeldt heb je een conflict:
welke van de twee <code>getAuteur()</code> accessors moet worden gemapt naar de
resource?</p>
</div>
<div class="paragraph">
<p>Als beide properties van hetzelfde type zijn gaat dit in het algemeen
goed, zolang beide getters naar hetzelfde object verwijzen, of gaat het
ongemerkt mis: de laatste wint. Echter wanneer ze verschillende types
hebben krijg je runtime errors omdat bijvoorbeeld een <code>String</code> niet naar
een <code>RMedewerker</code> geconverteerd kan worden.</p>
</div>
<div class="paragraph">
<p>Je kan dit oplossen door je mapping builder de interface
<code>SpecializedMappingBuilder</code> te laten implementeren. In de methode
<code>postProcess</code> kan je dan de mapping aanpassen door specifieke
properties te negeren:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">@Override
public void postProcess(ClassMapBuilder&lt; ? extends IEntiteit, ? extends ILinkable&gt; classMapBuilder)
{
	Class&lt; ? extends IEntiteit&gt; aType = classMapBuilder.getAType().getRawType();

	// BegeleidingsFormulierNotitie heeft een 'helper' methode "getAuteur" die we
	// moeten overslaan zodat de auteur uit de notitie kan worden gemapped door Orika.
	if (BegeleidingsFormulierNotitie.class.isAssignableFrom(aType))
	    classMapBuilder.fieldMap("auteur").exclude().add();
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wicket_client_applicaties_best_practices">5.8. Wicket client-applicaties: best practices</h3>
<div class="sect3">
<h4 id="_laat_de_code_page_code_de_rest_requests_beheren">5.8.1. Laat de <code>Page</code> de REST-requests beheren</h4>
<div class="paragraph">
<p>Hoewel het in principe mogelijk is, en met injection zelfs heel eenvoudig, om
een component zelf een REST-call te laten doen (bijvoorbeeld een custom panel
met persoonsgegevens dat allerlei details ophaalt en kan wijzigen), is dit
meestal geen goed idee. Het leidt tot minder goed herbruikbare componenten
(omdat de REST-call er in verschillende contexten net iets anders uit kan zien)
en is vatbaar voor performance-issues; als allerlei componenten op de pagina op
eigen houtje REST-requests doen wordt de laadtijd van die pagina al snel te
groot.</p>
</div>
<div class="paragraph">
<p>Aangezien je wilt kunnen sturen op de laadtijd van de pagina ligt het meer voor
de hand om de communicatie met de REST-clients zo veel mogelijk via de <code>Page</code>
te laten lopen. Je ziet dan duidelijk hoeveel requests een pagina doet, en als
het sneller moet kan je beslissen om requests samen te voegen door bijvoorbeeld
"additional objects" of een maatwerk-REST-methode. Ook het cachen van resultaten
uit de REST-laag doe je het beste in de state van de pagina.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_autoforms">6. Autoforms</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Autoforms worden gebruikt om snel CRUD formulieren te genereren voor entiteiten.
De autoforms hebben de mogelijkheid om markup te genereren volgens een bepaalde strategie zodat deze project afhankelijk ingesteld kan worden.</p>
</div>
<div class="sect2">
<h3 id="_autofieldset">6.1. AutoFieldSet</h3>
<div class="paragraph">
<p>AutoFieldSet is de centrale component voor autoforms.
Een AutoFieldSet bevat alle toon- en bewerkingscomponenten voor de Java properties die je opgeeft bij de AutoFieldSet.</p>
</div>
<div class="sect3">
<h4 id="_standaard_gebruik_van_autofieldset">6.1.1. Standaard gebruik van AutoFieldSet</h4>
<div class="paragraph">
<p>Een standaard voorbeeld voor het gebruik van een <code>AutoFieldSet</code> is om van een database entiteit de verschillende eigenschappen te tonen.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">@Entity
public class Cheese extends Entiteit
{
    private String name;

    private String description;

    private Double price;

    // ... getters and setters
}

public class CheesePage extends WebPage
{
    public CheesePage(Cheese cheese)
    {
        IModel&lt;Cheese&gt; cheeseModel = ModelFactory.getModel(cheese);

        AutoFieldSet&lt;Cheese&gt; cheeseDisplay = new AutoFieldSet&lt;&gt;("cheese", cheeseModel);
        cheeseDisplay.setProperties("name", "description", "price");
        cheeseDisply.setRenderMode(RenderMode.DISPLAY);
        add(cheeseDisplay);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Afhankelijk van hoe de autoforms geconfigureerd zijn, zal er andere HTML door de AutoFieldSet gerenderd worden.</p>
</div>
<div class="paragraph">
<p>De properties die je aangeeft worden de gerenderde velden.
Je kan de manier waarop deze velden gerenderd worden aanpassen met <em>field modifiers</em>.
Zo kan je het <em>class</em> attribuut toevoegen met een <em>HtmlClassModifier</em>, of een veld aan/uit zetten met een <em>EnableModifier</em>, of een veld verplicht maken met een <em>RequiredModifier</em> als deze dat al niet was.</p>
</div>
<div class="paragraph">
<p>Een AutoFieldSet (in de volksmond ook bekend als autoform) kan opereren in twee
modi: tonen en bewerken.</p>
</div>
</div>
<div class="sect3">
<h4 id="_tonen_en_bewerken">6.1.2. Tonen en bewerken</h4>
<div class="paragraph">
<p>Autoforms hebben een lezen en schrijf mode. Je kan dit aanpassen door
het zetten van de RenderMode:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">// voor alleen lezen
autofields.setRenderMode(RenderMode.DISPLAY);

// of voor wijzigen
autofields.setRenderMode(RenderMode.EDIT);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Naast het tonen en bewerken kan je autoforms ook verschillende markup varianten
laten genereren.</p>
</div>
</div>
<div class="sect3">
<h4 id="_alternatieve_markup_varianten">6.1.3. Alternatieve markup varianten</h4>
<div class="paragraph">
<p>Je kan verschillende markup genereren voor een autofieldset. Zo kan je
voor Taiga, EduArte, Bootstrap en Som specifieke markup genereren, en
voor je eigen project een alternatieve layout genereren.</p>
</div>
<div class="paragraph">
<p>Je kan een eigen markup strategie toepassen door deze te registeren bij
de AutoFormsRegistry:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">AutoFormRegistry autoFormReg = AutoFormRegistry.getInstance();
autoFormReg.registerMarkupRenderer(TaigaContextMarkupRenderer.NAME,
    new TaigaContextMarkupRenderer());</code></pre>
</div>
</div>
<div class="paragraph">
<p>Er zijn al diversie markup strategieën voor autoforms gebouwd.
Hieronder worden de bekendste kort omschreven.</p>
</div>
<div class="sect4">
<h5 id="_simple">Simple</h5>
<div class="paragraph">
<p>De <strong>Simple</strong> markup strategie voor autoforms genereert een eenvoudige
layout voor elk component. Deze is standaard onderdeel van
cobra-autoforms.</p>
</div>
<div class="paragraph">
<p>Een voorbeeld van de markup uit SimpleInputTextEditorContainer.html:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html">&lt;input type="text" wicket:id="formField" class="inpText" /&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_table">Table</h5>
<div class="paragraph">
<p>De <strong>Table</strong> markup strategie voor autoforms gebruikt tables om de layout
van de componenten te bepalen. Deze is standaard onderdeel van
cobra-autoforms. Deze wordt met name gebruikt door EduArte.</p>
</div>
<div class="paragraph">
<p>Een voorbeeld van de markup uit EduArteTableFieldSetMarkupPanel.html:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html">&lt;table wicket:id="table" class="tblData tblInputs"&gt;
  &lt;thead wicket:id="captionContainer"&gt;
    &lt;tr&gt;
      &lt;th colspan="2"&gt;
        &lt;wicket:container wicket:id="caption" /&gt;
        &lt;span class="inpDescription ui-icon ui-icon-help" wicket:id="description"&gt;&lt;/span&gt;
      &lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr wicket:id="inputFields"/&gt;
  &lt;/tbody&gt;
&lt;/table&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_taiga">Taiga</h5>
<div class="paragraph">
<p>De <strong>Taiga</strong> markup strategie voor autoforms genereert een responsive
layout gebaseerd op het Taiga CSS raamwerk. Wordt onder andere gebruikt
in Digdag en EduArte Onderwijs. Deze is standaard onderdeel van
cobra-autoforms.</p>
</div>
<div class="paragraph">
<p>Een voorbeeld van de markup uit ControlGroup.html:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html">&lt;label wicket:id="labelContainer"&gt;
  &lt;wicket:container wicket:id="label"&gt;Text input&lt;/wicket:container&gt;
  &lt;i class="icon-info-sign" wicket:id="infoSign"&gt;&lt;/i&gt;
&lt;/label&gt;

&lt;div class=" "&gt;
  &lt;wicket:body /&gt;

  &lt;ul class="form-errors" wicket:id="helpContainer"&gt;
    &lt;li wicket:id="helpItem"&gt;&lt;/li&gt;
  &lt;/ul&gt;
&lt;/div&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>De Taiga markup strategie heeft twee render strategieën: inline en
horizontaal. Voor Taiga dien je nog wel zelf de juiste stylesheets toe
te voegen aan je paginas.</p>
</div>
</div>
<div class="sect4">
<h5 id="_bootstrap">Bootstrap</h5>
<div class="paragraph">
<p>De <strong>Bootstrap</strong> markup strategie voor autoforms genereert Twitter Bootstrap compatible markup (V3.3).
Deze is geen standaard onderdeel van cobra-autoforms, maar daarvoor dien je nog cobra-autoforms-bootstrap toe te voegen aan je project.
Daarnaast dien je nog aan Wicket bekend maken welke Bootstrap gebruikt moet worden.</p>
</div>
<div class="paragraph">
<p>Je kan ervoor kiezen om alleen de autoforms Bootstrap te gebruiken en zelf componenten te maken voor de overige Bootstrap markup.
Dit doe je door <code>Bootstrap.install(this)</code> aan te roepen in je <code>Application#init()</code>.</p>
</div>
<div class="paragraph">
<p>Wanneer je gebruik wil maken van de <a href="https://github.com/l0rdn1kk0n/wicket-bootstrap/">Wicket Bootstrap integratie</a> kan je die aan je project toevoegen en dan de juiste <code>Bootstrap.install(this)</code> aan te roepen (let erop dat je niet die van Cobra gebruikt).</p>
</div>
<div class="paragraph">
<p>Met autoforms kan je dus gegevens tonen en bewerken. Daarnaast kunnen autoforms
in verschillende markup varianten gerenderd worden. Met behulp van
fieldmodifiers kan je per veld de manier waarop een gerenderd veld zich gedraagd
of getoond wordt volledig aanpassen.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_met_fieldmodifiers_autoforms_op_veldniveau_aanpassen">6.2. Met fieldmodifiers autoforms op veldniveau aanpassen</h3>
<div class="paragraph">
<p>Je kan een autoform volledig aanpassen aan je wensen met behulp van
fieldmodifiers. Zo kan je dynamisch een veld enabled of disabled maken
met de <code>EnableModifier</code>. De meeste zaken kan je al met behulp van
annotaties specificeren op je velden, maar als je daar van af wilt
wijken kan dat met de fieldmodifiers.</p>
</div>
<div class="sect3">
<h4 id="_wachtwoordfieldmodifier_voor_wijzigen_van_wachtwoordvelden">6.2.1. WachtwoordFieldModifier voor wijzigen van wachtwoordvelden</h4>
<div class="paragraph">
<p>Wanneer je een wachtwoord laat wijzigen door een gebruiker is het
gebruikelijk om de gebruiker het nieuwe wachtwoord twee keer te laten
invullen om typefouten te voorkomen. Deze fieldmodifier zorgt er voor
dat er een tweede veld "Herhaal wachtwoord" wordt toegevoegd aan je
autoform.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">autoform.setProperties("username", "password");
autoform.addFieldModifier(new WachtwoordFieldModifier("password")); <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>dit veld dient gelijk te zijn aan het wachtwoord property van de
bean die bewerkt wordt, in dit geval dus <code>password</code>.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_pseudofieldmodifier">6.2.2. PseudoFieldModifier</h4>
<div class="paragraph">
<p>De <code>PseudoFieldModifier</code> is bedoeld voor het bewerken van properties
die geen onderdeel uit maken van de class die je via de AutoFieldSet
bewerkt, maar bijvoorbeeld geregistreerd staan op de pagina of het
panel. Je kan dit bijvoorbeeld gebruiken om een vlag aan of uit te
zetten om meer of minder componenten te tonen.</p>
</div>
</div>
<div class="sect3">
<h4 id="_eigen_fieldmodifier_schrijven">6.2.3. Eigen fieldmodifier schrijven</h4>
<div class="paragraph">
<p>Als je als basis <code>FieldAdapter</code> gebruikt, dien je in elk geval één
methode te implementeren. Er is een hele life-cycle beschikbaar voor
fieldmodifiers, welke wordt geïmplementeerd door `Action`s. Je kan je
abonneren op elk van de actions voor een bepaalde property in deze
methode:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">@Override
public &lt;T&gt; boolean isApplicable(AutoFieldSet&lt;T&gt; fieldSet,
        Property&lt;T, ? , ? &gt; property,
        Action action)
{
    return false;
}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_create">Create</h5>
<div class="paragraph">
<p>Wanneer je aangeeft dat jouw fieldmodifier <em>applicable</em> is voor een
bepaalde property en action, dan wordt het bijbehorende lifecycle event
aangeroepen:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">@Override
public &lt;T&gt; boolean isApplicable(AutoFieldSet&lt;T&gt; fieldSet,
        Property&lt;T, ? , ? &gt; property,
        Action action)
{
    return "foo".equals(property.getPath()) &amp;&amp; action == Action.CREATION;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In dit voorbeeld is de fieldmodifier toepasbaar voor de property <em>foo</em>
en de actie <em>creation</em>. Dit betekent dat je dan ook de methode
<code>createField</code> moet implementeren:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">@Override
public &lt;T&gt; Component createField(AutoFieldSet&lt;T&gt; fieldSet, String id, IModel&lt; ? &gt; model,
        Property&lt;T, ? , ? &gt; property, FieldProperties&lt;T, ? , ? &gt; fieldProperties)
{
    return new EmptyPanel(id);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In deze methode kan je je custom component creëren voor je
fieldmodifier.</p>
</div>
</div>
<div class="sect4">
<h5 id="_fieldclass">Fieldclass</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
beschrijf wanneer je deze zou willen gebruiken.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_model_2">Model</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
beschrijf wanneer je deze zou willen gebruiken.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rechten">7. Rechten</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In een REST-applicatie is het lastig om met een use-case georiënteerde
(lees pagina-rechten zoals in ParnasSys, Som en EduArte gebruikt)
rechtenstructuur te werken.</p>
</div>
<div class="paragraph">
<p>Zo is het in een use-case geörienteerde rechtenstructuur mogelijk om
een gebruiker geen rechten tot studentgegevens te geven op een pagina
voor stagebedrijven, maar wel in een groepoverzicht. Echter in een
data-georiënteerde rechtenstructuur kan je alleen aangeven of iemand
recht heeft op die data of niet.</p>
</div>
<div class="sect2">
<h3 id="_rechten_in_de_rest_laag">7.1. Rechten in de REST-laag</h3>
<div class="paragraph">
<p>De rechten van een gebruiker voeg je toe in de <code>AccountServiceImpl</code>.</p>
</div>
<div class="paragraph">
<p><code>RestPermissions</code> kennen de volgende eigenschappen:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>De class/entity waar de gebruiker bepaald operaties op mag doen.
Bijv: <code>RDeelnemer.class</code></p>
</li>
<li>
<p>1 of meerder CRUD operations die de gebruiker op de betreffende
class mag doen. Bijv: <code>Operation.READ</code></p>
</li>
<li>
<p>De categorie. Bijv: <code>PermissionCategory.ORGANISATIE</code></p>
</li>
<li>
<p>En het id van de categorie. Bijv: Het id van de organisatie waar de
gebruiker aan gekoppeld is.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Om een gebruiker op organisatie niveau rechten te geven voor het lezen
van deelnemers voeg je onderstaande permissie toe:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">new RestPermissionImpl(Rdeelnemer.class,
                       Operation.READ,
                       PermissionCategory.ORGANISATIE,
                       account.getOrganisatie().getId());</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
De rechten die hier worden toegekend gelden ook voor de subclasses
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Een gebruiker is meestal maar gekoppeld aan 1 organisatie, wil je
bijvoorbeeld een medewerker schrijfrechten geven op de deelnemers van
alle groepen waaraan hij gekoppeld is kan dat op de volgende manier
door gebruik te maken van <code>PermissionCategoryInstance</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">List&lt;PermissionCategoryInstance&gt; groepRechten = new ArrayList&lt;&gt;();
for (GroepDocent docent : medewerker.getGroepenDocent())
{
    groepRechten.add(new PermissionCategoryInstance(
                PermissionCategory.GROEP,
                docent.getGroep().getId()));
}
new RestPermissionImpl(Rdeelnemer.class,
          Operation.UPDATE,
          PermissionCategory.GROEP,
          groepRechten);</code></pre>
</div>
</div>
<div class="paragraph">
<p>De rechten worden gecontroleerd tijdens het mappen (het omzetten van de
database entiteiten naar de REST-entiteiten en vice versa) Dit gebeurt
in <code>RestMappingStrategy</code>.</p>
</div>
<div class="paragraph">
<p>Om de rechten op deelnemers waaraan een medewerker via een groep
gekoppeld is te controleren moet de applicatie weten hoe je via een
deelnemer bij de groep komt. Hier zijn verifiers voor.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">@Singleton
@ForCategory(EduArioPermissionCategory.GROEP)
public class DeelnemerGroepVerifier extends
        AbstractImpliedPermissionVerifier&lt;RDeelnemerPrimer, Deelnemer&gt;
{
    @Override
    protected boolean doVerify(Deelnemer entiteit, PermissionCategoryInstance permissionInstance)
    {
        for (Groep groep : entiteit.getGroepenOpPeildatum())
        {
            if (isImplied(RGroepPrimer.class, groep, permissionInstance))
                return true;
        }
        return false;
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Zorg ervoor dat er altijd precies 1 verifier van toepassing is
        op een te mappen (linkable,entiteit)-combinatie. Een verifier is per
        default ook op subclasses van toepassing, dus pas hiermee op: als er
        meerdere verifiers van toepassing zijn, is het onbepaald welke gebruikt
        wordt (dit kan zelfs uitlopen op een discrepantie tussen een
        ontwikkelomgeving en een productieomgeving!). Override zonodig
        <code>AbstractPermissionVerifier.isApplicable</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Om te zorgen dat je niet heel veel entiteiten ophaalt uit de database
waarvan je bij het verifiëren van de rechten achter komt dat je geen
rechten op die entiteiten hebt, worden in de <code>AbstractDAO</code>
securityconstraints toegevoegd aan elke query die uitgevoerd wordt, en
gebruik maakt van het zoekfilter. Om dit af te dwingen moeten de
annotatie <code>@Enforces</code> op de parameter van het zoekfilter gezet worden.
Om ervoor te zorgen dat er altijd op de juiste organisatie gefilterd
wordt voegen we de volgende code toe aan <code>AbstractInstellingZoekFilter</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">@Parameter(EntityQueryParameter.class)
@Enforces(PermissionCategory.ORGANISATIE)
public FilterValue&lt;Instelling&gt; organisatie()
{
    return recordFilter(new In&lt;&gt;(InstellingEntiteit_.organisatie));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Zoekfilter-parameters met <code>@Enforces</code> worden automatisch gevuld
met de rechten van de gebruiker.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Als er bij het controleren van de rechten rest entiteiten
verstuurd dreigen te worden naar de voorkant waar de gebruiker geen
recht op heeft, wordt als het om toplevel elementen gaat, een 403
teruggegeven, als het om een geneste lijst gaat worden de items waar de
gebruiker geen recht op heeft er uitgefilterd.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In sommige gevallen kan het nodig zijn om permissies te checken die
haaks staan op de bestaande permissies. Een voorbeeld hiervan zijn de
zorglijnen: via de rollen van een medewerker is deze gerechtigd voor
zorglijnen t/m een bepaald niveau. Een medewerker mag een bijbehorend
traject alleen inzien als hij een voldoende hoge zorglijn heeft <strong>en</strong>
rechten heeft om het traject in te zien. De eerder beschreven oplossing
biedt alleen ondersteuning voor <strong>of</strong>.</p>
</div>
<div class="paragraph">
<p>Om de zorglijnen los van de andere rechten te kunnen verifieren, is een
extra <code>PermissionCategory</code> nodig met de bijbehorende permissions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">public class PermissionCategory {
    ...
    public static final String ZORGLIJN = "ZORGLIJN";
    ...
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">new RestPermissionImpl(RTrajectPrimer.class,
                       Operation.READ,
                       PermissionCategory.ZORGLIJN, zorglijn)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Om te zorgen dat deze nieuwe <code>PermissionCategory</code> niet gecombineerd
wordt met anderen, moet hij in een eigen groep geplaatst worden in de
baseclass van de DAO:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">@Override
protected Map&lt;String, Integer&gt; getPermissionCategoryGrouping() {
    ImmutableMap.Builder&lt;String, Integer&gt; mb = ImmutableMap.builder();
    mb.put(PermissionCategory.LANDELIJK, 0);
    mb.put(PermissionCategory.ORGANISATIE, 1);
    mb.put(PermissionCategory.ZORGLIJN, 2);
    mb.put(PermissionCategory.EENHEID_LOCATIE, 3);
    ...
    return mb.build();
}

@Override
protected boolean isAlwaysEnforced(Integer group) {
    return group.intValue() == 1 || group.intValue() == 2;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Als laatste is het nodig om een <code>AbstractSpecializedPermissionVerifier</code>
te maken met <code>@ForCategory(PermissionCategory.ZORGLIJN)</code>. De
implementatie hiervan is een oefening voor de lezer.</p>
</div>
<div class="sect3">
<h4 id="_rechten_doorgeven_met_embeds">7.1.1. Rechten doorgeven met Embeds</h4>
<div class="paragraph">
<p>Als je een afspraak plant dan wil je vaak ook de genodigden kunnen
zien. Als je bijvoorbeeld het volgende model hebt:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>@startuml
class Afspraak
class AfspraakParticipant
class Groep
class Student
class Medewerker

Afspraak *- AfspraakParticipant : participanten &gt;
AfspraakParticipant .. Groep
AfspraakParticipant .. Student
AfspraakParticipant .. Medewerker
@enduml</pre>
</div>
</div>
<div class="paragraph">
<p>Iemand kan een afspraak plannen tussen een medewerker en een student
waarbij de medewerker geen rechten heeft om de student te zien. Wanneer
je de Afspraak en de AfspraakParticipanten opvraagt bij de REST API zal
de student niet meegenomen worden in de lijst van participanten.</p>
</div>
<div class="paragraph">
<p>Wat je eigenlijk wilt is dat je de participanten van de afspraak wel
kan zien als je het recht hebt om de afspraak te zien. Dit kan je
oplossen door in de REST resource voor <code>AfspraakParticipant</code> de
<code>@Embeds</code> annotatie op te nemen:
</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">@Embeds({Deelnemer.class, Medewerker.class, Groep.class})
public class AfspraakParticipant
{
	@XmlElement
	private Deelnemer deelnemer;

	@XmlElement
	private Medewerker medewerker;

	@XmlElement
	private Groep groep;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Met <code>@Embeds</code> wordt aangegeven dat een entiteit andere entiteiten bevat
en daarmee de lees-rechten door geeft. Als een gebruiker het recht
heeft om een hoofd-entiteit te lezen, kan de gebruiker ook entiteiten
van de aangegeven types die zich bevinden binnen de hoofd-entiteit
lezen.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rechten_in_een_wicket_applicatie">7.2. Rechten in een Wicket-applicatie</h3>
<div class="paragraph">
<p>Om ervoor te zorgen dat aan de voorkant ook bepaalde links naar
pagina&#8217;s niet zichtbaar zijn, kan de volgende annotatie op de pagina
gezet worden.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">@RequiresPermission(type = Rdeelemer.class, operation = Operation.READ,
        granularity = PermissionGranularity.ANY)</code></pre>
</div>
</div>
<div class="paragraph">
<p>De permissies die een account heeft worden aan het account toegevoegd,
en meegegeven via de REST-laag. Door gebruik te maken van de
<code>TargetBasedSecurePageLink</code> worden de rechten gecontroleerd, en
afhankelijk daarvan de link gerenderd.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_javaee">8. JavaEE</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_configuratie">8.1. Configuratie</h3>
<div class="sect3">
<h4 id="_jndi">8.1.1. JNDI</h4>
<div class="sect4">
<h5 id="_compatibiliteit_met_tomcat">Compatibiliteit met Tomcat</h5>

</div>
</div>
<div class="sect3">
<h4 id="_system_properties">8.1.2. System properties</h4>

</div>
</div>
<div class="sect2">
<h3 id="_jobs">8.2. Jobs</h3>
<div class="sect3">
<h4 id="_creëer_je_eigen_job">8.2.1. Creëer je eigen job</h4>

</div>
<div class="sect3">
<h4 id="_op_slechts_1_server_laten_werken">8.2.2. Op slechts 1 server laten werken</h4>
<div class="paragraph">
<p>De meeste jobs kan je niet tegelijkertijd laten werken, omdat ze werken
op dezelfde gegevens en dan bijvoorbeeld resultaten dubbel verwerken.
Om dit te voorkomen wil je een job op slechts één server laten werken.
Je zou dit kunnen doen door een JNDI configuratie item te maken en deze
uit te lezen in je job. Probleem is dat JNDI-properties over het hele
cluster worden uitgerold en dus niet server-specifiek zijn. Daarom
gebruiken we vooralsnog system properties voor het aan- en uitzetten
van jobs.</p>
</div>
<div class="paragraph">
<p>Onderstaande job controleert voordat er daadwerkelijk werk gedaan wordt
of de jobs aangezet zijn.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">@Schedule(hour = "*", minute = "*/" + SCHEDULE_MINUTES, persistent = false)
@TransactionAttribute(TransactionAttributeType.REQUIRED)
private void doeWerk()
{
    if (!Boolean.parseBoolean(System.getProperty("eduario/service.jobs.enabled", "true")))
        return;
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Denk goed na over de standaardwaarde van deze system property. Bij
voorkeur laat je de jobs gewoon draaien. Als ze tegelijkertijd dezelfde
database entiteiten proberen aan te passen zal er één van de jobs
exceptions gaan gooien. Je kan dan op die machine de jobs uitzetten als
je dat vergeten was. Het staat je vrij om een eigen standaardwaarde
toe te passen.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_testen_met_junit_arquillian_en_selenium">9. Testen met JUnit, Arquillian en Selenium</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Testen is altijd een beetje een ondergeschoven kindje geweest. Met dit
hoofdstuk proberen we te beschrijven hoe je eenvoudig tests toevoegt aan
je project zonder dat je daarmee weken kwijt bent.</p>
</div>
<div class="sect2">
<h3 id="_schrijven_van_unit_tests_met_junit">9.1. Schrijven van Unit tests met JUnit</h3>
<div class="paragraph">
<p>Het testen kan op verschillende niveaus. Het basisniveau is het
schrijven van unit tests met JUnit. Deze testen op een laag niveau de
verwachtingen van jouw code. Een voorbeeld unit test:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">public class PersoonNaamFunctionsTest
{
    private RPersoonPrimer persoon;

    private Function&lt;RPersoonPrimer, String&gt; volledigeNaam;

    @Before
    public void setup() <i class="conum" data-value="1"></i><b>(1)</b>
    {
        volledigeNaam = PersoonFunctions.volledigeNaam();

        persoon = new RPersoonPrimer();
        persoon.setAchternaam("Achternaam");
        persoon.setRoepnaam("Roepnaam");
        persoon.setVoorvoegsel("Voorvoegsel");
        persoon.setVoornamen("Voornamen");
        persoon.setVoorletters("Voorletters");
    }

    @Test
    public void volledigeNaamAllesGevuld() <i class="conum" data-value="2"></i><b>(2)</b>
    {
        Assert.assertThat(volledigeNaam.apply(persoon),
            is("Roepnaam (Voornamen) Voorvoegsel Achternaam"));
    }

    @Test
    public void volledigeNaamGelijkeVoornaamEnRoepnaam() <i class="conum" data-value="3"></i><b>(3)</b>
    {
        persoon.setVoornamen(persoon.getRoepnaam());
        Assert.assertThat(volledigeNaam.apply(persoon), is("Roepnaam Voorvoegsel Achternaam"));
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Initialiseert de test case met standaard data</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Geef je test een goede naam die weergeeft wat je gaat testen</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Een tweede test scenario krijgt ook een duidelijke naam (dus niet
<code>test2()</code>)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Maar dit werkt alleen wanneer je geen database entiteiten wilt
benaderen, en geen database services of andere externe services nodig
hebt, zoals e-mail. Om het testen van componenten in een Java EE
omgeving mogelijk te maken zodanig dat je wel toegang hebt tot zulke
diensten is <em>Arquillian</em> ontwikkeld.</p>
</div>
</div>
<div class="sect2">
<h3 id="_gebruik_arquillian_voor_in_container_tests">9.2. Gebruik Arquillian voor In-Container Tests</h3>
<div class="paragraph">
<p><em>Arquillian</em> is een test raamwerk om (unit) tests uit te kunnen voeren
in een Java EE container. Hiermee kan je tests schrijven die
afhankelijk zijn van injectie, transacties en andere diensten die door
de serveromgeving geleverd worden. Een volledige beschrijving van
Arquillian is buiten de scope van dit documentatieproject. Voor meer
informatie over Arquilian kan je het beste <em>Arquillian Testing Guide</em>
<a href="#arq2013">[arq2013]</a> lezen.</p>
</div>
<div class="sect3">
<h4 id="_arquillian_in_een_notendop">9.2.1. Arquillian in een notendop</h4>
<div class="paragraph">
<p>Om je tests met Arquillian te laten werken moet je een aantal zaken
regelen:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>schrijf een methode om een <em>deployment</em> van je project te maken</p>
</li>
<li>
<p>laat de test runnen met de Arquillian runner</p>
</li>
<li>
<p>zorg voor een werkende Java EE container</p>
</li>
<li>
<p>schrijf je tests</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Een voorbeeld van een Arquillian test voor het controleren of een DAO
methode wel een conferentie in de database kan opslaan (om bijv. de
constraints te checken):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">@RunWith(Arquillian.class)
@Transactional(TransactionMode.ROLLBACK)
public ConferentieDaoTest
{
	@PersistenceContext             <i class="conum" data-value="1"></i><b>(1)</b>
	private EntityManager em;

	@Inject
	private ConferentieDao conferentieDao;  <i class="conum" data-value="2"></i><b>(2)</b>

    @Deployment
    public static EnterpriseArchive deployment()  <i class="conum" data-value="3"></i><b>(3)</b>
    { ... }

	private Conferentie createTopiconf20xx()
	{
		Conferentie conferentie = new Conferentie();
        ...
		conferentieDao.persist(conferentie); <i class="conum" data-value="4"></i><b>(4)</b>

		em.flush(); <i class="conum" data-value="5"></i><b>(5)</b>

		return conferentie;
	}

	@Test
	public void creeerConferentie() <i class="conum" data-value="6"></i><b>(6)</b>
	{
		Conferentie conferentie = createTopiconf20xx();

		assertThat(conferentie.getNaam(), is("Topiconf 20xx"));
	}
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Wordt door Arquillian geïnjecteerd</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Wordt door Arquillian geïnjecteerd</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Creëert het archief dat gedeployed kan worden voor deze test</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Slaat de conferentie op in de database</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Laat Hibernate de SQL voor het aanmaken uitvoeren</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>De daadwerkelijke test</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In deze test worden een aantal Java EE componenten direct in de test
class geïnjecteerd: de persistence context (ook bekend als entity
manager) en de EJB voor het beheren van conferentie-entiteiten
(<em>conferentieDao</em>). Deze worden door Arquillian geïnjecteerd nadat de
Java EE container de <em>deployment</em> heeft gestart. Deze deployment bouw
je in de methode met de annotatie <code>@Deployment</code>. Deze methode geeft in
dit geval een EAR structuur terug, maar kan ook een WAR teruggeven.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_arquillian_en_selenium_samen_laten_werken">9.3. Arquillian en Selenium samen laten werken</h3>
<div class="paragraph">
<p>Om een Selenium test te kunnen draaien met Arquillian dien je een
aantal zaken te regelen.</p>
</div>
<div class="sect3">
<h4 id="_extend_je_testcase_van_seleniumtestbase">9.3.1. Extend je Testcase van SeleniumTestBase</h4>
<div class="paragraph">
<p>Wanneer je testcases gaat schrijven heb je vaak extra diensten nodig,
zoals het genereren van testdata, of het wachten op het renderen van een
pagina. Om dit te faciliteren is er een baseclass gemaakt voor Selenium
tests: <code>SeleniumTestBase</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">public class MyFirstSeleniumTest extends SeleniumTestBase
{
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>De <code>SeleniumTestBase</code> zorgt ervoor dat je standaard met de Arquillian
testrunner draait (die een server start, je applicatie deployt, etc).</p>
</div>
<div class="paragraph">
<p>Het is niet verplicht om van deze superclass te overerven. Je kan ook
zelf een superclass definieren of direct de juiste annotaties zetten en
de <code>SeleniumTester</code> laten injecteren.</p>
</div>
</div>
<div class="sect3">
<h4 id="_schrijf_je_eigen_seleniumtestbase">9.3.2. Schrijf je Eigen SeleniumTestBase</h4>
<div class="paragraph">
<p>Niet elk project kan standaard van <code>SeleniumTestBase</code> overerven omdat
er een andere hierarchie nodig is voor de testclasses. Om je eigen
basisklasse te maken moet je een aantal zaken overnemen van
<em>SeleniumTestBase</em>.</p>
</div>
<div class="sect4">
<h5 id="_gebruik_de_arquillian_junit_runner">Gebruik de Arquillian JUnit Runner</h5>
<div class="paragraph">
<p>Om je tests uit te laten voeren met Arquillian dien je je testcase
klassen te annoteren met de <code>@RunWith</code> annotatie en deze te voorzien
van de <code>Arquillian</code> runner:</p>
</div>
<div class="listingblock">
<div class="title">Voorbeeld van het specificeren van de Arquillian runner</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java">@RunWith(Arquillian.class) <i class="conum" data-value="1"></i><b>(1)</b>
public class MyOwnTestBase
{
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Gebruik de Arquillian JUnit runner</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Door de Arquillian runner te specificeren zal je applicatie gedeployed
worden naar een container en de tests uitgevoerd worden in die
container. Om dan met de paginas in je applicatie te kunnen
interacteren dien je de <em>SeleniumTester</em> te injecteren.</p>
</div>
</div>
<div class="sect4">
<h5 id="_injecteer_de_seleniumtester">Injecteer de SeleniumTester</h5>
<div class="paragraph">
<p>De <code>SeleniumTester</code> overbrugt het gat tussen Wicket en Selenium. Met
deze tester kan je pagina&#8217;s openen en direct met componenten
interacteren. Indien je niet overerft van de <code>SeleniumTestBase</code> kan je
toegang krijgen tot de SeleniumTester door deze te injecteren:</p>
</div>
<div class="listingblock">
<div class="title">Voorbeeld hoe je een eigen base class schrijft voor je eigen tests</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java">@RunWith(Arquillian.class)
public class MyOwnTestBase
{
    @ArquillianResource <i class="conum" data-value="1"></i><b>(1)</b>
    private SeleniumTester tester;

    public SeleniumTester getTester()
    {
        return tester;
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Injecteer de tester door Arquillian</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Door de tester als <em>ArquillianResource</em> te annoteren krijg je toegang
tot de Seleniumtester.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_maak_een_suite">9.3.3. Maak een Suite</h4>
<div class="paragraph">
<p>Je dient aan te geven dat jouw suite een Selenium suite is zodat Cobra
de juiste dependencies kan includen. Dit doe je door de
<code>@SeleniumConfiguration</code> annotatie te gebruiken:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">@ArquillianSuiteDeployment
@SeleniumConfiguration
public class KaaswinkelSeleniumDeployment
{
    @Deployment
    public static WebArchive createDeployment()
    {
        return DefaultWarBuilder.createFromPom().addPackages(true,
            KaaswinkelSeleniumDeployment.class.getPackage());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Je moet aan Arquillian vertellen dat dit een testsuite is, en wat voor
deployment er gedaan moet worden om de suite te kunnen uitvoeren.</p>
</div>
<div class="paragraph">
<p>Standaard gaat Cobra er vanuit dat je een Java EE project wilt testen
waarbij je niet direct in je Wicket pagina&#8217;s gebruik kan maken van JPA
services. Indien je project wel op zo&#8217;n manier is opgezet dien je een
extra configuratie te specificeren:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">@SeleniumConfiguration(artifact = "nl.topicus.cobra:cobra-selenium")
public class MyFirstMonolithSeleniumTest extends SeleniumTestBase
{
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Deze configuratie is specifiek bedoeld voor applicaties die
cobra-kitchensink gebruiken. Je kan ook je eigen configuratie maken.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO beschrijven hoe je je eigen configuratie kan maken en wanneer je
dat zou willen.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_maak_een_deployment">9.3.4. Maak een Deployment</h4>
<div class="paragraph">
<p>Om een applicatie te kunnen testen met Arquillian dien je een deployment
te maken zodat Arquillian die naar de container kan sturen. Een
deployment is een package van de code die je wilt testen. Een voorbeeld
daarvan is jouw applicatie.</p>
</div>
<div class="paragraph">
<p>Je maakt gebruik van de <code>DefaultWarBuilder</code> uit Cobra om op basis van de
POM van jouw project een WAR te genereren die Arquillian kan deployen
naar een Wildfly.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">@Deployment
public static WebArchive createDeployment()
{
    return DefaultWarBuilder.createFromPom().addPackages(testcasePackages);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Deze methode creëert een WAR archive met alle juiste dependencies en de
juiste instellingen zodat Selenium en Arquillian samenwerken en je op
een eenvoudige manier tests kan schrijven.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_genereer_databasevulling_met_entitybuilders">9.4. Genereer databasevulling met EntityBuilders</h3>
<div class="paragraph">
<p>Testcases zijn vaak afhankelijk van specifieke scenario&#8217;s in de database.
Een mogelijkheid is om alle queries die deze scenario&#8217;s opmaken, uit te
programeren in mock DAOs. Echter, dit kunnen zeer veel queries zijn, en
deze queries worden op deze manier ook niet getest. Betrouwbaardere
testresultaten kunnen worden verkregen als de records daadwerkelijk uit de
database gelezen kunnen worden. Bestaande oplossingen vereisen dat hiervoor
een dataset-bestand geschreven moet worden met alle benodigde records.
Aangezien dit voor een eenvoudige testcase al snel meer dan 100 records
zijn, gaat een dergelijke oplossing snel in de papieren lopen.
<code>EntityBuilders</code> bieden hier een oplossing voor.</p>
</div>
<div class="sect3">
<h4 id="_entitybuilder">9.4.1. EntityBuilder</h4>
<div class="paragraph">
<p>Een <code>EntityBuilder</code> is een object waarmee eenvoudig, met gebruik van veel
defaults, snel entiteiten gevuld kunnen worden. Een voorbeeld van een
<code>EntityBuilder</code> voor <code>Instelling</code> is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">@Dependent <i class="conum" data-value="1"></i><b>(1)</b>
public class InstellingBuilder extends EntityBuilder&lt;Instelling&gt; <i class="conum" data-value="2"></i><b>(2)</b>
{
    public InstellingBuilder()
    {
        met(Organisatie_.actief, true); <i class="conum" data-value="3"></i><b>(3)</b>
        met(NaamEntiteit_.naam, UUID.randomUUID().toString());
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>EntityBuilders</code> worden via CDI gevonden, en moeten altijd
<code>@Dependent</code> zijn</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>EntityBuilders</code> extenden de <code>EntityBuilder</code> class</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>In de default constructor worden de waarden gezet die als default
gelden voor alle instances van de entiteit (in dit geval <code>Instelling</code>).</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>De <code>EntityBuilder</code> in het bovenstaande voorbeeld is een <strong>default</strong>
<code>EntityBuilder</code>. De waarden die in een <strong>default</strong> builder geset worden,
zullen voor alle instanties van het type gelden. In veel gevallen is dit
voldoende, maar het is ook vaak nodig om specifieke invullingen te geven
aan entiteiten. Hiervoor kunnen zogenaamde <strong>specific</strong> builders gebruikt
worden:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">@Dependent
public class AfspraakBuilder extends EntityBuilder&lt;Afspraak&gt;
{
    public AfspraakBuilder()
    {
        met(Afspraak_.titel, "Default afspraak"); <i class="conum" data-value="1"></i><b>(1)</b>
    }

    @Dependent <i class="conum" data-value="2"></i><b>(2)</b>
    public static class RoosterAfspraakBuilder extends AfspraakBuilder <i class="conum" data-value="3"></i><b>(3)</b>
    {
        public RoosterAfspraakBuilder()
        {
            met(Afspraak_.afspraakType, zoek(AfspraakType.class) <i class="conum" data-value="4"></i><b>(4)</b>
                .op(AfspraakType_.category, AfspraakTypeCategory.ROOSTER));
            metDefault(Afspraak_.lesweekIndeling);
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Alle velden die geset worden in de <strong>default</strong> builder, worden overgeërfd
door de <strong>specific</strong> builder.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Net als de <strong>default</strong> builder, worden <strong>specific</strong> builders via CDI
gevonden, en moeten deze dus ook <code>@Dependent</code> zijn.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Een <strong>specific</strong> builder extend direct de <strong>default</strong> builder voor het
type.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>In de default constructor van de builder worden alle velden gezet die
typerend zijn voor de specifieke vulling. In dit geval gaat het om een
roosterafspraak.</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_basisvulling">Basisvulling</h5>
<div class="paragraph">
<p>Om de hoeveelheid werk voor het schrijven van een <code>EntityBuilder</code> tot het
minimum te beperken, zal de <code>EntityBuilder</code> zoveel mogelijk velden al
voorvullen. Alle velden in de entiteit die een standaard-waarde hebben, zullen
deze waarde voorgevuld krijgen. Dit betekent dat alle primitives, indien niet
geïnitialiseerd, de standaard Java waarde krijgen voor dat type. Alle, volgens
JPA-annotaties, verplichte velden, worden standaard gevuld met de <strong>default</strong>
builder voor dat type. Als een entiteit aan een  <code>@OneToMany</code> wordt toegevoegd,
wordt automatisch de bijbehorende <code>@ManyToOne</code> aan de andere kant van de relatie
geset. Indien er verplichte velden geen voorvulling hebben en in de builder ook
niet gevuld worden, zal een fout optreden.</p>
</div>
</div>
<div class="sect4">
<h5 id="_zoekopdrachten">Zoekopdrachten</h5>
<div class="paragraph">
<p>Velden kunnen gevuld worden met het resultaat van een zoekopdracht. Een
zoekopdracht wordt gestart met <code>zoek(type)</code>, waarna eigenschappen toegevoegd
kunnen worden met <code>.op(veld, waarde)</code>. Een voorbeeld van een zoekopdracht is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">met(Afspraak_.afspraakType, zoek(AfspraakType.class)
    .op(AfspraakType_.category, AfspraakTypeCategory.ROOSTER));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Een zoekopdracht zoekt binnen alle <strong>default</strong> en <strong>specific</strong> builders die bekend
zijn op een match. Als er geen match gevonden wordt, zal een nieuwe <strong>implicit</strong>
builder gemaakt worden, welke gebaseerd is op de <strong>default</strong> builder van dat type
en alle waarden overneemt uit de zoekopdracht. Andere zoekopdracht met dezelfde
waarden zullen deze <strong>implicit</strong> builder vinden.</p>
</div>
</div>
<div class="sect4">
<h5 id="_meerdere_instanties_van_entiteiten">Meerdere instanties van entiteiten</h5>
<div class="paragraph">
<p>Alle constructies die tot nu toe beschreven zijn, behielden een 1-op-1 relatie
tussen de builder en een entiteit in de database. Soms is het echter nodig om
meerdere instanties van een entiteit aan te maken, gebouwd met dezelfde builder.
Hiervoor dient de <code>nieuwe(type)</code> methode.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">@Dependent
public class LesweekIndelingBuilder extends EntityBuilder&lt;LesweekIndeling&gt;
{
    public LesweekIndelingBuilder()
    {
        met(LesweekIndeling_.actief, true);
        met(LesweekIndeling_.naam, "8-uur");
        met(LesweekIndeling_.lesweekIndelingOrganisatieEenheidLocatie,
            nieuwe(LesweekIndelingOrganisatieEenheidLocatie.class)); <i class="conum" data-value="1"></i><b>(1)</b>

        met(LesweekIndeling_.lesdagIndelingen,
            nieuwe(LesdagIndeling.class).met(LesdagIndeling_.dag, "MA")); <i class="conum" data-value="2"></i><b>(2)</b>
        met(LesweekIndeling_.lesdagIndelingen,
            nieuwe(LesdagIndeling.class).met(LesdagIndeling_.dag, "DI"));
        met(LesweekIndeling_.lesdagIndelingen,
            nieuwe(LesdagIndeling.class).met(LesdagIndeling_.dag, "WO"));
        met(LesweekIndeling_.lesdagIndelingen,
            nieuwe(LesdagIndeling.class).met(LesdagIndeling_.dag, "DO"));
        met(LesweekIndeling_.lesdagIndelingen,
            nieuwe(LesdagIndeling.class).met(LesdagIndeling_.dag, "VR"));
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Voeg een nieuwe koppeling toe aan de lesweekindeling. De
<code>@ManyToOne</code>-relatie met lesweekindeling wordt automatisch gevuld met de
lesweekindeling; de verwijzing naar de organisatie-eenheid wordt gevuld met de
<strong>default</strong> organisatie-eenheid.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Maak een nieuwe lesdagindeling voor alle dagen in de week, gebaseerd op de
<strong>default</strong> builder van <code>LesdagIndeling</code>.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_fixture">9.4.2. Fixture</h4>
<div class="paragraph">
<p>Een <code>Fixture</code> beschrijft een set aan data in de database die nodig is om een
test te kunnen draaien, waarbij 1 entiteit gekozen kan worden tot het primaire
object van de fixture. In de <code>Fixture</code> wordt beschreven welke entity builders
gebruikt moeten worden om de database te vullen, mogelijk met waarden die
specifiek voor die testcase zijn.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">public class RoosterAfspraakVanLes1Tm4Uur extends Fixture&lt;Afspraak&gt; <i class="conum" data-value="1"></i><b>(1)</b>
{
    @Override
    public void define() <i class="conum" data-value="2"></i><b>(2)</b>
    {
        primair( <i class="conum" data-value="3"></i><b>(3)</b>
            gegevenEen(new RoosterAfspraakBuilder()) <i class="conum" data-value="4"></i><b>(4)</b>
            .met(Afspraak_.beginLesuur, 1)
            .met(Afspraak_.beginDatumTijd, vandaagOm("8:20"))
            .met(Afspraak_.eindLesuur, 4)
            .met(Afspraak_.eindDatumTijd, vandaagOm("12:00"))
            .met(Afspraak_.participanten, nieuwe(AfspraakParticipant.class)
                .met(AfspraakParticipant_.deelnemer,
                    JanssenDeelnemerBuilder.class)));
        gegevenDe(TeLaatRedenBuilder.class); <i class="conum" data-value="5"></i><b>(5)</b>
        gegevenDe(ZiekRedenBuilder.class);
        gegevenDe(VerwijderdRedenBuilder.class);
        gegevenDe(DoktersbezoekRedenBuilder.class);
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>Fixtures</code> zijn subclasses van de <code>Fixture</code> class.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>In de <code>abstract</code> method <code>define()</code> worden de vereiste entiteiten gebouwd.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Het primaire object wordt gemarkeerd met de methode <code>primair(...)</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Er wordt een nieuwe <strong>implicit</strong> builder gemaakt, gebaseerd op de
<code>RoosterAfspraakBuilder</code>, waarbij verschillende velden gevuld worden met nieuwe
of andere waarden.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Voor een setje overige entiteiten wordt gebruik gemaakt van <strong>specific</strong>
builders.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_gebruik_in_een_arquillian_test">9.4.3. Gebruik in een Arquillian test</h4>
<div class="paragraph">
<p>Het <code>cobra-jpa-entity-generation</code>-project bevat een Arquillian extension die het
mogelijk maakt om <code>Fixtures</code> te injecten in je testcase met behulp van de
<code>@DataSet</code> annotatie. De annotatie kan zowel op instance fields als op methode
parameters gebruikt worden. Ook is het mogelijk om meerdere <code>Fixtures</code> te
combineren. Een voorbeeld van een testcase die <code>Fixtures</code> gebruikt is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">@Test
public void ziekEnVanaf2eUurAanwezig(
        @DataSet RoosterAfspraakVanLes1Tm4Uur les1,
        @DataSet ZiekMelding ziekMelding)
{
    // ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_schrijf_custom_arquillian_extensions">9.5. Schrijf Custom Arquillian Extensions</h3>
<div class="paragraph">
<p>Je maakt het ontwikkelen van testcases een stuk eenvoudiger door je
eigen uitbreidingen op Arquillian te schrijven. Zo heeft EduArte een
login-extension gemaakt waarmee je met een annotatie kan aangeven met
welke gebruiker je een test wilt uitvoeren. In deze sectie kijken we
naar hoe je eigen uitbreidingen kan schrijven voor Arquillian tests.</p>
</div>
<div class="sect3">
<h4 id="_schrijf_een_login_extension_om_te_testen_als_een_gebruiker">9.5.1. Schrijf een Login Extension om te Testen als een Gebruiker</h4>
<div class="paragraph">
<p>Om het schrijven van tests te vereenvoudigen is het handig om aan te
geven als welke gebruiker je de test wilt uitvoeren. Voor EduArte is
dit geïmplementeerd als een Arquillian extension. Met de <code>@Login</code>
annotatie kan je aangeven welke gebruiker de test moet uitvoeren.</p>
</div>
<div class="listingblock">
<div class="title">Voorbeeld van het gebruik van de <code>@Login</code> annotatie</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java">    @Test
    @Login(instelling = "Educuscollege", username = "app")
    public void performTests()
    {</code></pre>
</div>
</div>
<div class="paragraph">
<p>Deze test zal inloggen als gebruiker <code>app</code> binnen de instelling
<code>Educuscollege</code>.</p>
</div>
<div class="paragraph">
<p>De Arquillian extension voor het inloggen geeft aan dat er een aantal
events geobserveerd moeten worden, zoals het <code>Before</code> event dat afgaat
voordat er een test wordt uitgevoerd:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">public class EduArteSeleniumLoginExecutor
{
    // ...

    public void before(@Observes(precedence = 100) Before before)
    {
        Login login = before.getTestMethod().getAnnotation(Login.class);
        if (login != null)
        {
            // voer de login actie uit voor de gegeven gebruiker</code></pre>
</div>
</div>
<div class="paragraph">
<p>Deze methode zal voor elke testuitvoering worden aangeroepen omdat het
<code>Before</code> event wordt geobserveerd. In de methode kunnen we dan de
annotaties op de testmethode uitlezen en controleren of er ingelogd
moet worden.</p>
</div>
<div class="paragraph">
<p>Zo is het ook mogelijk om het <code>After</code> event te observeren:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">@SuppressWarnings("unused")
public void after(@Observes(precedence = 100) After after)
{
    EduArteContext.get().clearContext();
    ThreadContext.setSession(null);
    WaspAuthorizationStrategy.setStrategyResolver(null);
    HibernateSessionProvider sessionProvider =
        DataAccessRegistry.getHelper(SessionDataAccessHelper.class)
            .getHibernateSessionProvider();
    sessionProvider.getSession();
    sessionProvider.closeAndPopSession();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Deze methode zal aangeroepen worden na afloop van elke testmethode en
biedt dan de ruimte om rondslingerende resources op te ruimen.</p>
</div>
</div>
<div class="sect3">
<h4 id="_start_op_een_specifieke_pagina_met_een_testenricher">9.5.2. Start op een Specifieke Pagina met een TestEnricher</h4>
<div class="paragraph">
<p>Met een <code>TestEnricher</code> kan je testcases verrijken zodat het eenvoudiger
wordt om tests te schrijven. Zo is het mogelijk om parameters te
injecten vlak voordat de test uitgevoerd wordt.</p>
</div>
<div class="paragraph">
<p>In Cobra wordt dit gebruikt om een test te laten beginnen op een
specifieke pagina. Onderstaand voorbeeld logt in als <code>app</code> en begint de
test op de <code>DeelnemerZoekenPage</code>:</p>
</div>
<div class="listingblock">
<div class="title">Voorbeeld van het gebruik van de testenricher</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java">public class CreateDeelnemer extends EduArteSeleniumTestBase
{
    @Test
    @Login(instelling = "Educuscollege", username = "app")
    public void performTests(PageInteractor&lt;DeelnemerZoekenPage&gt; deelnemerZoeken)
    {
        deelnemerZoeken.clickButtonWithAlert(CobraKeyAction.TOEVOEGEN, IntakeStap0Zoeken.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Er wordt een <code>PageInteractor</code> geïnjecteerd die als basis de
<em>DeelnemerZoekenPage</em> heeft. Je kan dan vanaf dat moment direct met een
instantie van die pagina werken, zoals bijvoorbeeld het klikken op een
knop.</p>
</div>
<div class="paragraph">
<p>Je maakt een
<a href="https://docs.jboss.org/arquillian/spi/latest/org/jboss/arquillian/test/spi/TestEnricher.html">TestEnricher</a>
door die interface te implementeren:</p>
</div>
<div class="listingblock">
<div class="title">Voorbeeld implementatie van een testenricher</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java">public class SeleniumTestEnricher implements TestEnricher
{
    @Inject
    @TestScoped
    private Instance&lt;SeleniumTester&gt; tester;

    @Override
    public void enrich(Object testCase)
    {
    }

    @Override
    public Object[] resolve(Method method)
    {
        Object[] ret = new Object[method.getParameterTypes().length];
        for (int index = 0; index &lt; method.getParameterTypes().length; index++)
        {
            if (method.getParameterTypes()[index].equals(PageInteractor.class))
            {
                Type genericType = method.getGenericParameterTypes()[index];
                Type pageType = ((ParameterizedType) genericType).getActualTypeArguments()[0];
                ret[index] = tester.get().startAt(
                              ((Class&lt; ? &gt;) pageType).asSubclass(Page.class));
            }
        }
        return ret;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Je moet twee methodes implementeren: <code>enrich</code> en <code>resolve</code>. <em>Enrich</em>
implementeer je om de testclass instantie te verrijken, en <em>resolve</em> om
de methode te verrijken. In ons voorbeeld willen we de methode
verrijken door deze te voorzien van de pagina instantie die opgevraagd
wordt via de <code>PageInteractor</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Het registreren van de testenricher gebeurt bij het bouwen van de
deployable applicatie via Java SPI (zie <code>SeleniumArchiveAppender</code>).
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_gebruik_selenium_voor_client_tests">9.6. Gebruik Selenium voor Client Tests</h3>
<div class="paragraph">
<p>Selenium is een testtool waarmee in een browser een gebruiker gesimuleerd wordt door een programma.
Je kan dus testcases schrijven in Java, JavaScript of een andere programmeertaal en deze sturen dan Selenium aan die de bijbehorende commando&#8217;s uitvoert in een browser.</p>
</div>
<div class="paragraph">
<p>Daar Selenium tests over het algemeen lang duren, worden deze normaal gesproken in een apart proces op een buildserver (Jenkins) uitgevoerd.
Je kan de tests echter ook lokaal draaien om zo eenvoudig tests te kunnen schrijven of te debuggen.</p>
</div>
<div class="sect3">
<h4 id="_selenium_lokaal_draaien">9.6.1. Selenium lokaal draaien</h4>
<div class="paragraph">
<p>Je kan Selenium lokaal draaien door de onderstaande stappen uit te voeren. Zorg ervoor dat je ook Chrome geïnstalleerd hebt staan.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download de meeste recente Selenium-server van <a href="http://docs.seleniumhq.org/download/" class="bare">http://docs.seleniumhq.org/download/</a></p>
</li>
<li>
<p>Download ChromeDriver: <a href="https://sites.google.com/a/chromium.org/chromedriver/downloads" class="bare">https://sites.google.com/a/chromium.org/chromedriver/downloads</a></p>
</li>
<li>
<p>Pak beide bestanden uit in zelfde directory</p>
</li>
<li>
<p>We gebruiken selenium in zgn "grid configuration" Selenium Grid. Dat betekent dat je (minimaal) twee keer de selenium jar moet opstarten:</p>
</li>
<li>
<p>als <em>hub</em>: java -jar selenium-server-standalone-2.xx.x.jar -role hub</p>
</li>
<li>
<p>als <em>node</em>: java -jar selenium-server-standalone-2.xx.x.jar -Dwebdriver.chrome.driver=chromedriver.exe -role node -hub <a href="http://localhost:4444/grid/register" class="bare">http://localhost:4444/grid/register</a> -port 5556</p>
</li>
<li>
<p>In Eclipse: start een lege Wildlfy server (als je Wildfly niet op poort 9990 draait, moet je dit aanpassen in arquillian.xml of in je debug configuration)</p>
</li>
<li>
<p>In Eclipse: rechtermuisknop op de test &gt; Debug as &gt; JUnit Test</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_zelf_selenium_tests_schrijven">9.6.2. Zelf Selenium Tests Schrijven</h4>
<div class="sect4">
<h5 id="_generieke_seleniumtest">Generieke Seleniumtest</h5>
<div class="paragraph">
<p>Voor pagina’s die te benaderen zijn zonder constructorargument geldt dat je ze direct kunt openen:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>String url = getTester().getUrlFor(pageClass);
		PageInteractor&lt; ? extends Page&gt; renderedPage = openUrl(url, pageClass);</pre>
</div>
</div>
<div class="paragraph">
<p>Wat er op dat moment gebeurt is dat Selenium de pagina opent en kijkt of dat ‘goed’ gaat. Vervolgens kun je op de pagina allerlei zaken doen door middel van het zoeken van elementen en met die elementen iets te doen (Bij ParnasSys wordt er op de pagina gezocht naar searchresults en editbuttons waar op geklikt wordt. Eventuele nieuwe pagina’s die daarmee tevoorschijn komen worden ook op deze manier getest).</p>
</div>
<div class="paragraph">
<p>Voor pagina&#8217;s die een contextobject nodig hebben (leerling, groep, etc&#8230;&#8203;) is het nodig om, net als een gebruiker, de pagina via de applicatie te openen. In ParnasSys wordt bijvoorbeeld eerst naar de LeerlingZoekenPage genavigeerd, wordt een leerling geselecteerd en wordt vervolgens met deze leerling een LeerlingMenu-object aangemaakt dat daarna wordt gebruikt om op alle menu-items te klikken.</p>
</div>
</div>
<div class="sect4">
<h5 id="_minder_generieke_seleniumtest">Minder generieke Seleniumtest</h5>
<div class="paragraph">
<p>Op deze manier zijn echter niet alle pagina’s te bereiken, denk hierbij bijvoorbeeld aan pagina’s die pas verschijnen nadat verplichte velden zijn ingevuld. Hiervoor zul je een specifieke TestCase moeten implementeren (zie bijvoorbeeld <a href="https://github.com/topicusonderwijs/parnassys/blob/master/las/web/src/test/java/nl/topicus/parnassys/arquillian/selenium/core/BestandAanmakenEnVerwijderenTestCase.java" class="bare">https://github.com/topicusonderwijs/parnassys/blob/master/las/web/src/test/java/nl/topicus/parnassys/arquillian/selenium/core/BestandAanmakenEnVerwijderenTestCase.java</a>).</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_je_eerste_dag">Appendix A: Je eerste dag</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Welkom bij Topicus Onderwijs.
Je hebt net een heleboel nieuwe gezichten gezien en handen geschud.
Knap als je al die nieuwe gezichten nog bij naam weet te noemen, maar mocht dat niet lukken dan geen paniek!
Met die gezichten herinneren kunnen we je helaas niet helpen maar je eerste dag goed beginnen met werk wel.
Je hebt als het goed is net een laptop gekregen om op te gaan werken, maar alle zinvolle dingen moeten er nog opgezet worden.
Deze handleiding probeert je daarmee op weg te helpen.
Veel nuttige informatie is te vinden op het intranet, dus stap 1 van de handleiding is je laptop zover krijgen dat hij op intranet kan.</p>
</div>
<div class="paragraph">
<p>Vergeet ook niet de verklarende woordenlijst te raadplegen wanneer je een begrip of afkorting hoort die je niet kan thuisbrengen.</p>
</div>
<div class="sect2">
<h3 id="_accounts_aanvragen_aanmaken">A.1. Accounts aanvragen/aanmaken</h3>
<div class="paragraph">
<p>Om überhaupt iets gedaan te krijgen heb je een paar accounts nodig:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>een Topicus account</p>
</li>
<li>
<p>een Keyhub account (poortwachter)</p>
</li>
<li>
<p>een Slack account (project, sociale en overige discussies)</p>
</li>
<li>
<p>een Clockwise account (urenschrijfsysteem)</p>
</li>
<li>
<p>een Github account (code)</p>
</li>
<li>
<p>een JIRA account (bugs/userstories)</p>
</li>
<li>
<p>een Confluence account (documentatie, project afhankelijk)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Maar alles start met het aanvragen van een Topicus account.</p>
</div>
<div class="sect3">
<h4 id="_topicus_account">A.1.1. Topicus account</h4>
<div class="paragraph">
<p>Om binnen Topicus te kunnen werken heb je in elk geval een Topicus account nodig (ook bekend als Active Directory of AD account).
Dit heeft onze bezielende unit manager al voor je geregeld en krijgt hij via de mail toegezonden.
Met dit account krijg je toegang tot allerlei diensten, waaronder email, servers en de lunch.</p>
</div>
<div class="paragraph">
<p>Voordat je op je account kan inloggen op je eigen laptop, moet het password van je Topicus account gewijzigd worden.</p>
</div>
<div class="sect4">
<h5 id="_wachtwoord_instellen">Wachtwoord instellen</h5>
<div class="paragraph">
<p>Het wijzigen van je wachtwoord kan je doen op de Exchange server via een browser.
Ga in een IE, Firefox, Chrome of Safari naar <a href="https://exchange.topicus.nl/owa/auth/logon.aspx" class="bare">https://exchange.topicus.nl/owa/auth/logon.aspx</a> en log aan met de gegevens die je van je buddy gekregen hebt.
Het wijzigen van je wachtwoord kan je vinden onder de knop <em>Opties</em>.
Of je kan deze link gebruiken: <a href="https://exchange.topicus.nl/ecp/?rfr=owa&amp;p=PersonalSettings/Password.aspx" class="bare">https://exchange.topicus.nl/ecp/?rfr=owa&amp;p=PersonalSettings/Password.aspx</a>
Wijzig je wachtwoord naar iets dat je zelf kan onthouden en dat veilig is.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Het liefst heb je een wachtwoord dat langer is dan 10 karakters (langer is veiliger).
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_topicus_wifi">Topicus wifi</h5>
<div class="paragraph">
<p>Registreren voor Topicus-wifi doe je door in te loggen op het Topicus-register netwerk met hetzelfde wachtwoord als van het Topicus-guest netwerk; ‘U bent welkom’ .
Daar log je in met jouw Topicus AD gegevens en dan volg je de instructies. Als je een WPA key krijgt, gebruik dit als wachtwoord voor het Topicus-wifi netwerk.
Mobiele apparaten die niet gebruikt worden voor ontwikkel doeleinden graag allemaal in het guest netwerk houden. Het guest netwerk heeft alleen toegang tot het internet.</p>
</div>
</div>
<div class="sect4">
<h5 id="_intranet_gebruiken">Intranet gebruiken</h5>
<div class="paragraph">
<p>Nu kun je nu het intranet bereiken.
Open een webbrowser en type als adres ‘intranet.topicus.nl’.
Je komt dan op de intranet-homepage van Topicus uit.
Handige dingen hier zijn het smoelenboek, om je te helpen bij het gezichten-namen memory van al je nieuwe collega’s en de algemene informatie over Topicus, te vinden onder de kop ‘Algemeen’.</p>
</div>
</div>
<div class="sect4">
<h5 id="_email_gebruiken">Email gebruiken</h5>
<div class="paragraph">
<p>Je krijgt een Topicus emailadres, dat eruit ziet als <a href="mailto:voornaam.tussenvoegsel.achternaam@topicus.nl">voornaam.tussenvoegsel.achternaam@topicus.nl</a> (met punten tussen alle losse woorden, dus bijvoorbeeld voornaam.van.de.achternaam).
Je kunt je email online bekijken op <a href="https://exchange.topicus.nl/owa" class="bare">https://exchange.topicus.nl/owa</a> (als je de tekst <code>owa</code> vergeet, kom je op de standaard server pagina, en niemand lijkt dat een probleem te vinden, dus gebruik de volledige link, inclusief <code>owa</code>).
Daarnaast kun je je email ophalen met Outlook of je eigen mail-client.</p>
</div>
<div class="sect5">
<h6 id="_mail_ophalen_voor_windows_en_outlook">Mail ophalen voor Windows en Outlook</h6>
<div class="paragraph">
<p>Start Microsoft Outlook.</p>
</div>
<div class="imageblock" style="text-align: center;float: right">
<div class="content">
<img src="images/microsoft-office-outlook.svg" alt="Outlook" width="200" height="200">
</div>
</div>
<div class="paragraph">
<p>Je krijgt een wizard voor je neus om een nieuw account aan te maken. Deze kun je doorlopen om de exchange server in te stellen.
- Vul bij ‘Auto account setup’ je naam, emailadres in en het wachtwoord van je Topicus account.
- Vink onderaan ‘Manually configure server settings or additional server types’ aan.
- Klik Next om in het volgende scherm te komen.
- Kies ‘Microsoft Exchange’ als email service en klik weer Next.
- Vul bij Microsoft Exchange server exchange.topicus.nl in en vul bij user name je Topicus
account naam in. Klik weer op Next.
- Outlook zal je ergens na deze stap een keer vragen om in te loggen op baas2. Vul dan je
Topicus accountnaam en wachtwoord weer in. Eventueel moet je daarna nog een mail box
selecteren; kies dan degene die overeenkomt met je voor- en achternaam.
- Klik de rest van de wizard door tot het einde.</p>
</div>
<div class="paragraph">
<p>Voor niet-Windows gebruikers hieronder nog een OS X handleiding.</p>
</div>
</div>
<div class="sect5">
<h6 id="_mail_ophalen_voor_ios_os_x_en_mail_app">Mail ophalen voor iOS, OS X en Mail.app</h6>
<div class="paragraph">
<p>OS X en iOS hebben standaard ondersteuning voor Exchange email, waar om gevraagd wordt wanneer je een nieuw mail account probeert te registreren.
Volg gewoon de stappen van het besturingssysteem iOS en OS X om de server in te stellen.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Wanneer je iOS aanmeldt op de Exchange server krijgt Topicus Beheer de optie om jouw mobiel <em>remote</em> te wissen.
Dit wordt natuurlijk alleen dan gedaan wanneer je telefoon gestolen is, maar het is wel goed om dit te weten.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_mailgroepen">Mailgroepen</h6>
<div class="paragraph">
<p>Nu kun je je Topicus mail ophalen.
De Outlook kalender wordt gebruikt voor het plannen van afspraken.
Je kunt aan je inwerkcollega vragen om je een aantal standaard afspraken toe te sturen, zoals de Topicus borrel (erg belangrijk natuurlijk!) en het plenair overleg van Topicus Onderwijs (vierjaarlijkse bijeenkomst waarin alle lopende en toekomstige projecten kort worden besproken met alle medewerkers van Topicus Education).</p>
</div>
<div class="paragraph">
<p>Daarnaast ben je normaal gesproken als medewerker lid van de volgende groepen in het AD:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>iedereen (alle medewerkers en afstudeerders van geheel Topicus)</p>
</li>
<li>
<p>topicus.education (alle medewerkers en afstudeerders van de divisie Topicus Education)</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Je kan zien in welke groepen je zet in Jenkins, onze trouwe butler.
Ga naar http://
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Belangrijke emails worden vanuit Topicus naar iedereen@ gestuurd, en vanuit de divisie naar topicus.education@.
Hierbij moet je denken aan uitnodigingen voor plenaire vergaderingen (de divisie) en uitnodigingen voor evenementen (eindejaarsfeest, Topiconf).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Doe geen reply naar iedereen@ want dan krijgt <strong>iedereen</strong> jouw antwoord te zien.
Let ook op dat je dit niet doet met een reply-to-all.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In het verleden hadden we nog een mailinglist server, maar die wordt nauwelijks meer gebruikt sinds we Slack gebruiken.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_werken_vanaf_thuis_met_vpn">Werken vanaf thuis met VPN</h5>
<div class="paragraph">
<p>Standaard wordt er geen VPN-toegang aangevraagd.
Je kan dit regelen via Services door <a href="https://jira.topicus.nl/servicedesk/customer/portal/2">het aanmaken van een ticket</a>.
Hiervoor heb je wel toestemming nodig van je manager (regeltjes).</p>
</div>
<div class="paragraph">
<p>Dit is met name nodig voor toegang tot de productieservers en de interne servers als je vanuit een andere lokatie (lees IP adres) werkt dan de standaard Topicus adressen.</p>
</div>
<div class="paragraph">
<p>Om verder toegang tot de servers te krijgen heb je een KeyHub account nodig.</p>
</div>
<div class="paragraph">
<p>Zodra toegang en een KeyHub account hebt kun je met behulp van de bestanden op \\fs\Projecten\Topicus Onderwijs\VPN\Configuratie de configuratie van je VPN voor jouw besturingssysteem instellen.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_keyhub_bewaakt_alle_servers">A.1.2. KeyHub bewaakt alle servers</h4>
<div class="paragraph">
<p>Met KeyHub kan je toegang krijgen tot de servers van Topicus Onderwijs en interne tools zoals de HPM coach voor je functioneringsgesprekken.
KeyHub is onze two-factor authenticatie en autorisatie tool dat je makkelijk toegang kan verlenen tot productieservers, maar ook interne ontwikkelservers en de applicatie waarvoor je aan het ontwikkelen bent.</p>
</div>
<div class="paragraph">
<p>Om KeyHub-toegang te krijgen heb je op z&#8217;n minst een werkend Topicus-account nodig <strong>en</strong> een two-factor authentication app, zoals bijvoorbeeld Google Authenticator, of de KeyHub app.</p>
</div>
<div class="paragraph">
<p>Als voorbereidend werk download je in je app store bijvoorbeeld de Keyhub app (let erop dat je de app van Topicus Onderwijs downloadt):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>iOS: <a href="https://itunes.apple.com/nl/app/keyhub/id1024961560?mt=8" class="bare">https://itunes.apple.com/nl/app/keyhub/id1024961560?mt=8</a></p>
</li>
<li>
<p>Android: <a href="https://play.google.com/store/apps/details?id=nl.topicus.heimdall&amp;hl=nl_NL" class="bare">https://play.google.com/store/apps/details?id=nl.topicus.heimdall&amp;hl=nl_NL</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Daarna kan je via onze KeyHub-installatie een account registreren (klik op registreren en doorloop de registratiewizard) en de benodigde groepen aanvragen (in elk geval Medewerkers).
Onze KeyHub-installatie is te vinden op: <a href="https://keyhub.topicusonderwijs.nl" class="bare">https://keyhub.topicusonderwijs.nl</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_slack_voor_alle_chats">A.1.3. Slack voor alle chats</h4>
<div class="paragraph">
<p>Omdat we een organisatie zijn die niet meer in één kamer past gebruiken we een chat programma om met elkaar virtueel te communiceren.
Hiervoor gebruiken we Slack.</p>
</div>
<div class="imageblock" style="text-align: center;float: left">
<div class="content">
<img src="images/slack.svg" alt="Slack" width="200">
</div>
</div>
<div class="paragraph">
<p>Slack is een chat dienst voor teams met applicaties voor je mobiel en PC (Linux, Windows en OS X).</p>
</div>
<div class="paragraph">
<p>Open in je browser de volgende url: <a href="https://topicuseducation.slack.com" class="bare">https://topicuseducation.slack.com</a> en klik op de "make an account" link onder het inlog-formulier om een account te maken voor Slack.</p>
</div>
<div class="paragraph">
<p>Voor je account naam kan je het beste "voornaam.achternaam" gebruiken net als je Topicus account.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Het wachtwoord kies je natuurlijk <strong>niet</strong> hetzelfde als je Topicus account want dan is het kinderlijk eenvoudig om je account te hacken.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Er zijn ook apps voor de verschillende besturingssystemen en mobiele platforms. Deze kan je ook installeren en je dan aanmelden.</p>
</div>
<div class="paragraph">
<p>We willen ook dat je 2-factor authentication aanzet voor je account zodat het heel erg moeilijk wordt om in je account te komen.</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_factor_authentication_applicaties">A.1.4. 2-factor authentication applicaties</h4>
<div class="paragraph">
<p>Voor diverse diensten is het noodzakelijk om 2-factor authentication te gebruiken:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Keyhub</p>
</li>
<li>
<p>Slack</p>
</li>
<li>
<p>Github</p>
</li>
<li>
<p>GMail</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Daarvoor kan je de Google Authenticator app downloaden op je mobiele telefoon. Deze is beschikbaar voor alle platformen en genereert nieuwe inlogcodes wanneer je wil inloggen op een dienst.</p>
</div>
<div class="paragraph">
<p>Elke dienst heeft weer z&#8217;n eigen nukken voor het instellen van 2-factor authentication, dus kijk daar bij je accountprofiel voor de mogelijkheden en het doorlopen van de stappen.</p>
</div>
</div>
<div class="sect3">
<h4 id="_clockwise_betaalt_onze_rekeningen">A.1.5. Clockwise betaalt onze rekeningen</h4>
<div class="paragraph">
<p>Urenschrijven betaalt de rekeningen en als je die niet tijdig invult en inlevert krijg je aan de stok met de Noorse god van Tijdschrijven.
Dit account wordt geregeld door jouw projectleider.</p>
</div>
</div>
<div class="sect3">
<h4 id="_github_bewaart_alle_code">A.1.6. Github bewaart alle code</h4>
<div class="paragraph">
<p>Na jarenlang zelf onze eigen source code server te onderhouden in Subversion op onze eigen hardware zijn we overgestapt op Git en hebben al onze code aan de cloud toevertrouwd bij Github.</p>
</div>
<div class="imageblock" style="text-align: center;float: right">
<div class="content">
<img src="images/github-octocat.svg" alt="Github" width="200" height="200">
</div>
</div>
<div class="paragraph">
<p>De accounts van Github zijn niet gekoppeld aan een Topicus account, dus wederom een nieuw username/wachtwoord combinatie om te onthouden.</p>
</div>
<div class="paragraph">
<p>Gebruik een herkenbare gebruikersnaam voor github, dus niet fluffybear2013 maar achternaam of voornaamachternaam.
Op die manier kunnen de beheerders duidelijk zien wie er toegang gekregen heeft tot onze repositories.
Geef ook je volledige naam, dus voor- en achternaam, op bij je profiel.</p>
</div>
<div class="sect4">
<h5 id="_gebruik_two_factor_authentication">Gebruik two-factor authentication</h5>
<div class="paragraph">
<p>Als eerste dien je two-factor authentication aan te zetten.
Anders krijg je geen toegang tot de repositories van Topicus.
Zorg ervoor dat je de backup codes ergens veilig opslaat.
Desnoods print je ze uit en stop je ze in de kluis van Topicus Onderwijs (niet de grote kluis in de kelder, maar de kluis waar de root wachtwoorden in zitten).</p>
</div>
</div>
<div class="sect4">
<h5 id="_gebruik_een_public_private_key_pair">Gebruik een public/private key pair</h5>
<div class="paragraph">
<p>Voor het pushen naar github is een public/private key pair noodzakelijk.
Github heeft daar <a href="https://help.github.com/articles/generating-ssh-keys/">prima documentatie</a> voor online staan, volg <a href="https://help.github.com/articles/generating-ssh-keys/">die handleiding</a> dan ook.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Er zijn verschillende manieren om onder windows om te gaan met het <em>niet elke keer invoeren van je passphrase</em>. Je kunt natuurlijk geen passphrase invoeren, dit haalt echter de security van het gebruik van en public/private key pair onderuit. Als je je git-bash terminal open houdt voorkom je dat je elke keer je passphrase moet invoeren, dit is in principe de meest secure optie. Een tussenoplossing kun je <a href="https://git-scm.com/docs/git-credential-store">hier</a> vinden.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Zodra je een keypair hebt gegenereerd, kun je ook je public key (<code>.ssh/id_rsa.pub</code>) invoeren in KeyHub, op je profiel/account-pagina. Hierna kan je zonder wachtwoord naar alle via KeyHub geautoriseerde servers SSH&#8217;en.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_jira_bevat_alle_bugs">A.1.7. JIRA bevat alle bugs</h4>
<div class="imageblock" style="text-align: center;float: left">
<div class="content">
<img src="images/jira.svg" alt="JIRA" width="200" height="200">
</div>
</div>
<div class="paragraph">
<p>We gebruiken JIRA voor het registreren van bugs en user stories.
Een account verkrijg je via je projectleider en is niet gekoppeld aan een Topicus systeem, dus is nog een nieuw username/wachtwoord combinatie om te onthouden.</p>
</div>
</div>
<div class="sect3">
<h4 id="_confluence_voor_projectdocumentatie">A.1.8. Confluence voor projectdocumentatie</h4>
<div class="paragraph">
<p>Niet alle projecten maken gebruik van confluence, maar als ze dat doen, moet je een account regelen via je projectleider.</p>
</div>
<div class="paragraph">
<p>Nu alle accounts geregeld zijn kan je beginnen met het installeren van je machine.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_software_her_installeren">A.2. Software (her)installeren</h3>
<div class="paragraph">
<p>Om als ontwikkelaar aan het werk te kunnen heb je wat software nodig om aan de slag te kunnen.
We gebruiken de volgende software:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Git</p>
</li>
<li>
<p>Java</p>
</li>
<li>
<p>Apache Maven</p>
</li>
<li>
<p>NPM (optioneel)</p>
</li>
<li>
<p>Eclipse</p>
</li>
<li>
<p>Wildfly</p>
</li>
<li>
<p>Oracle SQLDeveloper</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Hieronder een korte introductie voor het installeren en configureren van elke stuk software.</p>
</div>
<div class="sect3">
<h4 id="_installeren_git">A.2.1. Installeren git</h4>
<div class="paragraph">
<p>Git wordt gebruikt om onze source code mee te beheren en te versioneren.
Om met Git te werken dient deze software op je systeem geïnstalleerd te zijn.</p>
</div>
<div class="paragraph">
<p>Linux gebruikers hebben meestal de meest recente versie van Git al op hun systeem staan.</p>
</div>
<div class="paragraph">
<p>OS X gebruikers lopen vaak achter met de meest recente versie die met het besturingssysteem geleverd wordt.
Zij kunnen dan via <a href="https://brew.sh">Homebrew</a> zelf een nieuwere versie installeren met <code>brew install git</code>.</p>
</div>
<div class="paragraph">
<p>Windows gebruikers dienen zelf nog voor een installatie van git te zorgen.
Je kan die het beste van <a href="https://git-for-windows.github.io">Git for Windows op Github</a> downloaden en installeren.</p>
</div>
<div class="paragraph">
<p>Daarnaast is het fijn om een vriendelijke, grafische UI boven op Git te installeren.
Voor alle besturingssystemen is SourceTree een goede en gratis optie.</p>
</div>
<div class="paragraph">
<p>Github levert zelf een desktopclient voor Windows en OS X: <a href="https://desktop.github.com" class="bare">https://desktop.github.com</a>
Wil je veel geld uitgeven maar ook een erg fijne gebruikerservaring dan kan je prima GitTower voor OS X aanschaffen.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Voor het volgen van de scrum-workflow zijn er op <a href="https://github.com/topicusonderwijs/git-scrum">github</a> handige git-scrum scriptjes beschikbaar. Als je parnassys ontwikkelaar bent heeft het de sterke voorkeur dat je deze scriptjes gebruikt. Gebruik de handleiding op <a href="https://github.com/topicusonderwijs/git-scrum">deze</a> pagina. Als je windows gebruikt zou je <code>.bash_profile</code> onder C:\Users{jouwGebruikersNaam} moeten staan (daar waar ook je .gitconfig staat). Staat deze er niet? Voeg hem dan toe. Een voorbeeld van het toevoegen van de locatie van git-scrum aan je <code>.bash_profile</code> is: <code>export PATH=/c/{jouwLocatie}/git-scrum:$PATH</code> .
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_installeren_java">A.2.2. Installeren Java</h4>
<div class="paragraph">
<p>Download de Java Software Development Kit van Oracle.
We gebruiken versie 8 (en dan de meest recente update).</p>
</div>
<div class="paragraph">
<p>Je kan de downloads op de <a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html">Oracle Java Development web site</a> vinden.
Of zoek in Google naar <code>oracle java sdk 8</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Let op dat je de SDK installeert, niet enkel de Java Runtime Environment (JRE).
De JRE installeert namelijk niet de Java compiler en niet de Java source bestanden.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Wanneer je Windows gebruik voeg dan <code>JAVA_HOME</code> aan je Path toe:
1. Navigeer naar deze computer of zoek op <em>pc</em>
2. Rechts-klik op het icoon en kies Properties / Eigenschappen
3. Kies <em>advanced options</em> / <em>geavanceerde systeeminstellingen</em>
4. Kies <em>Environment variables</em> / <em>Omgevingsvariabelen</em>
5. Bij <em>System variables</em> voeg <code>JAVA_HOME</code> toe en verwijs naar de map waar je jdk installatie staat. (Dus bijvoorbeeld <code>C:\Program Files\Java\jdk1.8.X_XXX</code>)
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_os_x_gebruikers">OS X gebruikers</h5>
<div class="paragraph">
<p>OS X gebruikers kunnen dit het beste via <a href="http://brew.sh">Homebrew</a> installeren.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash">brew cask install java <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>het <code>cask</code> commando is om eenvoudig binaries (zoals Java en de JCE Unlimited Strengh Encryption Policy) te kunnen installeren</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_ubuntu_gebruikers">Ubuntu gebruikers</h5>
<div class="paragraph">
<p>Voor Ubuntu is een semi-officiële PPA waar onder andere de Java Software Development Kit van Oracle in zit.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash">sudo add-apt-repository ppa:webupd8team/java
sudo apt-get update
sudo apt-get install oracle-java8-installer</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_sterkere_encryptie_voor_java_installeren">Sterkere encryptie voor Java installeren</h5>
<div class="paragraph">
<p>Standaard komt Java met redelijke instellingen voor encryptie, maar voor onze applicaties willen we gebruik kunnen maken van bijvoorbeeld AES-256, en dat staat niet standaard aan.
Hiertoe dien je extra bestanden te downloaden van Oracle&#8217;s website (OS X gebruikers kunnen dit via homebrew doen).</p>
</div>
<div class="paragraph">
<p>Deze bestanden heten de "JCE Unlimited Strength Policy" en die kan je vinden via deze <a href="http://www.oracle.com/technetwork/java/javase/downloads/jce8-download-2133166.html">link</a>.</p>
</div>
<div class="paragraph">
<p>Je kopieert de twee bestanden naar de JRE die o.a. Eclipse gebruikt, onder <code>jre/lib/security</code>, of zie de README van de policy bestanden. Doe dit zowel onder je java JDK map als je Java JRE map.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Wanneer je een nieuwe versie van Java installeert dien je opnieuw deze bestanden toe te voegen!
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Het niet uitvoeren van deze stappen kan resulteren in de foutmelding <code>com.nimbusds.jose.JOSEException: Couldn't create AES/GCM/NoPadding cipher: Illegal key size</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_os_x_gebruikers_2">OS X gebruikers</h5>
<div class="paragraph">
<p>Via homebrew kan je casks (voorgebouwde bestanden) installeren met:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>brew cask install jce-unlimited-strength-policy</code></pre>
</div>
</div>
<div class="paragraph">
<p>Dit vereenvoudigt de installatieprocedure behoorlijk.</p>
</div>
</div>
<div class="sect4">
<h5 id="_ubuntu_gebruikers_2">Ubuntu gebruikers</h5>
<div class="paragraph">
<p>De PPA waar de Java Software Development Kit van Oracle in zit, bevat ook packages voor de JCE Unlimited Strength Policies.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash">sudo apt-get install oracle-java8-unlimited-jce-policy</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_installeren_maven">A.2.3. Installeren Maven</h4>
<div class="paragraph">
<p>Download of installeer de meest recente versie van Maven.
Linux gebruikers kunnen dat doen met de package manager van hun besturingssysteem.
OS X gebruikers kunnen het handigst gebruik maken van <a href="http://brew.sh">Home Brew</a> om Maven en andere onderdelen van het besturingssysteem te onderhouden.</p>
</div>
<div class="sect4">
<h5 id="_configureer_artifactory">Configureer Artifactory</h5>
<div class="paragraph">
<p>Binnen Topicus Onderwijs gebruiken we onze eigen repository manager, genaamd Artifactory.
Je moet Maven vertellen waar onze repository manager zich bevindt anders kan je onze projecten niet bouwen.
Dit doe je met een settings.xml bestand in de .m2 folder in je home directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">&lt;?xml version="1.0"?&gt;
&lt;settings&gt;
    &lt;mirrors&gt;
        &lt;mirror&gt;
            &lt;id&gt;topicus-repository&lt;/id&gt;
            &lt;name&gt;Topicus Maven Repository&lt;/name&gt;
            &lt;url&gt;https://repo.topicusonderwijs.nl/artifactory/maven/&lt;/url&gt;
            &lt;mirrorOf&gt;*&lt;/mirrorOf&gt;
        &lt;/mirror&gt;
    &lt;/mirrors&gt;
&lt;/settings&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
wanneer je een mvn clean install gaat doen op de onderwijsparent zorg dan dat je niet op het topicus-guest wifi netwerk zit.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_installeren_npm_optioneel">A.2.4. Installeren NPM (optioneel)</h4>
<div class="paragraph">
<p>Download of installeer de NPM versie die nodig is voor het project, dit kan dus verschillen per project.</p>
</div>
<div class="sect4">
<h5 id="_configureer_artifactory_2">Configureer Artifactory</h5>
<div class="paragraph">
<p>Net als voor Maven gebruiken we Artifactory als repository manager voor node modules.
Het configuratie bestand is .npmrc in je home directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="yaml">registry = https://repo.topicusonderwijs.nl/artifactory/api/npm/npm</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_configureer_artifactory_voor_bower">Configureer Artifactory voor Bower</h5>
<div class="paragraph">
<p>Mocht je project ook Bower gebruiken dan kun je Artifactory configureren dmv een .bowerrc bestand in je home directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json">{
  "registry": "https://repo.topicusonderwijs.nl/artifactory/api/bower/bower",
  "resolvers": [
    "bower-art-resolver"
  ]
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_inrichten_eclipse">A.2.5. Inrichten Eclipse</h4>
<div class="imageblock" style="text-align: center;float: right">
<div class="content">
<img src="images/eclipse-11.svg" alt="Eclipse" width="200" height="200">
</div>
</div>
<div class="paragraph">
<p>Op dit moment gebruikt iedereen Eclipse om te ontwikkelen aan de Java projecten.
Wanneer je je nieuwe laptop aan het inrichten bent, dien je dan ook Eclipse te installeren.</p>
</div>
<div class="paragraph">
<p>Ook wanneer je een nieuwe versie van Eclipse wilt gaan gebruiken kan je dit stappenplan doorlopen.</p>
</div>
<div class="sect4">
<h5 id="_download_de_juiste_versie">Download de juiste versie</h5>
<div class="paragraph">
<p>Door schade en schande komen we er telkens achter dat niet elke nieuwe versie van Eclipse het beloofde land is.
Vaak zijn oudere releases een stuk stabieler en sneller dan de nieuwste versies.
Gebruik dus Eclipse 4.6.</p>
</div>
<div class="paragraph">
<p>Daarnaast zijn we tot de conclusie gekomen dat je beter een kleine release van Eclipse kan uitbreiden met een specifieke set aan plugins, dan de luxe uitgebreide versie te downloaden.
Dus download altijd de <em>Eclipse for Java Developers</em> versie, <strong>niet</strong> de "Eclipse for Java Enterprise Developers".</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Gebruik deze link om Eclipse te downloaden: <a href="https://www.eclipse.org/downloads/packages/eclipse-ide-java-developers/neon3" class="bare">https://www.eclipse.org/downloads/packages/eclipse-ide-java-developers/neon3</a> [Java Ontwikkelaars versie van Eclipse 4.6.3 Neon].
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Als je op OSX de melding <em>“Eclipse.app” is damaged and can’t be opened. You should move it to the Trash.</em> krijgt draai dan volgend comando in je terminal <strong>xattr -rc Eclipse.app/</strong>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Eclipse komt met instellingen uit het jaar 2003 dus die kunnen wel naar het jaar 2016 gebracht worden.
Na het downloaden en uitpakken dien je de instellingen aan te passen.</p>
</div>
</div>
<div class="sect4">
<h5 id="_pas_de_geheugeninstellingen_aan">Pas de geheugeninstellingen aan</h5>
<div class="paragraph">
<p>Om Eclipse voldoende ruimte te geven voor het ontwikkelen met onze grote projecten dien je genoeg geheugenruimte aan Eclipse ter beschikking te stellen.
Dit doe je in de eclipse.ini, welke voor verschillende besturingssystemen op verschillende plekken te vinden is.
Pas de maximale heap grootte aan met onderstaande parameter:</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
OS X gebruikers kunnen niet zomaar de eclipse.ini aanpassen maar moeten dat doen in een kopie van de <code>Eclipse.app</code>.
Dit komt door <em>Gatekeeper</em> die berekent of de applicatie nog geldig is gebaseerd op de fingerprint die gegenereerd is bij het bouwen van de applicatie.
De Eclipse ontwikkelaars vonden het nodig om een door gebruikers wijzigbaar bestand mee te nemen in het berekenen van de fingerprint.
Je kan de eclipse.ini vinden wanneer je <b class="button">Rechtermuisknop</b> &#8594; Show package contents uitvoert op de Eclipse.app in <em>Finder</em>.
In het venster dat geopend wordt ga je dan naar Resources&#8594;MacOS en daar vind je eclipse.ini
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>-Xmx4g
-Xms2g
-XX:+DisableExplicitGC</code></pre>
</div>
</div>
<div class="paragraph">
<p>Dit stelt de maximale hoeveelheid geheugen voor Eclipse in op 4GB en de minimale hoeveelheid geheugen op 2GB.
Ook wordt de explicit garbage collection uitgeschakeld, omdat er brakke code in Eclipse zit, die expliciet GC start.
Deze expliciete GC veroorzaakt vervelende hickups bij incremental builds.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
wanneer je een laptop met 8GB geheugen hebt kan je ervoor kiezen om 3GB te alloceren voor Eclipse (vervang de <code>-Xmx4g</code> door <code>-Xmx3g</code>)
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Voor Windows gebruikers kan het noodzakelijk zijn om ook nog het volgende toe te voegen aan eclipse.ini voor het goed functioneren van de JDK:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>-vm
C:/Program Files/Java/jdk1.8.0_91/bin/javaw.exe</code></pre>
</div>
</div>
<div class="paragraph">
<p>Overige opties die wel gebruikt worden zijn:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-XX:+UseCompressedOops</code></p>
</li>
<li>
<p><code>-XX:+UnlockExperimentalVMOptions</code></p>
</li>
<li>
<p><code>-XX:+OptimizeStringConcat</code></p>
</li>
<li>
<p><code>-XX:-DontCompileHugeMethods</code></p>
</li>
<li>
<p><code>-XX:+UseFastAccessorMethods</code></p>
</li>
<li>
<p><code>-XX:+AggressiveOpts</code></p>
</li>
<li>
<p><code>-XX:+DoEscapeAnalysis</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Gebruik deze instellingen op eigen risico.</p>
</div>
</div>
<div class="sect4">
<h5 id="_installeer_de_juiste_plugins">Installeer de juiste plugins</h5>
<div class="paragraph">
<p>Je kan de lijst met de juiste plugins vinden voor jouw distributie op de volgende plek:</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/topicusonderwijs/topicusonderwijs/tree/master/eclipse" class="bare">https://github.com/topicusonderwijs/topicusonderwijs/tree/master/eclipse</a></p>
</div>
<div class="paragraph">
<p>Download het bestand voor jouw Eclipse versie (er staan nu bestanden voor <em>Luna, 4.4</em>, <em>Mars, 4.5</em> en <em>Neon, 4.6</em>).</p>
</div>
<div class="paragraph">
<p>Start Eclipse op (dit is niet de laatste keer dat je Eclipse vandaag start).</p>
</div>
<div class="paragraph">
<p>Gebruik "Import &#8594; Install &#8594; Install Software Items from File" om de plugins te installeren.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Wanneer je een bestaande workspace hebt, open dan je nieuwe Eclipse met een lege workspace om de plugins te installeren.
Dat scheelt een boel wachttijd.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Als je JRebel gebruikt (als je dit niet zeker weet dan gebruik je het niet!) moet je deze 3 stappen nogmaals herhalen met het JRebel specifieke bestand uit de eerder genoemde link.</p>
</div>
</div>
<div class="sect4">
<h5 id="_pas_de_workspace_instellingen_aan">Pas de workspace instellingen aan</h5>
<div class="paragraph">
<p>Vink onder <em>Window &gt; Preferences &gt; General &gt; Workspace</em> het vinkje "Refresh using native hooks or polling" aan.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
OS X gebruikers vinden de <em>Preferences</em> onder het Eclipse menu in de menubalk.
Windows gebruikers vinden de <em>Preferences</em> onder Window in de menubalk.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Het zou kunnen dat als je Windows gebruikt je nog aan Eclipse moet vertellen dat je de JDK wilt gebruiken in plaats van de JRE.
Dit doe je onder Java &#8594; Installed JREs met een druk op de search knop.
Je moet wel expliciet de JDK selecteren (vinkje). Je kunt dan ook meteen de JRE verwijderen voor de opgeruimdheid.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_zorg_ervoor_dat_je_classes_en_javadocs_kan_lezen">Zorg ervoor dat je Classes en javadocs kan lezen</h5>
<div class="paragraph">
<p>Ga naar <em>Window &gt; Preferences</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Vink onder <em>JBoss Tools &gt; Source lookup</em> "Automatically add the JBoss &#8230;&#8203; launch configuration" aan.</p>
</li>
<li>
<p>Vink onder <em>JBoss Tools &gt; Source lookup</em> "Always" aan.</p>
</li>
<li>
<p>Vink onder <em>Maven</em> "Download artifact sources" aan.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_80000_karakters_aan_log_is_voldoende_voor_iedereen">80000 karakters aan log is voldoende voor iedereen</h5>
<div class="paragraph">
<p>Standaard staat in Eclipse de console output gelimiteerd tot 80,000 karakters.
Dit betekent dat bij de eerste beste stack trace jouw console niet meer de juiste gegevens bevat om deze stack trace te verhelpen.</p>
</div>
<div class="paragraph">
<p>Verander dit naar een hogere limiet of zet het op oneindig onder "Run/Debug &#8594; Console".</p>
</div>
</div>
<div class="sect4">
<h5 id="_projecten_importeren">Projecten importeren</h5>
<div class="paragraph">
<p>Je bent bijna klaar om aan het project te gaan werken waarvoor je uitgenodigd bent.
Hiertoe dien je de source code van Github te halen.
Kijk eerst op Github of je de juiste rechten hebt en of je het juiste project aan het clonen bent.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Haal het project van GitHub: <code>git clone git@github.com:topicusonderwijs/{projectnaam}.git</code></p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Let er op dat je het <em>git</em> protocol gebruikt en niet het <em>https</em> protocol.
Het <em>https</em> protocol voor Git is namelijk lekker traag en minder veilig dan het <em>git</em> protocol dat met public/private keys werkt.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p><span class="menuseq"><b class="menu">File</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Import&#8230;&#8203;</b></span>, en kies dan in de tree <span class="menuseq"><b class="menu">Maven</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Existing Maven Projects</b></span></p>
</li>
<li>
<p><b class="button">Browse&#8230;&#8203;</b> naar je geclonede project folder</p>
</li>
<li>
<p><b class="button">Next &#8594;</b></p>
</li>
<li>
<p>Nu worden een aantal m2e connectors aangeboden, installeer deze zoals voorgesteld</p>
</li>
<li>
<p>Mogelijk wordt gevraagd op Eclipse te restarten, doe dit nog niet</p>
</li>
<li>
<p>Selecteer automatically bij Annotation Processing</p>
</li>
<li>
<p>Start nu Eclipse opnieuw op</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Bij het opstarten worden alle projecten eerst geüpdated met de Maven plugin, dit kan even duren.
Daarna wordt de workspace gebuild, dit duurt ook weer even.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_wildfly_installeren">A.2.6. Wildfly installeren</h4>
<div class="paragraph">
<p>Onze eigen wildfly build staat op de fileserver:
- fs/Projecten/Topicus Onderwijs/software/wildfly en wildfly-db-drivers.</p>
</div>
<div class="paragraph">
<p>Voor windows gebruikers is dat:
- \\fs\Projecten\Topicus Onderwijs\software\wildfly</p>
</div>
<div class="paragraph">
<p>Je plakt bovenstaande regel in de adresbalk van de Windows verkenner, en dan wordt je gevraagd om je Windows username/wachtwoord.
Dit is dan bijv. topicus\voornaam.achternaam en je wachtwoord.</p>
</div>
<div class="paragraph">
<p>Pak wildfly-10.1.0.Final uit naar een aparte directory (<strong>zonder spatie!</strong>). De inhoud van de wildfly-db-drivers map moet je kopieren naar de map <em>modules</em> (in de zojuist aangemaakte/uitgepakte Wildfly-10.1.0.Final map). De postgres module is nog gezipt, in deze zipfile zit ook een org map. Pak de org map uit de postgres zipfile uit in de zojuist gekopieerde org map van wildfly - je hebt hierna als het goed is de volgende directory-structuur <code>[...]wildfly-10.1.0.Final\modules\org\postgresql[...]</code>.</p>
</div>
<div class="paragraph">
<p>Ga naar de bin directory met een terminal/shell/console en voer <strong>add-user.sh/bat</strong> uit. Maak een gebruiker aan met admin rechten. Houdt de console nog even open.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Je hoeft niet aan een groep toegevoegd te worden</p>
</li>
<li>
<p>Kies bij: "About to add user <em>jouwgebruikersnaam</em> for realm <em>ManagementRealm</em>" <em>yes</em></p>
</li>
<li>
<p>Kies bij: "Is this new user going to be used for one AS process to connect to another AS process?" <em>no</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Eclipse instellen:</strong></p>
</div>
<div class="paragraph">
<p>Ga naar het Java EE perspective gaan en open de "servers" tab. Kies <em>new server</em> en geef Wildfly 10.x, als directory aan.
Wacht nog even met projecten toevoegen. Start de server op (rechterklik &#8594; start).</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Bind exception/address already in use</div>
<div class="paragraph">
<p>Ben je de gelukkige gebruiker van een recente Dell laptop met Windows (10) en NVIDIA grafische kaart?
Dan heeft NVIDIA voor jou speciaal een driver geïnstalleerd die al poort 8080 gebruikt en daarmee Wildfly blokkeert.</p>
</div>
<div class="paragraph">
<p>Je kan de driver speciaal uitzetten, maar die wordt dan elke keer weer opnieuw geactiveerd bij een update.
Of je kijkt even in <strong>\standalone\configuration\standalone.xml</strong> en <strong>\bin\jboss-cli.xml</strong> en pas het conflicterende poortnummer aan naar 8081.</p>
</div>
<div class="paragraph">
<p>Je URL&#8217;s naar de applicaties moeten dan ook eindigen in :8081.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Terug naar de console:</p>
</div>
<div class="paragraph">
<p>Voer het wildfly-local.cli-script van je project uit. Niet vergeten om $PROJECTDIR te vervangen met het daadwerkelijke adres van het project.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Linux/Mac:
jboss-cli.sh -c --file=$PROJECTDIR/deliverables/wildfly-configuration/scripts/wildfly-local.cli</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Windows:
jboss-cli.bat -c --file="$PROJECTDIR\deliverables\wildfly-configuration\scripts\wildfly-local.cli"</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Werk je onder Windows? Het kan zijn dat de volgende foutmelding optreedt: <code>findstr</code> is not recognized as an internal or external command. Op  <a href="http://stackoverflow.com/questions/10244181/findstr-is-not-recognized-as-an-internal-or-external-command">stackoverflow</a> worden hier verschillende oplossingen voor aangedragen, kijk welke voor jou werkt.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Log eventueel in op de wildfly management interface <a href="http://localhost:9990" class="bare">http://localhost:9990</a> om te checken of je datasource goed staat. Je kunt dit testen door naar Configuration &gt; Subsystems &gt; Datasources &gt; Non-XA &gt; parnassys &gt; dropdown kies <em>Test Connection</em>.</p>
</div>
<div class="paragraph">
<p>Terug naar Eclipse:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Stop de server</p>
</li>
<li>
<p>Dubbelklik op de WildFly in servers tab &gt; [Open launch configuration] &gt; Bij VM arguments moet je het volgende aanpassen: -Xms512m en -Xmx4g</p>
</li>
<li>
<p>Check of onder de launch configuration onder het <em>Source</em> tabje "Default" is ingesteld, zo niet doe dit door op "restore default" te klikken</p>
</li>
<li>
<p>Rechterklik op wildfly in servers tab &gt; Add and Remove&#8230;&#8203; &gt; en voeg de relevante items toe voor jouw project en (her)start de server.</p>
</li>
<li>
<p>Voor Parnassys zijn dit bijvoorbeeld: <em>parnassys-deliverable-dev-ear</em> en <em>parnassys_portal_authenticator</em></p>
</li>
<li>
<p>Als alles goed gegaan is dan kun je bij je applicatie op <a href="http://localhost:8080/" class="bare">http://localhost:8080/</a></p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
ParnasSys ontwikkelaar? Voeg dan bij [Open launch configuration] bij de Program arguments <code>-Dparnassys/launchUpdateTasks=false</code> toe. Bij ParnasSys is per default het databaseschema geconfigureerd waarop ook de testomgeving draait. Als je zelf gaat ontwikkelen aan de updatetask, gebruik dan een persoonlijk schema, en zet deze optie weer op <code>true</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Logging instellingen</strong></p>
</div>
<div class="paragraph">
<p><strong><em>Hibernate SQL logging aanzetten:</em></strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ga naar de management console van je WildFly (<a href="http://localhost:9990" class="bare">http://localhost:9990</a>)</p>
</li>
<li>
<p>Navigeer naar: Configuration &gt; Subsystems &gt; Logging &gt; View &gt; Tab <em>Log categories</em> &gt; <em>Add</em></p>
</li>
<li>
<p>Name: <em>org.hibernate.SQL</em> , Log level: <em>ALL</em> , Use Parent Handlers niet aanvinken (doe je dat wel dan krijg je alle sql-statements dubbel), Handlers: <em>CONSOLE</em></p>
</li>
<li>
<p>Save</p>
</li>
<li>
<p>Navigeer naar: Hoofdtab HANDLER &gt; Console &gt; Edit &gt; log level naar ALL</p>
</li>
<li>
<p>Save</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Logging is on-the-fly actief. Wildfly herstarten is niet nodig.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Of zet je wildfly lokaal uit en edit je standalone.xml. Zorg dat daarin de volgende zaken staan (onder subsystem logging):</p>
</div>
<div class="listingblock">
<div class="title">standalone.xml</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">&lt;console-handler name="CONSOLE"&gt;
	&lt;level name="ALL"/&gt;
	&lt;formatter&gt;
    	&lt;named-formatter name="COLOR-PATTERN"/&gt;
	&lt;/formatter&gt;
&lt;/console-handler&gt;

// ...

&lt;logger category="org.hibernate.SQL"&gt;
	&lt;level name="INFO"/&gt;
&lt;/logger&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Als je in eclipse een melding krijgt: <em>Entiteit_ cannot be resolved to a variable</em> (oid) kan je dat oplossen als volgt: <em>rechtermuisknop op het entiteiten project, run as: maven generate-sources</em>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
XML problems? Het kan zijn dat je op een gegeven moment je workspace en je server goed hebt werken maar dat er nog 4 XML gerelateerde errors over zijn, doe dan het volgende:
- Navigeer naar Window &gt; Preferences &gt; Validation
- Vink het vakje naast <em>Suspend all validators</em> aan
- Verwijder de 4 gerelateerde XML errors. (Dit is de enige keer dat je errors mag verwijderen).
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Bij het opstarten van je server kan het initialiseren van Mojarra best lang duren. Aangezien je je server nog erg vaak gaat opstarten kost dit op de lange duur veel tijd. Om dit te fixen verwijder je <code>&lt;extension module="org.jboss.as.jsf"/&gt;</code> en <code>&lt;subsystem xmlns="urn:jboss:domain:jsf:1.0"/&gt;</code> uit je standalone.xml. Deze kan je vinden onder de map waarin je je wildfly hebt geinstalleerd en dan de map <em>configuration</em> te zoeken.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_oracle_sqldeveloper_installeren">A.2.7. Oracle SQLDeveloper installeren</h4>
<div class="paragraph">
<p>Download de nieuwste versie van Oracle SQLDeveloper voor jouw platform.
Hiertoe moet je registreren bij Oracle voor een (gratis) developer account.
Nu zit niet iedereen te wachten op spam van Oracle, dus kan je met behulp van <a href="http://bugmenot.com/view/oracle.com">Bug Me Not</a> een anti-spam account invullen.
Mocht dat niet werken, kan je via <a href="http://mailinator.com" class="bare">http://mailinator.com</a> een anti-spam adres maken en daarmee een tijdelijk account regelen (en die weer registreren bij Bug Me Not).
Natuurlijk staat het je vrij om een Oracle account te registeren.</p>
</div>
<div class="paragraph">
<p>Linux gebruikers wordt aangeraden om niet een installatie package te downloaden maar gewoon de alternative platforms ZIP file.
Mac OS X gebruikers kunnen gewoon de standaard OS X package downloaden aangezien dat gewoon een goed ingepakte ZIP file is.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_verklarende_woordenlijst">Appendix B: Verklarende woordenlijst</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Wanneer je net bij Topicus Onderwijs werkt vliegen de acroniemen, afkortingen en begrippen je om de oren. Deze verklarende woordenlijst wil helpen met het kunnen duiden van die begrippen. Hij is bij lange na niet volledig, maar kan je wel helpen die discussie te begrijpen die net bij de <em>standup</em> is gehouden.</p>
</div>
<div class="sect2">
<h3 id="_topicus_onderwijs_systemen_en_projecten">Topicus Onderwijs systemen en projecten</h3>
<div class="paragraph">
<p>Topicus Onderwijs werkt al jaren aan systemen en niet altijd is het duidelijk welke dat zijn. Hier een lijst van de systemen.</p>
</div>
<div class="dlist glossary">
<dl>
<dt>@VO</dt>
<dd>
<p>De tweede marktnaam van SOMtoday nadat Simac Onderwijs Vocus ging gebruiken als de 3e versie van hun @VO product. Ook bekend als "@VO 3.0"</p>
</dd>
<dt>Alluris</dt>
<dd>
<p>SIS voor HBO/Universiteiten</p>
</dd>
<dt>Digdag</dt>
<dd>
<p>Oudercommunicatie voor kinderopvang</p>
</dd>
<dt>EduArte</dt>
<dd>
<p>LAS voor MBO</p>
</dd>
<dt>Gynzy</dt>
<dd>
<p>Bedrijf dat software maakt voor gebruik in de klas in het primair onderwijs</p>
</dd>
<dt>Gynzy Kids</dt>
<dd>
<p>Samenwerking tussen Topicus en Gynzy voor het zelf ontwikkelen van digitale leermiddelen</p>
</dd>
<dt>ParnasSys</dt>
<dd>
<p>LAS voor primair onderwijs</p>
</dd>
<dt>Parro</dt>
<dd>
<p>Oudercommunicatie voor onderwijs (nu nog primair en in NL)</p>
</dd>
<dt>Qualiant</dt>
<dd>
<p>Financiële administratie voor scholen</p>
</dd>
<dt>RVC</dt>
<dd>
<p>Eerste webapplicatie voor Topicus voor Regionale VerwijzingsCommissies om rugzakjes uit te delen aan leerlingen met beperkingen in het onderwijs, gestart in 2002 en gestopt per 31-12-2015.</p>
</dd>
<dt>Wise-r</dt>
<dd>
<p>(voorheen Passepartout en Serius) Online platform voor distributie van digitale leermiddelen</p>
</dd>
<dt>SOMtoday</dt>
<dd>
<p>LAS voor voortgezet onderwijs</p>
</dd>
<dt>TMVerwijzer</dt>
<dd>
<p>Administratiesysteem voor Thieme Meulenhoff over wie welke onderwijsmethode afgenomen heeft.</p>
</dd>
<dt>Ultimview</dt>
<dd>
<p>Data analyse portaal met veel grafiekjes (onderwijs, finance en zorg)</p>
</dd>
<dt>Vocus</dt>
<dd>
<p>De eerste marktnaam van SOMtoday (want Voortgezet Onderwijs en topiCUS)</p>
</dd>
<dt>Zien</dt>
<dd>
<p>Sociaal-Emotioneel leerling begeleidingssysteem, ingebouwd in ParnasSys</p>
</dd>
<dt>ZienVO</dt>
<dd>
<p>Sociaal-Emotioneel leerling begeleidingssysteem voor het voortgezet onderwijs</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_afkortingen_uit_het_projectmanagement">Afkortingen uit het projectmanagement</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">FO</dt>
<dd>
<p>Functioneel Ontwerp</p>
</dd>
<dt class="hdlist1">PID</dt>
<dd>
<p>Project Initiatie Document. Een mythisch document dat door geen enkele EduArte Onderwijs ontwikkelaar gezien is.</p>
</dd>
<dt class="hdlist1">PvA</dt>
<dd>
<p>Plan van Aanpak</p>
</dd>
<dt class="hdlist1">PvE</dt>
<dd>
<p>Pakket van Eisen (voor aanbestedingen, moet overal <em>ja</em> op gezegd worden om te kunnen winnen)</p>
</dd>
<dt class="hdlist1">TO</dt>
<dd>
<p>Technisch Ontwerp. Een mythisch document, zie ook PID.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_afkortingen_uit_het_onderwijsdomein">Afkortingen uit het onderwijsdomein</h3>
<div class="dlist glossary">
<dl>
<dt>AB</dt>
<dd>
<p>Ambulante Begeleiding</p>
</dd>
<dt>BO</dt>
<dd>
<p>Business Objects</p>
</dd>
<dt>BRIN</dt>
<dd>
<p>Elke onderwijsinstelling wordt geïdentificeerd aan de hand van het Basis Registratie Instellingen-nummer</p>
</dd>
<dt>BRON</dt>
<dd>
<p>BasisRegister OnderwijsNummer</p>
</dd>
<dt>CFI</dt>
<dd>
<p>Centraal Financieel Instituut</p>
</dd>
<dt>CvI</dt>
<dd>
<p>Commissie voor de Indicatiestelling</p>
</dd>
<dt>DL</dt>
<dd>
<p>Didactische Leeftijd</p>
</dd>
<dt>DLE</dt>
<dd>
<p>Didactische LeeftijdsEquivalent (een maat voor de vordering in de leerstof)</p>
</dd>
<dt>DOD</dt>
<dd>
<p>Digitaal OverdrachtsDossier (bestands- + encryptiespecificatie)</p>
</dd>
<dt>DUO</dt>
<dd>
<p>Dienst Uitvoering Onderwijs</p>
</dd>
<dt>EDEX</dt>
<dd>
<p>EDucatieve EXport</p>
</dd>
<dt>ELD</dt>
<dd>
<p>Elektronisch LeerlingDossier (met berichtenprotocol)</p>
</dd>
<dt>GBA</dt>
<dd>
<p>Gemeentelijke BasisAdministratie persoonsgegevens</p>
</dd>
<dt>IB</dt>
<dd>
<p>Intern Begeleider</p>
</dd>
<dt>IPON</dt>
<dd>
<p>Twee-jaarlijkse onderwijsbeurs in de Jaarbeurs in Utrecht, met name gefocust op het voortgezet onderwijs en het MBO</p>
</dd>
<dt>LAS</dt>
<dd>
<p>LeerlingAdministratieSysteem</p>
</dd>
<dt>LIS</dt>
<dd>
<p>LeerlingInformatieSysteem (zie ook LAS)</p>
</dd>
<dt>LVS</dt>
<dd>
<p>LeerlingVolgSysteem</p>
</dd>
<dt>LWOO</dt>
<dd>
<p>LeerWegOndersteunend Onderwijs</p>
</dd>
<dt>NOT</dt>
<dd>
<p>Twee-jaarlijkse onderwijsbeurs in de Jaarbeurs in Utrecht, met name gefocust op het primair onderwijs</p>
</dd>
<dt>NVO</dt>
<dd>
<p>Natte-VingerOfferte :P</p>
</dd>
<dt>OKR</dt>
<dd>
<p>OnderwijsKundig Rapport</p>
</dd>
<dt>OPP</dt>
<dd>
<p>Ontwikkelingsperspectief. Niet te verwarren met <a href="https://www.youtube.com/watch?v=qdeH7QhGiRg">You down with OPP (Yeah you know me)</a></p>
</dd>
<dt>OSO</dt>
<dd>
<p>OverstapService Onderwijs</p>
</dd>
<dt>PrO</dt>
<dd>
<p>PRaktijkOnderwijs</p>
</dd>
<dt>REC</dt>
<dd>
<p>Regionaal ExpertiseCentrum</p>
</dd>
<dt>RT</dt>
<dd>
<p>Remedial Teacher, verleent hulp aan leerlingen met leerproblemen of gedragsstoornissen</p>
</dd>
<dt>RVC</dt>
<dd>
<p>Regionale VerwijzingsCommissie</p>
</dd>
<dt>SBO</dt>
<dd>
<p>Speciaal BasisOnderwijs</p>
</dd>
<dt>SIS</dt>
<dd>
<p>Student Information System</p>
</dd>
<dt>SO</dt>
<dd>
<p>Speciaal Onderwijs</p>
</dd>
<dt>SSO</dt>
<dd>
<p>Single Sign-On (één keer een wachtwoord invoeren geeft toegang tot veel applicaties)</p>
</dd>
<dt>VSO</dt>
<dd>
<p>Voortgezet Speciaal Onderwijs</p>
</dd>
<dt>WEC</dt>
<dd>
<p>Wet op de Expertise Centra</p>
</dd>
</dl>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<a href="http://www.oudersenonderwijstwente.nl/afkortingen.htm">Deze website</a> heeft nog meer afkortingen uit het onderwijsveld
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_afkortingen_en_begrippen_uit_de_em_topicus_onderwijs_em_cultuur">Afkortingen en begrippen uit de <em>Topicus Onderwijs</em> cultuur</h3>
<div class="dlist glossary">
<dl>
<dt>11:11</dt>
<dd>
<p>Het tijdstip dat altijd opvalt, en waarop Anne Lohuis de dagelijkse quizzzz houdt</p>
</dd>
<dt>42</dt>
<dd>
<p>Het antwoord op de vraag naar het heelal, het leven en de rest</p>
</dd>
<dt>Banaan</dt>
<dd>
<p>Uitspraak van Hielke Hoeve in situaties wanneer er geen duidelijke reden voor iets is. "Waarom is het certificaat van de Exchange Server ongeldig? Want banaan!"</p>
</dd>
<dt>Bobby Tables</dt>
<dd>
<p><a href="http://xkcd.com/327">Strip van XKCD</a> waarin uitgelegd wordt wat een SQL injection aanval betekent. Officiële titel is "Exploits of a Mom"</p>
</dd>
<dt>DJODD</dt>
<dd>
<p>Doe Je Onderwijs Ding Dag. De 20% regel van Google toegepast op Topicus Onderwijs: om de vrijdag een innovatiedag, want zo rollen wij.</p>
</dd>
<dt>ICYMI</dt>
<dd>
<p>In Case You Missed It</p>
</dd>
<dt>N00b</dt>
<dd>
<p>Ook bekend als noob, onkundig persoon</p>
</dd>
<dt>NSFW</dt>
<dd>
<p>Not Safe For Work, behalve vrijdagmiddag.</p>
</dd>
<dt>TGIF</dt>
<dd>
<p>Thank God It&#8217;s Friday</p>
</dd>
<dt>TIL</dt>
<dd>
<p>Today I Learned</p>
</dd>
<dt>WTF</dt>
<dd>
<p>uitroep bij <a href="http://www.osnews.com/story/19266/WTFs_m">reviewen van code</a></p>
</dd>
<dt>XKCD</dt>
<dd>
<p>Veel gelezen web strip over wetenschap, wiskunde en internet cultuur. Bekend van o.a. <a href="https://xkcd.com/327/">Little Bobby Tables</a>, <a href="http://xkcd.com/1040/">grappige infographics</a> en <a href="http://xkcd.com/1107/">cultuur</a>. Vergeet niet met je muiscursor over de strip te <em>hoveren</em> voor additionele verborgen tekst. Er is ook een <a href="http://www.explainxkcd.com/wiki/index.php/Main_Page">uitleg voor deze strips</a></p>
<div class="imageblock">
<div class="content">
<img src="images/what_xkcd_means.png" alt="xkcd.com/207">
</div>
</div>
</dd>
<dt>YOLO</dt>
<dd>
<p>You Only Live Once</p>
</dd>
</dl>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Kijk ook eens op de <a href="http://urbandictionary.com">Urban Dictionary</a> om begrippen verklaard te krijgen. Veelal NSFW.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_afkortingen_en_begrippen_gebruikt_door_ontwikkelaars">Afkortingen en begrippen gebruikt door ontwikkelaars</h3>
<div class="paragraph">
<p>Wanneer de ontwikkelaars van Topicus Onderwijs weer eens los gaan over dat "de build gefaald is dankzij een falende deployment van jenkins op wildfly en dat daarom selenium niet kon draaien in de docker container.", wordt het tijd om deze lijst erbij te pakken en die opmerking rustig onder het genot van een warme beker chocolademelk bij een haardvuur te analyseren.</p>
</div>
<div class="dlist glossary">
<dl>
<dt>ACID</dt>
<dd>
<p>Acroniem voor de 4 essentiële eigenschappen voor het doen van database transacties: Atomair, Consistent, geÏsoleerd en Duurzaam. Vergelijk dit met het overmaken van geld van de ene naar de andere rekening. Bedacht in de jaren zeventig, of er drugs bij gebruikt zijn is onbekend.</p>
</dd>
<dt>Build</dt>
<dd>
<p>Een poging om een programma te bouwen, te testen en neer te zetten op een server. Veelal uitgevoerd door Jenkins</p>
</dd>
<dt>Deployen</dt>
<dd>
<p>het starten van een applicatie op een server. Vaak in combinatie met Wildfly.</p>
</dd>
<dt>Docker</dt>
<dd>
<p>Software waarmee je containers maakt of uitvoert. Deze containers bevatten een omgeving waarin een proces kan worden uitgevoerd zonder dat het andere containers in de weg zit op het besturingssysteem. Het wordt vaak vergeleken met een VM maar er wordt geen hardware ge-emuleert en is geen overhead van een besturingssysteem. Hiermee kun je heel snel een nieuwe omgeving starten op een server of je lokale machine.</p>
</dd>
<dt>EcmaScript</dt>
<dd>
<p>De officiële naam voor JavaScript. Door niemand gebruikt.</p>
</dd>
<dt>Git</dt>
<dd>
<p>Programma om versies van source code bestanden bij te houden</p>
</dd>
<dt>Java</dt>
<dd>
<p>Programmeertaal waarbij ontwikkelaars koffie omzetten in programma&#8217;s</p>
</dd>
<dt>Java EE</dt>
<dd>
<p>Set aan Java functies die samen het mogelijk maken om <em>enterprise</em> applicaties te maken. Bevat standaard zaken als database opslag, mail versturen en communicatie tussen twee programma&#8217;s. Servers als Wildfly bieden deze zaken aan zodat onze applicaties daar gebruik van kunnen maken.</p>
</dd>
<dt>JavaScript</dt>
<dd>
<p>Programmeertaal met een syntax gemaakt voor beginner maar door professionals onbegrepen. In de woorden van Douglas Crockford: Despite its popularity, few know that JavaScript is a very nice dynamic object-oriented general-purpose programming language. How can this be a secret? Why is this language so misunderstood?</p>
</dd>
<dt>Jenkins</dt>
<dd>
<p>programma om automatisch onze software te bouwen, te testen en neer te zetten op een (test)omgeving.</p>
</dd>
<dt>JIF</dt>
<dd>
<p>de officiële uitspraak van het grafische bestandsformaat GIF. Althans volgens de oorspronkelijke bedenker. De rest van de wereld spreekt over GIF (Duitse <em>g</em>).</p>
</dd>
<dt>JIT</dt>
<dd>
<p>Just In Time compiler. Vertaalt programmacode (bijvoorbeeld JVM code) naar machine code dat direct uitgevoerd kan worden door een computer.</p>
</dd>
<dt>Maven</dt>
<dd>
<p>programma om op een gestructureerde manier gebruik te kunnen maken van externe software in onze applicaties</p>
</dd>
<dt>OO</dt>
<dd>
<p>Object Orientatie&#8212;&#8203;een manier om software te modelleren naar de echte wereld</p>
</dd>
<dt>OTAP</dt>
<dd>
<p>De diverse stadia waarin een applicatie zich kan bevinden: Ontwikkel, Test, Acceptatie en Productie.</p>
</dd>
<dt>OAuth</dt>
<dd>
<p>Security protocol om gebruikers te authenticeren zonder dat een (vaak mobiele) applicatie een gebruikersnaam/wachtwoord combinatie lokaal hoeft op te slaan, maar waarbij de applicatie een gebruiker-/applicatie specifiek token (sleutel) krijgt.</p>
</dd>
<dt>OWASP</dt>
<dd>
<p>Organisatie die een lijst van veel voorkomende beveiligingsproblemen bij houdt. De OWASP top 10 is wat het kaf van het koren scheidt.</p>
</dd>
<dt>REST</dt>
<dd>
<p>Manier waarop computer systemen met elkaar communiceren via bekende internet technologieën waarop het WWW oorspronkelijk gebouwd is. Leidt af en toe tot heilige oorlogen</p>
</dd>
<dt>SAML</dt>
<dd>
<p>Security Assertion Markup Language. Security protocol voor Single Sign-On in web applicaties.</p>
</dd>
<dt>Selenium</dt>
<dd>
<p>Automatische test tool voor web applicaties. Vaak de reden van falende builds.</p>
</dd>
<dt>SOAP</dt>
<dd>
<p>Simple Object Access Protocol. Een alles behalve simpele manier programma&#8217;s met elkaar te laten communiceren. De communicatie loopt via een strikt, formeel XML protocol over HTTP, en op die manier kunnen programma&#8217;s bij elkaar functionaliteit aanroepen. Erg populair in 2002-2008, tegenwoordig steeds vaker vervangen door REST.</p>
</dd>
<dt>UML</dt>
<dd>
<p>Unified Modelling Language. Diagram-taal die elke ontwikkelaar op school geleerd heeft, maar alleen nog op whiteboards toepast door lijntjes tussen rechthoeken te trekken.</p>
</dd>
<dt>VM</dt>
<dd>
<p>Virtual Machine. Een abstractie van hardware waarin software draait. Maakt het mogelijk om supersnel software te kunnen draaien in veel instanties. Kan ook Java Virtual Machine betekenen: een representatie van een machine waarin Java (en andere programmeertalen) uitgevoerd kan worden.</p>
</dd>
<dt>Wicket</dt>
<dd>
<p>een programma om Java serverapplicaties te laten werken in een web browser.</p>
</dd>
<dt>Wildfly</dt>
<dd>
<p>Een Java server voor onze applicaties</p>
</dd>
<dt>XP</dt>
<dd>
<p>Extreme Programming, een set aan werkwijzen voor programmeurs om productiever te zijn, ontwikkeld eind jaren '90. Bekende begrippen zijn: pair programming, test driven development, daily standup en continuous integration.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_oo_begrippen">OO begrippen</h3>
<div class="dlist glossary">
<dl>
<dt>Dependency Injection</dt>
<dd>
<p>De D uit SOLID. In plaats van zelf op zoek te gaan naar afhankelijke classes (dependencies) worden de dependencies aan de gebruikende class aangereikt. Veelal wordt hiervoor een (Java) bibliotheek gebruikt, zoals Guice. Dependency Injection is gestandaardiseerd in de CDI Java standaard.</p>
</dd>
<dt>Design pattern</dt>
<dd>
<p>Naam voor een generieke oplossing voor een probleem in een bepaalde context.</p>
</dd>
<dt>Functional Requirements</dt>
<dd>
<p><em>wat</em> jouw applicatie moet doen. Zie ook non-functional requirements.</p>
</dd>
<dt>IoC</dt>
<dd>
<p>Inversion of Control, zie Dependency Injection.</p>
</dd>
<dt>Non-functional Requirements</dt>
<dd>
<p><em>hoe</em> jouw applicatie de functionele eisen moet uitvoeren. Bijvoorbeeld: elke pagina moet binnen 1 seconde gerenderd zijn, of de applicatie moet 99,9% van de tijd beschikbaar zijn. Ook bekend als de <em>-abilities</em> (scalability, maintainability).</p>
</dd>
<dt>Refactoring</dt>
<dd>
<p>Het wijzigen van de structuur van programmacode ter verbetering van non-functional requirements, zonder effect te hebben op de functionele requirements. De code moet nog steeds hetzelfde resultaat leveren (functioneel), maar kan verbeterd zijn op bijv. onderhoudbaarheid, performance, begrijpbaarheid&#8230;&#8203;</p>
</dd>
<dt>SOLID</dt>
<dd>
<p>acroniem voor Single Responsibility, Open-Closed Principle, Lishkov Substitution Principle, Interface Segreggation Principle, Dependency Injection. Zijn 5 basisprincipes voor doordachte O.O. code. Bedacht door Robert <em>Uncle Bob</em> C. Martin</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_design_patterns">B.1. Design Patterns</h3>
<div class="paragraph">
<p>Hieronder een korte samenvatting van wat veelgebruikte design patterns.</p>
</div>
<div class="dlist glossary">
<dl>
<dt>Adapter</dt>
<dd>
<p>een design pattern voor wanneer je gebruik moet maken van een object waarvan je de code niet kan aanpassen, maar die niet gebruikt kan worden omdat de gebruikte code iets anders verwacht. Je schrijft een adapter dan om de één compatible te maken met de ander.</p>
</dd>
<dt>Factory</dt>
<dd>
<p>een abstractie van het <code>new</code> keyword voor objecten die moeilijk te maken zijn (zie ook Builder), of waarvoor het daadwerkelijk creëren uitgesteld moet worden, of dynamisch besloten worden welk concreet type geïnstantieerd moet worden.</p>
</dd>
<dt>MVC</dt>
<dd>
<p>Model View Controller patroon voor het goed scheiden van de verschillende rollen in (vaak) user interface classes</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Model</dt>
<dd>
<p>hetgeen dat in de View getoond moet worden</p>
</dd>
<dt class="hdlist1">View</dt>
<dd>
<p>toont het model aan de gebruiker</p>
</dd>
<dt class="hdlist1">Controller</dt>
<dd>
<p>ontvangt de interacties van de gebruiker, voert die uit en construeert het Model en kiest de View die gerenderd moet worden.</p>
</dd>
</dl>
</div>
</dd>
<dt>Observer</dt>
<dd>
<p>een design pattern voor het scheiden van het produceren van evenementen en het ontvangen van evenementen door de producent (de observable) te laten observeren door observers. Hiervoor zijn standaard klassen in Java beschikbaar: Observer en Observable.</p>
</dd>
<dt>Singleton</dt>
<dd>
<p>een object waarvan er maar één mag zijn. Wordt over het algemeen afgeraden omdat het lastig is in een multi-threaded applicatie.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_java_begrippen">Java begrippen</h3>
<div class="paragraph">
<p>Dit zijn de specifieke begrippen die Java ontwikkelaars onderling uitwisselen of zouden moeten kennen omdat we die de hele tijd (of juist niet) gebruiken in onze applicaties.
Hier worden af en toe wat begrippen herhaald die al eerder verklaard zijn, maar dan net iets nauwkeuriger.</p>
</div>
<div class="dlist glossary">
<dl>
<dt>Arquillian</dt>
<dd>
<p>een applicatie voor het kunnen uitvoeren van tests in Wildfly.</p>
</dd>
<dt>Container</dt>
<dd>
<p>een applicatie server voor Java enterprise applicaties. Biedt allerlei diensten aan voor applicatie programmeurs, zoals het ontvangen van een HTTP bericht en deze doorsluizen naar een specifieke Servlet, of het onderhouden van database connecties, het ontvangen en versturen van applicatieberichten via queues, centrale configuratie, fail-over, replicatie en nog veel meer. Ook bekend als Java EE Container of Server. Bekende producten zijn: Tomcat, TomEE, Jetty, Glassfish, Wildfly, JBoss, WebSphere en WebLogic.</p>
</dd>
<dt>Deployen</dt>
<dd>
<p>het ter beschikking stellen van een EAR of WAR aan een container met de bedoeling de daarin ingepakte applicatie te runnen.</p>
</dd>
<dt>Deployment descriptor</dt>
<dd>
<p>bestand dat aan een container vertelt hoe een EAR of WAR bestand gedeployed moet worden.</p>
</dd>
<dt>EAR bestand</dt>
<dd>
<p>Enterprise ARchive. Een zip file met een specifieke structuur voor <em>enterprise</em> applicaties. Kan meerdere WAR bestanden en JAR bestanden bevatten. Wordt <em>gedeployed</em> naar een Java EE <em>container</em>.</p>
</dd>
<dt>Filter</dt>
<dd>
<p>een alternatief voor servlet waarmee je functionaliteit kan bouwen die altijd aangeroepen wordt om een servlet heen. Hiermee kan je bijvoorbeeld een timer starten voordat de servlet gestart wordt en dan nadat de servlet klaar is de eindtijd vastleggen en dan de duur van het request afdrukken. Ook bekend als Servlet Filter.</p>
</dd>
<dt>Hibernate</dt>
<dd>
<p>een Java bibliotheek die ORM aanbiedt volgens de JPA standaard.</p>
</dd>
<dt>Guava</dt>
<dd>
<p>Google bibliotheek met functionaliteit voor Java programma&#8217;s om betere code te kunnen schrijven. Met name populair vóór Java 8.</p>
</dd>
<dt>Java EE</dt>
<dd>
<p>Java Enterprise Edition. Een verzameling aan Java standaarden voor enterprise achtige functionaliteit die gezamenlijk geversioneerd worden. Zaken die hieronder vallen zijn: Servlets, JSPs, CDI, JPA, JAX-RS, en nog veel meer. Versies van de Java EE standaard vóór Java EE 6 zijn niet bruikbaar en hebben in het verleden voor veel ellende gezorgd.</p>
</dd>
<dt>JAX-B</dt>
<dd>
<p>een Java standaard voor het vertalen van Java objecten naar XML (of JSON) en vice versa (de B staat voor Binding). Werkt met Java annotaties.</p>
</dd>
<dt>JAX-RS</dt>
<dd>
<p>een Java standaard voor het bouwen van REST diensten. De open source projecten Jersey en RESTEasy zijn daar een implementatie van. Onder water maakt JAX-RS gebruik van servlets.</p>
</dd>
<dt>JAX-WS</dt>
<dd>
<p>een Java standaard voor het bouwen van webservice diensten op basis van SOAP. Apache CXF is hier een implementatie van.</p>
</dd>
<dt>JDBC</dt>
<dd>
<p>een standaard manier om vanuit Java queries uit te voeren op een database. Hiervoor dient een database specifieke JDBC-driver bij je applicatie gezet te worden waarna het <em>automagisch</em> werkt. De meest gebruikte classes zijn: DriverManager, Connection, PreparedStatement en ResultSet.</p>
</dd>
<dt>JPA</dt>
<dd>
<p>Java Persistence API. Een Object-Relationeel-Mapping (ORM) standaard om net te doen alsof de database direct Java objecten kan opslaan en opvragen. Werkt met Java annotaties om aan te geven hoe de vertaling van database tabel naar Java moet. Onder water maakt JPA gebruik van JDBC om met de database te communiceren.</p>
</dd>
<dt>JSP</dt>
<dd>
<p>Java Server Pages. .jsp bestand met daarin HTML en (een beetje) Java code. Bedacht toen men het schrijven van HTML met println() methode aanroepen zat was. Wordt door de JSP compiler onder water vertaald naar een Servlet.</p>
</dd>
<dt>Lambda</dt>
<dd>
<p>nieuwe manier voor Java (sinds Java 8) om met minder regels code meer te kunnen doen. Ook: Lambda expressies</p>
</dd>
<dt>REST</dt>
<dd>
<p>een lastig te verklaren begrip, waarbij communicatie tussen systemen plaatsvindt via HTTP in zogenaamde <em>resources</em> die een uniek adres hebben op het internet (een URI, Uniform Resource Identifier), en waarbij je vaak meerdere representaties van dezelfde resource kan opvragen (bijv. JSON, XML, of HTML).</p>
</dd>
<dt>Servlet</dt>
<dd>
<p>Java class verantwoordelijk voor het ontvangen en versturen van HTTP berichten in een Java EE omgeving (bijv. Tomcat, Glassfish, Wildfly, Jetty). Vroeger: renderde vanuit Java code direct de HTML naar de browser. Tegenwoordig: ingezet als controller in het MVC-patroon.
Java code met (een beetje) HTML code</p>
</dd>
<dt>Servlet Container</dt>
<dd>
<p>een minimalistische container die alleen maar de functionaliteit van Servlets en JSPs aanbiedt.</p>
</dd>
<dt>Spring</dt>
<dd>
<p>een concurrent voor Java EE, hangt aan elkaar met XML. Geef Spring nooit één vinger.</p>
</dd>
<dt>WAR bestand</dt>
<dd>
<p>Web ARchive. Een zip file met een specifieke structuur voor Java web applicaties. Je upload een WAR bestand naar de container, of zet deze in een speciale folder van de container om deze te kunnen laten uitvoeren door de container. Wanneer de container de applicatie start noem je dat "deployen". Door de specifieke structuur van de zip file en specifieke bestanden weet de container precies welke classes aangeroepen kunnen worden.</p>
</dd>
<dt>web.xml</dt>
<dd>
<p>een specifiek bestand in een WAR file dat aangeeft welke web functionaliteit van JSPs en servlets aangeboden worden in de WAR file. Je specificeert op welke URL in je applicatie een specifieke servlet terecht komt. Ook bekend als route-file in andere web frameworks zoals Ruby on Rails of Laravel voor PHP. Dit bestand wordt ook wel <em>deployment descriptor</em> genoemd.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_begrippen_gerelateerd_aan_git">Begrippen gerelateerd aan Git</h3>
<div class="paragraph">
<p>Hieronder een korte synopsis van de kernbegrippen uit Git.
Dit probeert niet een uitputtende lijst te zijn maar je net voldoende te geven zodat je niet met je oren staat te klapperen wanneer ontwikkelaars weer eens los gaan over Git, branches en mergen.</p>
</div>
<div class="dlist glossary">
<dl>
<dt>branch</dt>
<dd>
<p>eigen lokale kopie van de source code voor een project om in te werken zonder andere ontwikkelaars in de weg te zitten</p>
</dd>
<dt>cherry-pick</dt>
<dd>
<p>het pakken van één specifieke commit en die toepassen in een branch</p>
</dd>
<dt>clone</dt>
<dd>
<p>het binnenhalen van de volledige geschiedenis van de source code van een project</p>
</dd>
<dt>commit</dt>
<dd>
<p>het toepassen van jouw lokale wijzigingen in jouw versie van de geschiedenis van het project</p>
</dd>
<dt>conflict</dt>
<dd>
<p>wanneer git constateert dat twee ontwikkelaars dezelfde bestanden op dezelfde plekken tegelijkertijd hebben gewijzigd</p>
</dd>
<dt>github</dt>
<dd>
<p>online dienst om de versies gemaakt met git op te slaan</p>
</dd>
<dt>master</dt>
<dd>
<p>de hoofdbranch waar <em>de waarheid</em> van de source code van een programma staat</p>
</dd>
<dt>merge</dt>
<dd>
<p>het samenvoegen van de ontwikkelgeschiedenis van één branch in een andere branch</p>
</dd>
<dt>pull</dt>
<dd>
<p>het ophalen en verwerken van de wijzigingen die andere ontwikkelaars gepubliceerd hebben in een remote repository</p>
</dd>
<dt>rebase</dt>
<dd>
<p>hetzelfde als merge maar dan probeer je jouw wijzigingen <em>na</em> de wijzigingen uit de andere branch te plaatsen in de geschiedenis</p>
</dd>
<dt>remote</dt>
<dd>
<p>een git-project op afstand dat je toegevoegd hebt in je lokale git repository</p>
</dd>
<dt>repository</dt>
<dd>
<p>het git-project zoals dat leeft in git. Kan verwijzen naar de centrale lokatie, zoals github, of je lokale kopie op je computer.</p>
</dd>
<dt>tag</dt>
<dd>
<p>een label in git om een specifieke versie van de source code van een programma aan te duiden</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cobra_in_action_styleguide">Appendix C: Cobra in Action styleguide</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Iedereen is eigenaar van deze documentatie en mag (moet) mee helpen deze documentatie verbeteren.
Om samen te kunnen werken aan deze documentatie zijn een aantal afspraken nodig, net zoals voor code formatting.</p>
</div>
<div class="paragraph">
<p>Er zijn technische richtlijnen over hoe je asciidoctor toepast en inhoudelijke richtlijnen over hoe je documentatie schrijft.</p>
</div>
<div class="sect2">
<h3 id="_technische_styleguide">C.1. Technische styleguide</h3>
<div class="paragraph">
<p>Deze richtlijnen hebben betrekking op de techniek van asciidoctor.
Ze zijn gebaseerd op de wijze lessen beschreven in <a href="http://asciidoctor.org/docs/asciidoc-recommended-practices/" class="bare">http://asciidoctor.org/docs/asciidoc-recommended-practices/</a>.</p>
</div>
<div class="sect3">
<h4 id="_document_extensie">C.1.1. Document Extensie</h4>
<div class="paragraph">
<p>Gebruik <code>.adoc</code> als bestandsextensie.</p>
</div>
</div>
<div class="sect3">
<h4 id="_line_wrapping">C.1.2. Line wrapping</h4>
<div class="paragraph">
<p>Gebruik geen line-wrapping maar schrijf één zin per regel.
Dit maakt het makkelijker om de verschillen te zien in git omdat je dan bij een wijziging in een zin niet meerdere regels herformatteert.
Is je regel te lang, schrijf hem dan korter.</p>
</div>
<div class="paragraph">
<p>AsciiDoc voegt aanéén gesloten regels samen als één paragraaf.</p>
</div>
</div>
<div class="sect3">
<h4 id="_sectie_titels">C.1.3. Sectie titels</h4>
<div class="paragraph">
<p>Wij gebruiken de asymmetric Atx-stijl van sectie hoofden:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>== Eerste Sectie
=== Tweede Sectie</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_blokken">C.1.4. Blokken</h4>
<div class="paragraph">
<p>Gebruik het minimum aantal karakters om een blok aan te duiden:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>----
// Lekker lange regel voorbeeld code
----</pre>
</div>
</div>
<div class="paragraph">
<p>Doe vooral niet:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>------------------------------------
// Lekker lange regel voorbeeld code
------------------------------------</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_inline_code">C.1.5. Inline code</h4>
<div class="paragraph">
<p>Inline code kan met backticks (`) gequote worden.
Dus bijvoorbeeld `Model` wordt <code>Model</code>.
Dit gaat echter stuk als je de klassenaam in meervoudsvorm wilt gebruiken.
De quote "loopt dan door" over de rest van de regel tot hij een sluitende backtick tegenkomt waar géén letters direct achter staan.
Dus "`Model`s zijn cooler dan `Entiteiten`" wordt <code>Model`s zijn cooler dan `Entiteiten</code>.</p>
</div>
<div class="paragraph">
<p>Dit kun je vermijden door de enkele backticks te vervangen door dubbele plustekens.
Dus "++Model++s zijn cooler dan ++Entiteiten++" dat er vervolgens uit ziet als <code>Model</code>s zijn cooler dan <code>Entiteiten</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_inhoudelijke_styleguide">C.2. Inhoudelijke styleguide</h3>
<div class="paragraph">
<p>Het doel is om Cobra in Action een leesbaar document te laten zijn.
Documentatie lezen is niet de grootste hobbie van ontwikkelaars, maar een goed geschreven document helpt een boel.
Niets is vervelender dan een gort droog ambtelijk document waar niet doorheen te komen is.
Om deze documenten leesbaar te houden gebruik je de volgende richtlijnen.</p>
</div>
<div class="paragraph">
<p>Veel van deze tips vind je op <a href="http://www.inez-tc.nl/wiki/schrijven-in-klare-taal/actief-schrijven" class="bare">http://www.inez-tc.nl/wiki/schrijven-in-klare-taal/actief-schrijven</a>.</p>
</div>
<div class="sect3">
<h4 id="_gebruik_korte_zinnen">C.2.1. Gebruik korte zinnen</h4>
<div class="paragraph">
<p>Korte zinnen zijn beter leesbaar dan lange zinnen.
Een goede manier om korte zinnen te schrijven is het gebruik maken van de actieve vorm.</p>
</div>
</div>
<div class="sect3">
<h4 id="_gebruik_de_actieve_vorm">C.2.2. Gebruik de actieve vorm</h4>
<div class="paragraph">
<p>Gebruik een actieve vorm in je zinnen.
Dit leest veel beter, en voorkomt te lang lopende zinnen.</p>
</div>
<div class="paragraph">
<p>Vergelijk de volgende passieve zinnen</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Het onderwerp wordt vermeden.</p>
</li>
<li>
<p>U wordt teruggebeld.</p>
</li>
<li>
<p>Deze e-mail zal worden verzonden.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>met deze actieve varianten:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ik vermijd het onderwerp</p>
</li>
<li>
<p>Mijn collega komt bij u terug</p>
</li>
<li>
<p>De ontwikkelafdeling stuurt u een e-mail</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In Nederland schijnen we ook een groot fan van twijfeltaal te zijn.</p>
</div>
</div>
<div class="sect3">
<h4 id="_schrap_kunnen_zullen_en_willen">C.2.3. Schrap ‘kunnen’, ‘zullen’ en ‘willen’</h4>
<div class="paragraph">
<p>Deze werkwoorden zijn ‘ontkrachters’ of ‘twijfeltaal’.
Bovendien zijn deze werkwoorden ook nog eens hulpwerkwoorden, en vaak overbodig in een zin.
Ze maken zinnen onnodig lang en ingewikkeld.</p>
</div>
<div class="paragraph">
<p>Bijvoorbeeld de volgende passieve zin</p>
</div>
<div class="ulist">
<ul>
<li>
<p>De gegevens zal ik naar u toesturen</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>wordt zonder ontkrachter:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ik stuur de gegevens naar u toe.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Je kan nog meer twijfeltaal vermijden.</p>
</div>
<div class="paragraph">
<p>‘Kunnen’ laat de mogelijkheid open om iets niet te doen.
Vergelijk de volgende twee zinnen:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>&#8230;&#8203;dan kan ik u helpen met uw inschrijving</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>en</p>
</div>
<div class="ulist">
<ul>
<li>
<p>&#8230;&#8203;dan help ik u met uw inschrijving.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In de eerste zin bestaat de mogelijkheid dat de schrijver het <em>niet</em> gaat doen.
De tweede zin is veel definitiever en betrouwbaarder.</p>
</div>
</div>
<div class="sect3">
<h4 id="_vermijd_twijfeltaal">C.2.4. Vermijd twijfeltaal</h4>
<div class="paragraph">
<p>Voorbeelden van twijfeltaal zijn:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>lijken, blijken, schijnen, mogen;</p>
</li>
<li>
<p>mogelijk, misschien, eventueel, wellicht, waarschijnlijk;</p>
</li>
<li>
<p>denken, verwachten;</p>
</li>
<li>
<p>eigenlijk;</p>
</li>
<li>
<p>in principe.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>De tekst wordt niet alleen leesbaarder door het gebruik van actieve taal, maar ook door de lezer mee te nemen in je tekst.</p>
</div>
</div>
<div class="sect3">
<h4 id="_gebruik_segues_tussen_secties">C.2.5. Gebruik segues tussen secties</h4>
<div class="paragraph">
<p>Schrijf je tekst zo dat je lezer door wil gaan met de volgende sectie.
Dit bereik je met verbindingsteksten die de volgende sectie <em>aankondigen</em> zonder deze expliciet aan te kondigen.
Deze verbindingsteksten heten segues (uitspraak: seg`ways) in de schrijfwereld.
Door je secties met elkaar te verbinden wordt het één geheel en leest het een heel stuk beter.</p>
</div>
<div class="paragraph">
<p>Met segues wordt niet bedoeld wat veel afstudeerders beschrijven in hun verslagen:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Dit is het einde van deze sectie. In de volgende sectie&#8230;&#8203;</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Maar eerder:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Door foozel toe te passen hoef je minder regels code te schrijven.
Als we dit combineren met barrel wordt het nog beter.</p>
</div>
<div class="paragraph">
<p>## Barrel toepassen in je code</p>
</div>
</blockquote>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bibliografie">Bibliografie</h2>
<div class="sectionbody">
<div class="ulist bibliography">
<ul class="bibliography">
<li>
<p><a id="arq2013"></a>[arq2013] John D. Arment. Arquillian Testing Guide. Packt. 2013</p>
</li>
<li>
<p><a id="jpa2006"></a>[jpa2006] Christian Bauer and Gavin King. Java Persistence with Hibernate. Manning. 2006</p>
</li>
<li>
<p><a id="pj22013"></a>[pj22013] Mike Keith and Merrick Schincariol. Pro JPA 2, Apress. 2013</p>
</li>
<li>
<p><a id="wia2008"></a>[wia2008] Martijn Dashorst and Eelco Hillenius. Wicket in Action. Manning. 2009</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2017-08-22 11:29:24 India Standard Time
</div>
</div>
</body>
</html>